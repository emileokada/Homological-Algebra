\documentclass{memoir}

\input{header}
\title{Homological algebra and schemes}
\author{Emile T. Okada}

\begin{document}
\maketitle
\tableofcontents
\chapter{Abelian Categories}
\section{Additive categories}
Let $\mathcal A$ be a category such that the hom-sets carry the structure of an abelian group and composition is bilinear. We call such a category $\Ab$-enriched.
An additive category is an $\Ab$-enriched category which has finite coproducts and a zero object.
\begin{thm}
    \label{thm:atosa}
    Let $\mathcal A$ be an additive category.
    Then finite coproducts in $\mathcal A$ are in fact finite biproducts.
\end{thm}
\begin{proof}
    It is easy to see that initial objects are isomorphic to terminal objects (and they both exist) and so it suffices to show the result for binary coproducts.
    Let $A,B\in \mathcal A$.
    Define $p_A:A\coprod B\to A$ and $p_B:A\coprod B\to B$ as the maps making the following diagrams commute.
    \begin{equation}
        \begin{tikzcd}[column sep=large]
            A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"\id_A"] & & & A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"0"] & \\
                                     & A\coprod B \arrow[r,dashed,"p_A"] & A & & A\coprod B \arrow[r,dashed,"p_B"] & B \\
            B \arrow[ur,"i_B"] \arrow[urr,bend right=30,swap,"0"] & & & B \arrow[ur,"i_B"] \arrow[urr,bend right=30,swap,"\id_B"] &
        \end{tikzcd}
    \end{equation}
    Let $f=i_A\circ p_A + i_B\circ p_B$. Then
    \begin{equation}
        \begin{tikzcd}[column sep=large]
            A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"i_A"] &  \\
                                     & A\coprod B \arrow[r,"f"] & A\coprod B  \\
            B \arrow[ur,"i_B"] \arrow[urr,bend right=30,swap,"i_B"] & 
        \end{tikzcd}
    \end{equation}
    commutes and so by universality we must have $f = \id_{A\coprod B}$.
    Now suppose we have maps $f:C\to A$ and $g:C\to B$. 
    Let $h:C\to A\coprod B$ be the map $i_A\circ f+i_B\circ g$.
    Then $p_A\circ h = f$ and $p_B\circ h = g$.
    Moreover, if $h':C\to A\coprod B$ is any other map satisfying $p_A\circ h' = f$ and $p_B\circ h' = g$ then $h' = id_{A\coprod B}\circ h' = i_A\circ f+i_B\circ g = h$ and so $A\coprod B$ is a biproduct.
\end{proof}

A functor between additive categories is called additive if it is a homomorphism on hom-sets.
\section{Semiadditive categories}
The above definition of an additive category includes the additive structure on the hom-sets as data. 
In this section we provide a definition where the additive structure arises as a property instead.

Let $\mathcal A$ be a category with a zero object.
Recall that in such a category there always exists a morphism between to any two objects $A,B\in\mathcal A$ given by $A\to 0 \to B$. We call this the $0$ morphism.
Moreover if finite coproducts and finite products exists there is a canonical map $A\coprod B\to A\prod B$ arising from the diagram
\begin{equation}
    \begin{tikzcd}[column sep = huge]
        A \arrow[r,"\id_A"] \arrow[dr,near start,"0"] & A \\
        B \arrow[r,swap,"\id_B"] \arrow[ur,near start,swap,"0"] & B.
    \end{tikzcd}
\end{equation}
We call a category $\mathcal A$ \textit{semiadditive} if it has a zero object, finite products, finite coproducts and the canonical map $A\coprod B\to A\prod B$ is an isomorphism for all $A,B\in \mathcal A$.
In such a category we write $A\oplus B$ for the biproduct.

\begin{thm}
    Let $\mathcal A$ be a semiadditive category then it is naturally enriched over the monoidal category of commutative monoids.
\end{thm}
\begin{proof}
    Let $\Delta_A:A\oplus A\to A$ and $\nabla_A:A\to A\oplus A$ be the maps that make
    \begin{equation}
        \begin{tikzcd}
            A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"\id_A"] & & & & & A \\
                                                                & A\oplus A \arrow[r,dashed,"\Delta_A"] & A & A \arrow[r,dashed,"\nabla_A"] \arrow[urr,bend left=30,"\id_A"] \arrow[drr,bend right=30,"\id_A"] & A\oplus A \arrow[dr,"p_A'"] \arrow[ur,"p_A"] & \\
            A \arrow[ru,"i_A'"] \arrow[urr,bend right=30,"\id_A"] & & & & & A
        \end{tikzcd}
    \end{equation}
    commute.
    Given $f,g:A\to B$ we can construct a map $f\oplus g: A\oplus A\to B\oplus B$ in the obvious way.
    We can then define $f+g:A\to B$ to be the composite 
    \begin{equation}
        \begin{tikzcd}
            A \arrow[r,"\nabla_A"] & A \oplus A \arrow[r,"f\oplus g"] & B \oplus B \arrow[r,"\Delta_B"] & B.
        \end{tikzcd}
    \end{equation}
    Note that there is a map $t_A:A\oplus A\to A\oplus A$ arising from the diagram
    \begin{equation}
        \begin{tikzcd}[column sep = huge]
            A \arrow[r,"0"] \arrow[dr,near start,"\id_A"] & A \\
            A \arrow[r,swap,"0"] \arrow[ur,near start,swap,"\id_A"] & A.
        \end{tikzcd}
    \end{equation}
    It is then an easy check to see that $\Delta_A\circ t_A = \Delta_A$ and $t_A\circ \nabla_A = \nabla_A$, from which it follows that $+$ is commutative.
    Straightforward calculations also show that $+$ is associative, distributes over compositions and has the zero map as identity.
    The result follows.
\end{proof}
A functor between semiadditive categories is called semiadditive if it preserves zero objects and biproducts i.e. there are isomorphisms $F(A\oplus B) \cong F(A)\oplus F(B)$ such that 
\begin{equation}
    \begin{tikzcd}[column sep=large]
        F(A) \arrow[dr,"F(i_A)"] \arrow[drr,bend left=30,"i_{F(A)}"] &  \\
                                                             & F(A\oplus B) \arrow[r,"\cong"] & F(A)\oplus F(B)  \\
        F(B) \arrow[ur,"F(i_B)"] \arrow[urr,bend right=30,swap,"i_{F(B)}"] & 
    \end{tikzcd}
\end{equation}
commutes, and similarly for the projection maps.
\begin{proposition}
    \label{prop:sa}
    Let $F:\mathcal A\to\mathcal B$ be a semiadditive functor and $f,g:A\to B$ for $A,B\in\mathcal A$.
    Then $F(f+g) = F(f)+F(g)$.
\end{proposition}
\begin{proof}
    Obvious.
\end{proof}

We now define an additive category to be a semiadditive category where the enriched hom-sets are in fact groups.
\begin{thm}
    \label{thm:as}
    Let $\mathcal A$ be an additive category according to the first definition. 
    By theorem \ref{thm:atosa}, $\mathcal A$ is semiadditive and so the hom-sets naturally carry the structure of a commutative monoid.
    This monoidal structure agrees with the original group structure.
\end{thm}
\begin{proof}
    Let $A,B\in\mathcal A$ and $f,g:A\to B$.
    Then the addition arising from the semiadditive structure comes from the composition
    \begin{equation}
        \begin{tikzcd}
            A \arrow[r,"\nabla_A"] & A \oplus A \arrow[r,"f\oplus g"] & B \oplus B \arrow[r,"\Delta_B"] & B.
        \end{tikzcd}
    \end{equation}
    But $\nabla_A = i_A^L+i_A^R,\Delta_B = p_B^L+p_B^R$ and $f\oplus g = i_B^L\circ f\circ p_A^L + i_B^R\circ g\circ p_A^R$ and so their composition is just $f+g$.
\end{proof}
\begin{corollary}
    Let $F:\mathcal A\to \mathcal B$ be a functor between additive categoires. Then $F$ is additive iff $F$ it is semiadditive.
\end{corollary}
\begin{proof}
    Semiadditive $\implies$ additive follows from proposition \ref{prop:sa} and theorem \ref{thm:as}.
    Additive $\implies$ semiadditive is a straigtforward exercise.
\end{proof}
\begin{corollary}
    Let $F:\mathcal A\to\mathcal B$ be a functor between additive categories which is a left adjoint.
    Then $F$ is additive.
\end{corollary}
\begin{proof}
    $F$ preserves colimits and so is semiadditive.
\end{proof}
\begin{corollary}
    If $\mathcal A$ is an additive category then $\mathcal A^{op}$ is also additive.
\end{corollary}
\begin{proof}
    The oppositive category of a semiadditive category is clearly also semiadditive.
    The resulting monoidal structure on the hom-sets are also clearly the same and so the result follows.
\end{proof}
\section{Abelian categories}
Abelian categories are additive categories with more strucure. 
Before we state exactly what we mean by this we give some definitions.
\begin{definition}
    Let $\mathcal A$ be an additive category and $f:A\to B$ a morphism in $\mathcal A$.
    \begin{enumerate}
    \item A kernel of $f$ is an equaliser of \begin{tikzcd} A\arrow[r,shift right,swap,"0"] \arrow[r,shift left,"f"] & B\end{tikzcd}.
    \item A cokernel of $f$ is a coequaliser of the same diagram.
    \item $f$ is called monic if $f\circ g = 0$ implies $g=0$ for all $g$.
    \item $f$ is called epi if $g\circ f = 0$ implies $g=0$ for all $g$.
    \end{enumerate}
\end{definition}
\begin{remark}
    It is easy to see that all kernels are monic, all cokernels are epi, a map is monic iff its kernel is 0, and a map is epi iff its cokernel is 0.
\end{remark}
We call an additive category $\mathcal A$ pre-abelian if all morphisms have kernels and cokernels.
In such a category, given any morphism $f:A\to B$ we can form 
\begin{equation}
    \label{eq:canon-decomp}
    \begin{tikzcd}
        & & \ker(\coker(f)) \arrow[dr,"i"] & & \\
        K \arrow[r,"\ker(f)"] & A \arrow[rr,"f"] \arrow[ur,dashed,"\alpha"] \arrow[dr,"p"] & & B \arrow[r,"\coker(f)"] & C \\
                          & & \coker(\ker(f)) \arrow[ur,dashed,"\beta"] & & 
    \end{tikzcd}
\end{equation}
where $\alpha$ and $\beta$ exist from the universal property of kernels and cokernerls respectively.
Since $p$ is epi and $0 = \coker(f)\circ f = \coker(f)\circ \beta\circ p$ it follows that $\coker(f)\circ \beta = 0$ and so there is a map $\gamma:\coker(\ker(f))\to\ker(\coker(f))$ such that $i\circ \gamma = \beta$.
Similarly there is a map $\gamma':\coker(\ker(f))\to\ker(\coker(f))$ such that $\gamma'\circ p = \alpha$.
Using that $p$ is epi one can see that $\gamma'=\gamma$ and so for any morphism $f$ there is a canonical decomposition
\begin{equation}
    A\xrightarrow{p} \coker(\ker(f)) \xrightarrow{\gamma_f} \ker(\coker(f)) \xrightarrow{i} B.
\end{equation}
An abelian category is a pre-abelian category in which $\gamma_f$ is an isomorphism for every $f$.
\begin{thm}
    \label{thm:abcat}
    Let $\mathcal A$ be a pre-abelian category.
    Then $\gamma_f$ is an isomorphism for all morphism $f$ iff every monic is the kernel of its cokernel and every epi is the cokernel of its kernel.
\end{thm}
\begin{proof}
    $(\Rightarrow)$ The kernel of a monic is the $0$ object with the $0$ map, and the cokernel of this is just $A$ together with the identity.
    Thus, if $\gamma_f$ is an isomorphism the canonical decomposition of $f$ just becomes
    \begin{equation}
        A\xrightarrow{\id} A \xrightarrow{\cong} \ker(\coker(f)) \xrightarrow{i} B
    \end{equation}
    and so $f$ is the kernel of its cokernel. 
    Similarly one obtains that if $f$ is epi it is the cokernel of its kernel.
    
    $(\Leftarrow)$ First note that if a kernel is epi then it must be an isomorphism so all epic monics must be isomorphisms (since all monics are kernels).
    Thus, it suffices to show that the maps $\alpha$ and $\beta$ in equation \ref{eq:canon-decomp} are epi and monic respectively.
    To see that $\beta$ is monic let $x:X\to \coker(\ker(f))$ be a map such that $\beta\circ x = 0$.
    Then let $q:\coker(\ker(f))\to\coker(x)$ be the coker of $x$, and $j:\coker(x)\to B$ the map such that $j\circ q = \beta$.
    Finally let $l:\ker(q\circ p)\to A$ be the kernel of $q\circ p$.
    Then we have the following diagram
    \begin{equation}
        \begin{tikzcd}
            \ker(q\circ p) \arrow[dr,"l"] \arrow[dd,dashed] & & & \\
            & A \arrow[rr,"f"] \arrow[dr,"p"] & & B \\
            \ker(f) \arrow[ru,"k"] & & \coker(\ker(f)) \arrow[dr,"q"] \arrow[ur,"\beta"] & \\
                               & X \arrow[ru,"x"] & & \coker(x). \arrow[uu,"j"]
        \end{tikzcd}
    \end{equation}
    Since $q\circ p$ is epi it is the coker of $l$.
    But also $f\circ l = j\circ q\circ p\circ l = 0$, so $l$ factors through $\ker(f)$ and so $p\circ l=0$.
    Thus there exists $p':\coker(x)\to\coker(\ker(f))$ such that
    \begin{equation}
        \begin{tikzcd}
            \ker(q\circ p) \arrow[r,"l"] & A \arrow[r,"p"] \arrow[d,"q\circ p"] & \coker(\ker(f)) \\
                                     & \coker(x) \arrow[ur,dashed,swap,"p'"]
        \end{tikzcd}
    \end{equation}
    commutes.
    Since $p$ is epi, it must follow that $p'\circ q = \id$.
    Thus $q$ is monic and so $x=0$.
    It follows that $\beta$ is monic.
    Similarly one can show that $\alpha$ is epi.
\end{proof}
It follows that an abelian category is equvalently a pre-abelian category in which every monic is the kernel of its cokernel and every epi is the cokernel of its kernel.
\begin{thm}
    If $\mathcal A$ is an abelian category then $\mathcal A^{op}$ is also an abelian category.
\end{thm}
\begin{proof}
    It is certainly additive.
    Moreover, kernels and cokernels simply swap roles.
    $\gamma_f$ is then still an isomorphism for all $f$ and so $\mathcal A^{op}$ is abelian.
\end{proof}
From now on we write $\im(f) := \ker(\coker(f))$ and $\coim(f) := \coker(\ker(f))$.
\section{Exact sequences}
\label{sec:es}
Let $\mathcal A$ be an abelian category and $\mathcal S$ be the category with objects given by $A\xrightarrow{f} B\xrightarrow{g} C$ such that $g\circ f = 0$, and morphisms given by chain maps.
Recall from earlier that $f$ can be factored as
\begin{equation}
    \begin{tikzcd}
        A \arrow[r,twoheadrightarrow,"p_f"] & \im(f) \arrow[r,hookrightarrow,"i_f"] & B.
    \end{tikzcd}
\end{equation}
Since $p_f$ is epi, we must have $g\circ i_f = 0$.
Thus we can factor $f$ further through $\ker(g)$ to obtain $f:A\to\im(f)\to\ker(g)\to B$.
Let $H(A\xrightarrow{f} B\xrightarrow{g} C)$ be the cokernel of the morphism $\im(f)\to\ker(g)$.
If we have the commutative diagram
\begin{equation}
    \begin{tikzcd}
        A \arrow[r,"f"] \arrow[d] & B \arrow[r,"g"] \arrow[d] & C \arrow[d] \\
        A' \arrow[r,"f'"] & B' \arrow[r,"g'"] & C'
    \end{tikzcd}
\end{equation}
then there exists maps so that 
\begin{equation}
    \begin{tikzcd}
        A \arrow[r] \arrow[d] & \im(f) \arrow[r] \arrow[d] & \ker(g) \arrow[r] \arrow[d] & B \arrow[r] \arrow[d] & C \arrow[d] \\
        A' \arrow[r] & \im(f') \arrow[r] & \ker(g') \arrow[r] & B' \arrow[r] & C'
    \end{tikzcd}
\end{equation}
commutes.
In particular there is a morphism 
\begin{equation}
    \coker(\im(f)\to\ker(g))\to\coker(\im(f')\to\ker(g')).
\end{equation}
It is easy to check that this construction is functorial and so we obtain a functor $H:\mathcal S\to \mathcal A$.

One can similarly construct a functor $H':\mathcal S\to\mathcal A$ by considering 
\begin{equation}
    \ker(\coker(f)\to\coim(g))
\end{equation}
instead.
\begin{remark}
    We may also form a functor by looking simply at the fact that $f$ factors through $\ker(g)$ and then looking at the coker of the resulting morphism $A\to\ker(g)$. It is an easy check to see that this yields a functor naturally isomorphic to $H$. Similarly for $H'$.
\end{remark}
\begin{lemma}
    Let $A\xrightarrow{f} B\xrightarrow{g} C\in\mathcal S$.
    Recall that we have the factorisation 
    \begin{equation}
        A\rightarrow \im(f) \rightarrow \ker(g)\xrightarrow{i_g} B \xrightarrow{p_f} \coker(f) \rightarrow \coim(g) \rightarrow C.
    \end{equation}
    Let $h$ be the composition $\ker(g)\to B \to\coker(f)$.
    Then
    \begin{enumerate}
        \item $\ker(h) = \im(f)\to\ker(g)$
        \item $\coker(h) = \coker(f)\to\coim(g)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Let $l:C\to \ker(g)$ be such that $h\circ l = 0$.
    Then $p_f \circ i_g \circ l = 0$ and so $i_g \circ l$ factors through $\im(f)$.
    Since $i_g$ is monic it follows that $l$ factors through $\im(f)$.
    Uniqueness follows automatically.
    Thus the result follows.
    The second part follows similarly.
\end{proof}
\begin{thm}
    The functors $H,H':\mathcal S\to\mathcal A$ are naturally isomorphic.
\end{thm}
\begin{proof}
    Let $S := A\xrightarrow{f} B\xrightarrow{g} C\in\mathcal S$ and $h$ be as in the lemma.
    Then $H(S) = \coker(\ker(h))$ and $H'(S) = \ker(\coker(h))$ so we obtain the factorisation
    \begin{equation}
        \ker(g) \to H(S) \xrightarrow{\cong} H'(S) \to \coker(f).
    \end{equation}
    Naturality of the isomophism then follows from naturality of this factorisation.
\end{proof}
\begin{remark}
    In a pre-abelian category we still have a natrual transformation $H\Rightarrow H'$, but it might not be an isomorphism.
\end{remark}
\begin{definition}
    Let $S := A\xrightarrow{f} B\xrightarrow{g} C\in\mathcal S$.
    We say that $S$ is exact at $B$ if $H(S) = 0$.
\end{definition}
\begin{proposition}
    $0\rightarrow A \xrightarrow{f} B \xrightarrow{g} C \rightarrow 0$ is a short exact sequence iff $A = \ker(g)$ and $C = \coker(f)$.
\end{proposition}
\begin{proof}
    $(\Rightarrow)$ We have $\ker(g) \cong \im(f) \cong A$ and $\coker(f) \cong \coim(g) \cong C$.

    $(\Leftarrow)$ Certainly have exactness at $A$ and $C$. Exactness at $B$ also holds.
\end{proof}
\subsection{Split sequences}
\begin{thm}
    Let $0\rightarrow A \xrightarrow{f} B \xrightarrow{g} C \rightarrow 0$ be a short exact sequence.
    The following are equivalent
    \begin{enumerate}
        \item there exists $q:B\to A$ such that $q\circ f = \id_A$
        \item there exists $p:C\to B$ such that $g\circ p = \id_C$
        \item there is an isomorphism $h:B\to A\oplus C$ such that $h\circ f$ and $g\circ h^{-1}$ are the natural inclusion and projection respectively.
    \end{enumerate}
\end{thm}
\begin{proof}
    $(3)$ certainly implies both $(1)$ and $(2)$.

    $(2)\Rightarrow(3)$ Let $q:B\to A$ be the unique map making the following diagram commute
    \begin{equation}
        \begin{tikzcd}
            A \arrow[r,"f"] & B \arrow[r,"g"] & C. \\
            B \arrow[ur,swap,"\id_B-p\circ g"] \arrow[u,dashed,"q"] & &
        \end{tikzcd}
    \end{equation}
    Then $\id_B = p\circ g + f\circ q$.
    It follows that $p = f\circ q\circ p + p$.
    Since $f$ is monic we have $q\circ p = 0$.
    Thus $q = q\circ f\circ q$ and so since $q$ is epi, $q\circ f = \id_A$.
    The result follows. $(1)\Rightarrow(3)$ follows similarly.
\end{proof}
\begin{corollary}
    Let $F:\mathcal A\to \mathcal B$ be an additive functor of abelian categories.
    Then $F$ applied to a split short exact sequence is also split exact.
\end{corollary}
\begin{proposition}
    Let $0\rightarrow A \xrightarrow{f} B \xrightarrow{g} C \rightarrow 0$ be a short exact sequence.
    If either
    \begin{enumerate}
        \item $A$ is injective or 
        \item $C$ is projective
    \end{enumerate}
    then the sequence is split.
\end{proposition}
\section{Adjoint functors}
Let $L:\mathcal A\to\mathcal B$ be an additive functor between abelian categories.
If $L$ admits a right adjoint $R:\mathcal B\to\mathcal A$ then it turns out $L$ has a lot of useful properties. 
In this section we explore these properties.
\begin{proposition}
    Suppose $L\dashv R$. Then $L$ is right exact and $R$ is left exact.
\end{proposition}
\begin{proof}
    Consider the short exact sequence $0\to B_1\to B_2\to B_3\to 0$. For every $A\in\mathcal A$ we get the following commutative diagram 
    \begin{equation}
        \begin{tikzcd}
            0 \arrow[r] & \Hom(L(A),B_1) \arrow[r] \arrow[d,"\cong"] & \Hom(L(A),B_2) \arrow[r] \arrow[d,"\cong"] & \Hom(L(A),B_3) \arrow[d,"\cong"] \\
            0 \arrow[r] & \Hom(A,R(B_1)) \arrow[r] & \Hom(A,R(B_2)) \arrow[r] & \Hom(A,R(B_3))
        \end{tikzcd}
    \end{equation}
    where the top row is exact.
    It follows that the bottom row is exact for all $A$ and so the bottow row is too.
    It follows that 
    \begin{equation}
        \begin{tikzcd}
            0 \arrow[r] & R(B_1) \arrow[r] & R(B_2) \arrow[r] & R(B_3)
        \end{tikzcd}
    \end{equation}
    is exact and so $R$ is left exact.
    By a similar argument $L$ is right exact.
\end{proof}
\begin{proposition}
    Suppose $L\dashv R$. Then
    \begin{enumerate}
        \item if $L$ is exact then $R$ preserves injectives
        \item if $R$ is exact then $L$ preserves projectives.
    \end{enumerate}
\end{proposition}
\begin{proof}
    Suppose $L$ is exact and $I$ is an injective object in $\mathcal B$.
    We need to show that $\Hom(-,R(I))$ is exact.
    To do this it suffices to show that given $f:A\to B$ injective, the map $f^*:\Hom(B,R(I))\to\Hom(A,R(I))$ is surjective.
    But $L$ is exact so $Lf$ is injective and so $(Lf)^*:\Hom(LB,I)\to\Hom(LA,I)$ is surjective.
    We also have that $L\dashv R$ and so 
    \begin{equation}
        \begin{tikzcd}
            \Hom(L(B),I) \arrow[d,"\cong"] \arrow[r,"(Lf)^*"] & \Hom(L(A),I) \arrow[d,"\cong"] \\
            \Hom(B,R(I)) \arrow[r,"f^*"] & \Hom(A,R(I))
        \end{tikzcd}
    \end{equation}
    commutes.
    It follows that $f^*$ is surjective as required.

    The corresponding result for $R$ follows similarly.
\end{proof}
\section{Limits and derived functors}
\begin{proposition}
    An abelian category $\mathcal A$ is cocomplete iff it has all direct sums.
\end{proposition}
\begin{proof}
    We already have kernels and hence equalisers so the statement follows.
\end{proof}
\begin{remark}
    The same result holds if we replace direct sums with product and cocomplete with complete.
\end{remark}
\begin{thm}
    Let $\mathcal A$ be a cocomplete abelian category with enough projectives.
    If $F:\mathcal A \to \mathcal B$ is a left adjoint, then for every set $\{A_i\}$ of objects in $\mathcal A$ we have
    \begin{equation}
        L_*F\left(\bigoplus_{i\in I}A_i\right) \cong \bigoplus_{i\in I} L_*F(A_i).
    \end{equation}
\end{thm}
\begin{proof}
    Let $P_i\to A_i$ be projective resolutions.
    Then $\oplus_iP_i\to \oplus_iA_i$ is also a projective resolution.
    Hence
    \begin{equation}
        L_*F(\oplus_iA_i) = H_*(F(\oplus_iP_i)) \cong H_*(\oplus_iF(P_i)) \cong \oplus_iH_*(F(P_i)) = \oplus_iL_*F(A_i).
    \end{equation}
\end{proof}
\subsection{Filtered colimits}
\begin{definition}
    A category $I$ is called filtered if it has coproduct and coequaliser diagrams.
    A filtered colimit is the colimit of a functor from a filtered category.
\end{definition}
\begin{lemma}
    Let $I$ be a filtered category, and $A:I\to \Mod-R$. Then
    \begin{enumerate}
        \item Every element $a\in\colim_I A$ is the image of some element $a_i\in A_i$ for some $i\in I$ under the canonical map $A_i\to \colim_I A$.
        \item For every $i$, the kernel of the canonical map $A_i\to \colim_I A$ is the union of the kernels of the maps $A(\phi):A_i\to A_j$ for $\phi:i\to j$ in $I$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Use the explicit construction of the colimit as the cokernel of
    \begin{equation}
        \bigoplus_{i\to j}A_i \to \bigoplus_iA_i.
    \end{equation}
\end{proof}
\begin{thm}
    Filtered colimits of $R$-modules are exact considered as functors from $\Fun(I,\Mod-R)$ to $\Mod-R$.
\end{thm}
\begin{proof}
    We know that $\colim$ is a left adjoint and so is right exact. 
    It thus suffices to show that if $t:A\to B$ is monic then $\colim_IA\to\colim_IB$ is too.
    But this follows immediately from the previous proposition.
\end{proof}
\begin{definition}
    We say an abelian category $\mathcal A$ satisfies axiom (AB5) if it is cocomplete and filtered colimits are exact.
\end{definition}
\begin{thm}
    Let $\mathcal A$ be an abelian category satisfying axiom (AB5).
    Then for $F:\mathcal A\to \mathcal B$ a left adjoint, we have that for all filtered $I$,
    \begin{equation}
        L_*F(\colim_IA) \cong \colim_I L_*F(A_i).
    \end{equation}
\end{thm}
\begin{proof}
    $\colim_I$ is exact so commutes with $H_i$.
    The rest of the proof is similar to the direct sum proof.
\end{proof}
\chapter{Sheaf Theory}
\label{ch:sheafs}
\section{Presheaves}
Let $\mathcal C$ be any category, $\mathcal A$ be an abelian category and define $\PreSh(\mathcal C) = \Fun(\mathcal C^{op},\mathcal A)$ to be the category of presheaves on $\mathcal C$ with values in $\mathcal A$.
The functor sending all objects to $0$ is certainly both initial and terminal, direct sums can be defined pointwise, and the hom-sets in $\PreSh(\mathcal C)$ inherit an additive structure from $\mathcal A$ so $\PreSh(\mathcal C)$ is naturally an additive category.
Moreover kernels and cokernels can be contructed in the obvious way and it is clear that they satisfy the axioms for an abelian category and so $\PreSh(C)$ is abelian.
\section{Sheaves}
To define sheaves we restrict to the case when $X$ be a topological space, $\mathcal U$ the poset of open sets of X, and $\mathcal A$ be an abelian category.
We write $\PreSh(X)$ for $\PreSh(\mathcal U)$.
The category of sheaves on $X$ with values in $\mathcal A$, $\Sh(X)$, is defined to be the full subcategory of $\PreSh(X)$ with objects given by presheaves $\shf{F}$ for which the following diagram is an equalizer for all open coverings $U = \cup_i U_i$
\begin{equation}
\shf{F}(U)\rightarrow \prod_i \shf{F}(U_i) \rightrightarrows \prod_{i,j} \shf{F}(U_i\cap U_j).
\end{equation}
Since $\mathcal A$ is an abelian category this is equivalent to the following diagram being exact
\begin{equation}
0\rightarrow \shf{F}(U)\rightarrow \prod_i \shf{F}(U_i) \xrightarrow[]{\text{diff}} \prod_{i,j} \shf{F}(U_i\cap U_j).
\end{equation}
Note that since $\varnothing$ admits the empty covering and the empty product is $0$ this forces $\shf{F}(\varnothing) = 0$.

As in the case of $\PreSh(\mathcal C)$, $\Sh(X)$ is an additive category.
However, the cokernel of a morphism between sheaves need not be a sheaf and so we must do some more work to show that $\Sh(X)$ is abelian.

Fix $x\in X$.
For a (pre)sheaf $\shf{F}$ define the stalk of $\shf{F}$ at $x$ to be 
\begin{equation}
    \shf{F}_x = \varinjlim_{U\ni x}\shf{F}
\end{equation}
when this limit exists. Note that this is a functor since morphisms between (pre)sheaves are natural transformations.
\begin{thm}
    Let $\phi:\shf{F}\to \shf{G}$ be a morphism of sheaves.
    \begin{enumerate}
        \item If $\phi_x$ is injective for all $x\in X$ then $\phi$ is injective on sections.
        \item If $\phi_x$ is an isomorphism for all $x\in X$ then $\phi$ is an isomorphism.
    \end{enumerate}
\end{thm}
\begin{proof}
Exercise.
\end{proof}
\begin{proposition}
    Let $\shf{F},\shf{G}$ be presheaves and $\phi,\psi:\shf{F}\to\shf{G}$ be morphisms that are equal on stalks.
    If $\shf{G}$ satisfies sheaf condition (A) then $\phi = \psi$.
\end{proposition}
\begin{proof}
    Consider $\phi-\psi$.
\end{proof}
\subsubsection{Aside}
Although we do not need this right away, given an $A\in \mathcal A$ we can define the (pre)sheaf $x_*A$ by 
\begin{equation}
    (x_*A)(U) = \begin{cases}
        A & \textit{if } x\in U \\
        0 & otherwise
    \end{cases}
\end{equation}
\begin{proposition}
    When it exists, the functor $(-)_x:\Sh(X)\to \mathcal A$ is left adjoint to $x_*:\mathcal A\to \Sh(X)$.
\end{proposition}
\begin{proof}
    To see this simply note that morphisms between $\shf{F}$ and $x_*(A)$ correspond naturally to natrual transformations between $\shf{F}$ restricted to $U\ni x$ and $\Delta(A)$.
\end{proof}
\begin{remark}
    The result also holds in $\PreSh(X)$.
\end{remark}
\section{\'Etal\'e space of a presheaf and sheafification}
For a presheaf $\shf{F}$ we are now in the position to define its \'etal\'e space.
The \'etal\'e space of $\shf{F}$, denoted $\Spe(\shf{F})$ is the topological space with underlying set $\amalg_{x\in X}\shf{F}_x$ and topology generated by the basis of sets given by $\{s_x|x\in U\}$ for $s\in \shf{F}(U)$ where $U\subset X$ is open.
Together with this space there is also a natural continuous map $\pi:\Spe(\shf{F})\to X$ sending an element $s_x$ to $x$.
The sheafification of $\shf{F}$, denoted $\shf{F}^+$, is then defined to be the sheaf of sections of $\pi:\Spe(\shf{F})\to X$.
By unwrapping the definitions we see that the sections can be characterised as
\begin{align}
    \shf{F}^+(U) = \{s:U\to\amalg_{x\in U}\shf{F}_x : & \forall x\in U, \exists V\subset U \text{ open containing $x$ and } \nonumber \\
                                                            & t\in\shf{F}(V) \text{ s.t. }  s(y) = t_y \forall y\in V\}
\end{align}
In particular there is a natural morphism $\shf{F} \to \shf{F}^+$ sending $s\in \shf{F}(U)$ to the section $x\mapsto s_x$ which is an isomorphism on stalks.
From the characterisation of sections it clear that if $\shf{F}$ is a presheaf of $\AbGrp,\Ring,...$ then $\shf{F}^+$ is a sheaf with values in the corresponding abelian category.

We have defined $\Spe$ and $(-)^+$ on objects but they can also be turned into functors.
If we have a morphism $\phi:\shf{F}\to\shf{G}$ between presheaves, this induces a continuous map $\Spe(\phi):\Spe(\shf{F})\to \Spe(\shf{G})$ given by $s_x\mapsto\phi_x(s_x)$ so that 
\begin{equation}
    \begin{tikzcd}
        \Spe(\shf{F}) \arrow[rr, "\Spe(\phi)"] \arrow[rd,"\pi"] & & \Spe(\shf{G}) \arrow[dl,"\pi"] \\
                                              & X &
    \end{tikzcd}
\end{equation}
commutes.
This construction is functorial and turns $\Spe$ into a functor from presheaves to topological bundles over $X$.
\begin{remark}
    The natural map $\shf{F}\to \shf{F}^+$ induces a homeomorphism $\Spe(\shf{F}) \to \Spe(\shf{F}^+)$.
\end{remark}
It follows that we also obtain a map of sheaves $\phi^+:\shf{F}^+\to\shf{G}^+$ by composing sections with $\Spe(\phi)$.
Thus we have a functor $(-)^+:\PreSh(X)\to\Sh(X)$ and in fact the following diagram commutes.
\begin{equation}
    \label{eq:sheafif}
    \begin{tikzcd}
        \shf{F}^+ \arrow[r,"\phi^+"] & \shf{G}^+ \\
        \shf{F} \arrow[u] \arrow[r,"\phi"] & \shf{G} \arrow[u]
    \end{tikzcd}
\end{equation}
Note that since the morphism $\shf{F}\to\shf{F}^+$ is an isomorphism when $\shf{F}$ is a sheaf, this says that the functor $(-)^+$ restricted to $\Sh(X)$ is natrually isomorphic to the identity functor.

\begin{thm}
    Let $\theta:\shf{F}\to\shf{F}^+$ be the natural morphism. 
    Then for any morphism of presheaves $\phi:\shf{F}\to \shf{G}$ with $\shf{G}$ a sheaf, there exists a unique morphism of sheaves $\psi:\shf{F}^+\to\shf{G}$ so that 
    \begin{equation}
        \begin{tikzcd}
            \shf{F}^+ \arrow[r,"\psi"] & \shf{G} \\
            \shf{F} \arrow[ur,"\phi"] \arrow[u,"\theta"]
        \end{tikzcd}
    \end{equation}
    commutes.
\end{thm}
\begin{proof}
    This just follows from equation \ref{eq:sheafif}, the fact that $\theta:\shf{G}\to\shf{G}^+$ is an isomorphism when $\shf{G}$ is a sheaf, and by taking stalks.
\end{proof}
\begin{corollary}
    The sheafification functor is left adjoint to the inclusion functor $\iota:\Sh(X)\to\PreSh(X)$.
\end{corollary}
\begin{proof}
    Let $\shf{F}$ be a presheaf and $\shf{G}$ be a sheaf.
    Given a morphism $\phi:\shf{F}^+\to\shf{G}$ we can precompose it with $\theta:\shf{F}\to\shf{F}^+$ to obtain a map $\shf{F}\to\iota\shf{G}$.
    Conversely, given $\psi:\shf{F}\to\iota\shf{G}$, we obtain a map $\shf{F}^+\to \shf{G}$ from the theorem.
    Then the theorem says these operations are inverse so we have a bijection 
    \begin{equation}
        \Hom(\shf{F}^+,\shf{G}) \cong \Hom(\shf{F},\iota\shf{G}).
    \end{equation}
    Naturality is then an easy check.
\end{proof}
\begin{corollary}
    The sheafification functor is exact.
\end{corollary}
\begin{proof}
    It is a left adjoint so it is right exact.
    It thus suffices to show that if $\phi:\shf{F}\to\shf{G}$ is injective then so is $\phi^+$.
    For this it suffices to show that $\phi_x$ is injective for all $x$.
    But this is obvious.
\end{proof}
We can now define the cokernel of a morphism $\phi:\shf{F}\to\shf{G}$ in $\Sh(X)$.
We simply define it to be the sheafification of the cokernel in $\PreSh(X)$ and it is an easy to check to see that this is indeed a cokernel object in $\Sh(X)$.
It is then easy to see that $\ker\coker = \coker\ker$ by looking at stalks and so $\Sh(X)$ is an abelian category.
\begin{remark}
    While $\Sh(X)$ is a full subcategory of $\PreSh(X)$ that is abelian, it is not a full abelian subcategory.
\end{remark}
\section{Maps defined on a basis}
\begin{thm}
    Let $\shf{F},\shf{G}$ be sheafs on $X$ and let $\mathcal B$ be a basis for the topology on $X$.
    Then any morphism $\phi|_{\mathcal B}:\shf{F}|_{\mathcal B} \to \shf{G}|_{\mathcal B}$ extends uniquely to a morphism $\phi:\shf{F}\to \shf{G}$.
    Moreover this procedure is functorial.
\end{thm}
\begin{proof}
    There is a natural isomorphism between $\varinjlim_{U\ni x}\shf{F}$ and $\varinjlim_{B\ni x}\shf{F}$. 
    Thus we obtain a map $\phi:=\phi|_{\mathcal B}^+:\shf{F}\to \shf{G}$.
    It is clear that this is a morphism of sheaves.
    Moreover for $U\in\mathcal B$ and $s\in\shf{F}(U)$ it is clear that $\phi(U)(s)$ and $\phi|_{\mathcal B}(U)(s)$ have the same stalks and so must be equal.
    Thus $\phi$ extends $\phi|_{\mathcal B}$.
    Finally, if a morphism extends $\phi|_{\mathcal B}$ then it is determined on stalks and hence must equal to $\phi$, which gives us uniqueness.
    Functoriality is clear.
\end{proof}
\section{Exact sequences}
Now that we know that we are working in an abelian category we can talk about exact sequences in $\Sh(X)$.
Recall from section \ref{sec:es} that $\shf{F}\xrightarrow{\theta}\shf{G}\xrightarrow{\phi}\shf{H}$ is exact at $\shf{G}$ if $\phi\circ\theta=0$ and the map induced map $\im(\theta)\to\ker(\phi)$ is an isomorphism.
But the map $\im(\theta)\to\ker(\phi)$ is an isomorphism iff it is an isomorphism at the level of stalks iff $\shf{F}_x\xrightarrow{\theta_x}\shf{G}_x\xrightarrow{\phi_x}\shf{H}_x$ is exact for all $x\in X$.
Thus $(-)_x$ is an exact functor and exactness in $\Sh(X)$ can be verified by checking exactness at all the stalks.
\section{Direct sums of sheaves}
If $\mathcal A$ has direct sums, then so does $\PreSh(X)$ since we can compute the direct sum pointwise.
It follows that $\PreSh(X)$ is cocomplete.
The sheafification of the direct sum in $\PreSh(X)$ gives us a direct sum in $\Sh(X)$ and hence $\Sh(X)$ is also cocomplete.

We also have products in both $\PreSh(X)$ and $\Sh(X)$ (computed pointwise) and so they are also both complete.
\section{Sheaves over different spaces}
\subsection{Direct image sheaf}
Let $f:X\to Y$ be a continuous map between topological spaces and $\shf{F}$ a sheaf on $X$.
We define the direct image of $\shf{F}$ under $f$ to be the sheaf $f_*\shf{F}$ on $Y$ defined by $f_*\shf{F}(U) = \shf{F}(f^{-1}(U))$.
If we define $f_*$ on morphisms in the obvious way then it is clear that we obtain a functor $f_*:\Sh(X)\to\Sh(Y)$.
In fact we also obtain a functor $f_*:\PreSh(X)\to\PreSh(Y)$ and it turns out this functor has nice left adjoint.

Define $\lim_f:\PreSh(Y)\to\PreSh(X)$ to be the functor that sends $\shf{F}\in \PreSh(Y)$ to the presheaf $\lim_f(\shf{F})(U) = \varinjlim_{V\supset f(U)}\shf{F}(V)$ on $X$, and does the obvious things to morphisms.
\begin{thm}
    $\lim_f\dashv f_*$ as functors between $\PreSh(X)$ and $\PreSh(Y)$.
\end{thm}
\begin{proof}
    Let $\phi:\lim_f\shf{F}\to \shf{G}$ be a morphism of presheaves.
    For $V$ open in $Y$, $f^{-1}(V)$ is open in $X$ and so we have maps
    \begin{equation}
        \shf{F}(V)\to\varinjlim_{W\supset f(U)}\shf{F}(W) \to \shf{G}(U)
    \end{equation}
    where $U=f^{-1}(V)$.
    If $V'\subset V$, $U = f^{-1}(V)$ and $U'=f^{-1}(V')$ then
    \begin{equation}
        \begin{tikzcd}
            \shf{F}(V) \arrow[r] \arrow[d] \arrow[dr] & \displaystyle\varinjlim_{W\supset f(U)}\shf{F}(W) \arrow[r] \arrow[d] & \shf{G}(U) \arrow[d] \\
            \shf{F}(V') \arrow[r] & \displaystyle\varinjlim_{W\supset f(U')}\shf{F}(W) \arrow[r] & \shf{G}(U')
        \end{tikzcd}
    \end{equation}
    commutes and so these maps in fact define a morphism $\shf{F}\to f_*\shf{G}$.

    Conversely suppose we are given a morphism $\shf{F}\to f_*\shf{G}$.
    Let $U$ be open in $X$.
    For $V\supset f(U)$ we have maps
    \begin{equation}
        \shf{F}(V)\to \shf{G}(f^{-1}(V)) \to \shf{G}(U).
    \end{equation}
    Moreover if $V\supset V'\supset f(U)$ then
    \begin{equation}
        \begin{tikzcd}[column sep=tiny,row sep=tiny]
            \shf{F}(V) \arrow[r] \arrow[dd] & \shf{G}(f^{-1}(V)) \arrow[dd] \arrow[dr] & \\ 
                                 & & \shf{G}(U) \\
            \shf{F}(V') \arrow[r] & \shf{G}(f^{-1}(V')) \arrow[ur] & \\ 
        \end{tikzcd}
    \end{equation}
    commutes so we obtain maps $\varinjlim_{V\supset f(U)}\shf{F}(V)\to\shf{G}(U)$.
    If $U\supset U'$ we have maps
    \begin{equation}
        \begin{tikzcd}
            \displaystyle \varinjlim_{V\supset f(U)}\shf{F}(V) \arrow[r] \arrow[d] & \shf{G}(U) \arrow[d] \\ 
            \displaystyle \varinjlim_{V\supset f(U')}\shf{F}(V) \arrow[r] & \shf{G}(U').
        \end{tikzcd}
    \end{equation}
    A straighforward calculation shows that this commutes and so we obatin a morphism $\lim_f\shf{F}\to\shf{G}$.

    These operations are clearly inverse to each other.
    A straightforward calculation shows that the bijection is natural.
\end{proof}
\begin{corollary}
    $\lim_f$ is an exact functor.
\end{corollary}
\begin{proof}
    It is a left adjoint so it is right exact. 
    Thus it suffices to show that it sends injective maps to injective maps. But this is obvious.
\end{proof}
\subsubsection{Stalks}
\begin{proposition}
    Let $\shf{F}$ be a sheaf on $X$ and $f:X\to Y$ a continuous map.
    Then there is a natural map $(f_*\shf{F})_{f(p)} \to \shf{F}_p$ in the sense that if $\shf{G}$ is another sheaf on $X$ and $\phi:\shf{F}\to \shf{G}$ is a morphism then
    \begin{equation}
        \begin{tikzcd}[column sep = huge]
            (f_*\shf{F})_{f(p)} \arrow[r,"(f_*\phi)_{f(p)}"] \arrow[d] & (f_*\shf{G})_{f(p)} \arrow[d] \\
            \shf{F}_p \arrow[r,"\phi_p"] & \shf{G}_p
        \end{tikzcd}
    \end{equation}
    commutes.
\end{proposition}
\begin{proof}
    We have
    \begin{equation}
        (f_*\shf{F})_{f(p)} = \varinjlim_{U\ni f(p)} f_*\shf{F}(U) = \varinjlim_{U:f^{-1}(U)\ni p}\shf{F}(f^{-1}(U)).
    \end{equation}
    But $\{U:f^{-1}(U)\ni p\}\subseteq \{V:V\ni p\}$ and so there is map 
    \begin{equation}
        (f_*\shf{F})_{f(p)} = \varinjlim_{U:f^{-1}(U)\ni p}\shf{F}(f^{-1}(U)) \to \varinjlim_{V\ni p}\shf{F}(V) = \shf{F}_p.
    \end{equation}
    Naturality is an easy exercise.
\end{proof}
\subsection{Inverse image sheaf}
Let $f:X\to Y$ be a continuous map between topological spaces and $\shf{F}$ a sheaf on $Y$.
Let $f^{-1}\Spe(\shf{F})$ be the pullback 
\begin{equation}
    \begin{tikzcd}
        f^{-1}\Spe(\shf{F}) \arrow[r,dashed] \arrow[d,dashed,"\pi"] \arrow[dr, phantom, "\lrcorner", very near start] & \Spe(\shf{F}) \arrow[d,"\pi"] \\
        X \arrow[r,"f"] & Y.
    \end{tikzcd}
\end{equation}
We define the inverse image sheaf $f^{-1}\shf{F}$ to be the sheaf of sections of $\pi:f^{-1}\Spe(\shf{F})\to X$.
Equivalently, it is the sheaf
\begin{equation}
    \label{eq:invimg}
    f^{-1}\shf{F}(U) = \left\{s:U\to\Spe(\shf{F}): 
    \begin{tikzcd}
        & \Spe(\shf{F}) \arrow[d,"\pi"] \\
        U \arrow[r,"f|_U"] \arrow[ur,"s"] & Y
    \end{tikzcd} 
    \text{ commutes }
    \right\}
\end{equation}
or also equivalently, the sheaf
\begin{align}
    f^{-1}\shf{F}(U) = \{s:U\to\amalg_{x\in U}\shf{F}_{f(x)} : & \forall x\in U, \exists W\subset Y, V\subset f^{-1}(W)\cap U \text{ open and} \nonumber \\
                                                             & t\in\shf{F}(W) \text{ s.t. } x\in V \wedge  s(y) = t_{f(y)} \forall y\in V\}.
\end{align}
It is clear from the construction that we obtain a functor $f^{-1}:\Sh(Y)\to\Sh(X)$.
\begin{remark}
    A direct calculation shows that $f^{-1}\shf{F}_x$ and $\shf{F}_{f(x)}$ are naturally isomorphic and so there is a natrual bijection between $f^{-1}\Spe(\shf{F})$ and $\Spe(f^{-1}\shf{F})$.
    It is then a straightforward exercise to check that this bijection is in fact a homeomorphism i.e. $f^{-1}\Spe(\shf{F})\cong\Spe(f^{-1}\shf{F})$.
\end{remark}
\begin{thm}
    $f^{-1}$ is naturally isomorphic to $(-)^+\circ \lim_f$ as functors $\PreSh(Y)\to \Sh(X)$.
\end{thm}
\begin{proof}
    Let $U$ be an open subset of $X$ and $s\in\lim_f\shf{F}(U)$.
    There is a natural map $\phi_x:(\lim_f\shf{F})_x\to\shf{F}_{f(x)}$ so we can define a map $U\to\Spe(\shf{F})$ by $x\mapsto \phi_x(s_x)$.
    It is clear that this gives an element of $f^{-1}\shf{F}(U)$ as characterised by equation \ref{eq:invimg}.
    Thus we obtain a morphism $\lim_f\shf{F}\to f^{-1}\shf{F}$.
    On stalks this map is given by $\phi_x$.
    A direct calculation shows that $\phi_x$ is an isomorphism for all $x\in X$ and so the induced map $(\lim_f\shf{F})^+\to f^{-1}\shf{F}$ must be an isomorphism.
    It is straightforward to see that this defines a natural transformation.
\end{proof}
\begin{remark}
    In fact $f^{-1} \circ (-)^+$, $f^{-1}$ and $(-)^+\circ \lim_f$ are all naturally isomorphic.
\end{remark}
\begin{corollary}
    $f^{-1}\dashv f_*$ as functors between $\Sh(X)$ and $\Sh(Y)$.
\end{corollary}
\begin{proof}
    $f^{-1}$ is naturally isomophic to $(-)^+\circ \lim_f$ and so for $\shf{F}\in\Sh(Y),\shf{G}\in\Sh(X)$ we have natural bijections
    \begin{align}
        \Hom_{\Sh(X)}(f^{-1}\shf{F},\shf{G}) &\cong \Hom_{\Sh(X)}\left((\lim_f\shf{F})^+,\shf{G}\right) \cong \Hom_{\PreSh(X)}\left(\lim_f\shf{F},\shf{G}\right) \nonumber \\
                                             &\cong \Hom_{\PreSh(Y)}\left(\shf{F},f_*\shf{G}\right) \cong \Hom_{\Sh(Y)}\left(\shf{F},f_*\shf{G}\right).
    \end{align}
\end{proof}
\begin{corollary}
    $(-)_x\circ f^{-1} = (-)_{f(x)}$.
\end{corollary}
\begin{proof}
    $(-)_x\circ f^{-1} = (-)_x \circ (-)^+ \circ \lim_f = (-)_x \circ \lim_f = (-)_{f(x)}$.
\end{proof}
\begin{corollary}
    $f^{-1}$ is an exact functor.
\end{corollary}
\begin{proof}
    It is the composition of two exact functors.
    Alternatively take stalks.
\end{proof}
\begin{corollary}
    There are natural transformations $e:\id\Rightarrow f_*f^{-1}$ and $\epsilon: f^{-1}f_*\to \id$ such that 
    \begin{align}
        f^{-1}\xRightarrow{f^{-1}e} &f^{-1}f_*f^{-1} \xRightarrow{\epsilon f^{-1}} f^{-1} \\
        f_*\xRightarrow{ef_*} &f_*f^{-1}f_* \xRightarrow{f_*\epsilon} f_*
    \end{align}
    both compose to the identity natural transformation.
\end{corollary}
\section{The \texorpdfstring{$\sheafHom$}{Hom} sheaf}
\begin{lemma}
    Let $\shf{F}$ and $\shf{G}$ be sheaves and $f:\Spe(\shf{F})\to \Spe(\shf{G})$ be a continuous map so that 
    \begin{equation}
        \begin{tikzcd}
            \Spe(\shf{F}) \arrow[rr, "f"] \arrow[rd,"\pi"] & & \Spe(\shf{G}) \arrow[dl,"\pi"] \\
                                                  & X &
        \end{tikzcd}
    \end{equation}
    commutes.
    Let $\tilde f: \shf{F}^+\to\shf{G}^+$ be the morphism obtained by postcomposing sections with $f$.
    Then $\tilde f_x = f|_x$.
    
\end{lemma}
\begin{proof}
    This follows from the fact that if $s\in\shf{F}^+(U)$ then for $x\in U$, $s_x = s(x)$.
\end{proof}
\begin{thm}
    Let $\shf{F}$ and $\shf{G}$ be sheaves.
    Then there is a bijection between continuous maps $\Spe(\shf{F})\to \Spe(\shf{G})$ and morphisms of sheaves $\shf{F}\to \shf{G}$.
\end{thm}
\begin{proof}
    For sheaves we have $\shf{F} \cong \shf{F}^+$ and so the results follows from the lemma.
\end{proof}
\begin{corollary}
    The presheaf $\sheafHom(\shf{F},\shf{G})$ defined by 
    \begin{equation}
        \sheafHom(\shf{F},\shf{G})(U) = \Hom(\shf{F}|_U,\shf{G}|_U)
    \end{equation}
    is in fact a sheaf.
\end{corollary}
\section{Sheaves of modules}
\begin{definition}
    Let $\shf{A}$ be a presheaf of rings and $\shf{F}$ a presheaf of groups.
    We say that $\shf F$ is an $\shf A$-module if there is a morphism $\shf A\times \shf F\to \shf F$ satisfying the usual commutative diagrams.
    Write $\PreMod(\shf A)$ for the category of presheaf $\shf A$-modules, and $\Mod(\shf A)$ for the category of $\shf A$-modules.
\end{definition}
\begin{proposition}
    Let $\shf A$ be a presheaf of rings.
    There is an isomorphism of categories between $\Mod(\shf A)$ and $\Mod(\shf A^+)$.
\end{proposition}
\begin{proof}
    Given $\shf A\times \shf F\to \shf F$ we obtain $\shf A^+\times \shf F\to \shf F$ via sheafification.
    Conversely, given $\shf A^+\times \shf F\to \shf F$ we obtain $\shf A\times \shf F\to \shf F$ by composing with $\shf A\times \shf F\to \shf A^+\times \shf F$.
    These operations are clearly inverse and respect morphisms.
\end{proof}
\begin{proposition}
    Let $\shf A$ be a sheaf of rings and $\shf F\in \PreMod(\shf A)$.
    Then $\shf F^+\in \Mod(\shf A^+)$ and the canonical morphism $\shf F\to \shf F^+$ is an $\shf A$-module map.
\end{proposition}
\section{Tensors}
\begin{definition}
    Let $\shf{A}$ be a presheaf of rings, and $\shf{F},\shf{G}\in\PreMod(\shf A)$.
    Define $\shf F\otimes_{\shf A}\shf G$ to be the sheafification of the presheaf tensor product.
    $\shf F\otimes_{\shf A}\shf G$ is a $\shf A^+$-module.
    Write $\shf F\otimes_{\shf A}'\shf G$ for the presheaf tensor.
\end{definition}
\begin{thm}
    Let $\shf A$ be a sheaf of rings.
    Then any $\shf A$-bilinear morphism $\shf F\times\shf G\to \shf H$ where $\shf H\in\Mod(\shf A)$ factors uniquely through $\shf F\times\shf G\to \shf F\otimes_{\shf A}\shf G$.
\end{thm}
\begin{thm}
    $-\otimes_{\shf A}-:\PreMod(\shf A)\times\PreMod(\shf A)\to \Mod(\shf A^+)$ is a functor.
\end{thm}
\begin{proposition}
    Let $\shf A$ be a presheaf of rings on $Y$, $\shf F, \shf G\in \PreMod(\shf A)$, and $f:X\to Y, g:Y\to Z$ be continuous maps.
    Then there are natural isomorphisms
    \begin{enumerate}
        \item $\shf{F}\otimes_{\shf{A}}\shf{A} \cong \shf{F}$
        \item $\shf{F}\otimes_{\shf{A}}\shf{G} \cong \shf{F}^+\otimes_{\shf{A}^+}\shf{G}^+$
        \item $f^{-1}(\shf F\otimes_{\shf A}\shf G) \cong f^{-1}\shf F\otimes_{f^{-1}\shf A}f^{-1}\shf G$
    \end{enumerate}
\end{proposition}
\begin{proof}
    \begin{enumerate}
        \item Obvious.
        \item Use universal property.
        \item It is straightforward to check that $\lim_f(\shf F\otimes_{\shf A}' \shf G) \cong \lim_f\shf F\otimes_{\lim_f\shf A}'\lim_f\shf G$.
            But then
            \begin{align}
                f^{-1}(\shf F\otimes_{\shf A}\shf G) &\cong f^{-1}(\shf F\otimes_{\shf A}'\shf G) \cong \left(\lim_f(\shf F\otimes_{\shf A}'\shf G)\right)^+ \nonumber \\
                                                     &\cong f^{-1}\shf F\otimes_{f^{-1}\shf A}f^{-1}\shf G
            \end{align}
    \end{enumerate}
\end{proof}
\begin{proposition}
    Let $\shf A$ be a presheaf of rings on $X$ and $\shf F,\shf G\in \Mod(X)$. 
    Then $(\shf F\otimes_{\shf A}\shf G)_p \cong \shf F_p\otimes_{\shf A_p}\shf G_p$ for all $p\in X$.
\end{proposition}
\section{Injective sheaves}
\begin{definition}
    Let $\shf{F}$ be a sheaf.
    Define $D(\shf{F})$ to be the sheaf of all (not necessarily continuous) sections of $\Spe(\shf{F})\to X$.
\end{definition}
\begin{lemma}
    $D(\shf{F}) = \prod_{x\in X}x_*(\shf{F}_x)$.
\end{lemma}
\begin{proof}
    Obvious.
\end{proof}
\begin{thm}
    $\Sh(X)$ over the abelian category $\AbGrp/\Ring/\Mod_R$ has enough injectives.
\end{thm}
\begin{proof}
    Let $\mathcal A$ denote the abelian category.
    Recall that $x_*:\mathcal A\to \Sh(X)$ is the right adjoint of an exact functor.
    Thus it is left exact and preserves injectives.
    Let $x\in X$. 
    $\mathcal A$ has enough injectives, so there is some injective object $I_x$ such that $0\to \shf{F}_x \to I_x$ is exact.
    It follows that $0\to x_*(\shf{F}_x)\to x_*(I_x)$ is also exact.
    We can then form the exact sequence $0\to \prod_{x\in X}x_*(\shf{F}_x) \to \prod_{x\in X}x_*(I_x)$.
    The last term is injective since it is a product of injective objects.
    Composing this with the canonical map $\shf{F}\to D(\shf{F})$ gives the required injection into an injective object.
\end{proof}
\chapter{Scheme Theory}
\section{Locally ringed spaces}
A locally ringed space is a pair $(X,\shf{O}_X)$ consisting of a topological space $X$ and a sheaf $\shf{O}_X$ of rings on $X$ such that the stalks are local rings.
A morphism of between the locally ringed spaces $(X,\shf{O}_X)$ and $(Y,\shf{O}_Y)$ is a pair $(f,f^\#)$ consisting of a continuous map $f:X\to Y$ and a morphism of sheaves $f^\#:\shf{O}_Y\to f_*\shf{O}_X$ which induces morphisms of local rings on stalks $f^\#_{p}:\shf{O}_{Y,f(p)} \to \shf{O}_{X,p}$.

Given morphisms $(f,f^\#):(X,\shf{O}_X)\to (Y,\shf{O}_Y)$ and $(g,g^\#):(Y,\shf{O}_Y)\to (Z,\shf{O}_Z)$ we define their composition $(h,h^\#):(X,\shf{O}_X)\to (Z,\shf{O}_Z)$ by $h = g\circ f$ and
\begin{equation}
    h^\# = \shf{O}_Z \to g_*\shf{O}_Y \to g_*(f_*\shf{O}_X) = h_*\shf{O}_X.
\end{equation}
Note that
\begin{equation}
    \begin{tikzcd}
        \shf{O}_{Z,h(p)} \arrow[r] \arrow[rr,bend left=20,"(h^\#)_{h(p)}"] \arrow[dr,swap,"g^\#_{f(p)}"] & (g_*\shf{O}_Y)_{g\circ f(p)} \arrow[r] \arrow[d] & (g_*f_*\shf{O}_X)_{g\circ f(p)} \arrow[d] \arrow[dd,bend left=60] \\
                                                            & \shf{O}_{Y,f(p)} \arrow[r] \arrow[dr,swap,"f^\#_p"] & (f_*\shf{O}_X)_{f(p)} \arrow[d] \\
                                   & & \shf{O}_{X,p}
    \end{tikzcd}
\end{equation}
commutes and so $h^\#_p = f^\#_p\circ g^\#_{f(p)}$ is a morphism of local rings and so $(h,h^\#)$ is indeed a morphism of locally ringed spaces.
\begin{proposition}
    \label{prop:factor}
    Let $(f,f^\#):(X,\shf{O}_X)\to (Y,\shf{O}_Y)$ be a morphism of locally ringed spaces.
    If $f(X)\subseteq U$ for some open subset $U\subseteq Y$ then $(f,f^\#)$ factors through $(U,\shf{O}_Y\mid_U)$.
\end{proposition}
\begin{proof}
    Let $\bar f:X\to U$ denote the map $f$ viewed as having codomain $U$, and $i:U\to Y$.
    Then $f = i\circ \bar f$.
    Moreover, there is a natural morphism $i^\#:\shf{O}_Y\to i_*(\shf{O}_Y\mid_U)$ given by the restriction maps.
    Since $\bar f^{-1}(V) = f^{-1}(V)$ for $V\subseteq U$, there is also a natural map $\bar f^\#:\shf{O}_Y\mid_U \to \bar f_*\shf{O}_X$ given by the restriction of $f^\#$.
    It is straightforward to see that $f^\# = i^\#\circ \bar f^\#$.
\end{proof}
\begin{thm}
    Let $(f,f^\#):(X,\shf{O}_X)\to (Y,\shf{O}_Y)$ be a morphism of locally ringed spaces.
    $(f,f^\#)$ is an isomorphism iff $f$ is a homeomorphism and $f^\#$ is an isomorphism.
\end{thm}
\begin{proof}
    The forwards direction is obvious.
    Now suppose $f$ is a homeomorphism and $f^\#$ is an isomorphism.
    Let $g = f^{-1}:Y\to X$ and $g^\# = (g_*f^\#)^{-1}$.
    Then $(g,g^\#) \circ (f,f^\#) = \id$ and $(f,f^\#) \circ (g,g^\#) = \id$.
\end{proof}
\begin{corollary}
    Let $(f,f^\#):(X,\shf{O}_X)\to (Y,\shf{O}_Y)$ be a morphism of locally ringed spaces.
    If 
    \begin{enumerate}
        \item $U:=f(X)$ is an open subset of $Y$,
        \item $f$ is a homeomorphism onto its image,
        \item $f^\#_p$ is an isomorphism for all $p\in X$
    \end{enumerate}
    then $(X,\shf{O}_X)\cong (U,\shf{O}_Y\mid_U)$.
\end{corollary}
\begin{proof}
    By proposition \ref{prop:factor}, $(f,f^\#)$ factors through $(\bar f,\bar f^\#):(X,\shf{O}_X)\to (U,\shf{O}_Y\mid_U)$.
    By the theorem it suffices to check that $\bar f^\#_p$ is an isomorphism for all $p\in X$.
    But this follows from the fact that $i^\#$ is an isomorphism on stalks.
\end{proof}
\begin{thm}
    Let $(X,\shf{O}_X)$ and $(Y,\shf{O}_Y)$ be locally ringed spaces.
    The presheaf $U\mapsto \Hom((U,\shf{O}_X|_U),(Y,\shf{O}_Y))$ on $\Top(X)$ is a sheaf of sets.
\end{thm}
\section{Morphisms}
\subsection{Quasi-compact}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is quasi-compact if there is an affine covering $\{V_i\}_i$ of $Y$ such that $f^{-1}(V_i)$ is quasi-compact for all $i$.
\end{definition}
\begin{lemma}
    Let $X$ be a topological space.
    If $X$ is a finite union of quasi-compact open sets then $X$ is quasi-compact.
\end{lemma}
\begin{thm}
    Let $(f,f^\#):X\to Y$ be quasi-compact.
    Then for any affine $V\subseteq Y$, $f^{-1}(V)$ is quasi-compact.
\end{thm}
\begin{proof}
    Let us say that an open affine subset $V\subseteq Y$ has the property $(P)$ if $f^{-1}(V)$ is quasi-compact.
    We show that $(P)$ is an affine-local property.
    \begin{enumerate}
        \item If $V$ has property $(P)$, then certainly $V_g$ for $g\in \shf{O}_Y(V)$ does too.
        \item Suppose that $(g_1,\dots,g_k) = \shf{O}_Y(V)$ and that $V_{g_i}$ has property $(P)$ for all $i$.
            Then $f^{-1}(V) = \cup_if^{-1}(V_{f_i})$ is a finite union of quasi-compact open sets and so is quasi compact.
    \end{enumerate}
    The result follows from the affine communication lemma.
\end{proof}
\begin{remark}
    It follows easily from the theorem that $f^{-1}(V)$ is quasi-compact for all open quasi-compact subsets $V$ of $Y$.
\end{remark}
\begin{remark}
    If $\phi:A\to B$ is ring homomorphism, then $\Spec(\phi)$ is always quasi-compact (choose the trivial covers for both spaces).
\end{remark}
\begin{proposition}
    Being quasi-compact is invariant under base change.
\end{proposition}
\subsection{Quasi-separated}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is quasi-separated if there is an affine covering $\{V_i\}_i$ of $Y$ such that $f^{-1}(V_i)$ is quasi-separated for all $i$.
\end{definition}
\begin{thm}
    Let $(f,f^\#):X\to Y$ be quasi-separated.
    Then for any affine $V\subseteq Y$, $f^{-1}(V)$ is quasi-separated.
\end{thm}
\begin{proof}
    Let us say that an open affine subset $V\subseteq Y$ has the property $(P)$ if $f^{-1}(V)$ is quasi-separated.
    We show that $(P)$ is an affine-local property.
    \begin{enumerate}
        \item If $V$ has property $(P)$, then certainly $V_g$ for $g\in \shf{O}_Y(V)$ does too.
        \item Suppose that $(g_1,\dots,g_k) = \shf{O}_Y(V)$ and that $V_{g_i}$ has property $(P)$ for all $i$.
            Then for each $i$, $f^{-1}(V_{g_i})$ has an open cover $\set{W_{ij}}_j$ such that the intersection between any two elements of the cover is quasi-compact.
            It is clear that $\set{W_{ij}}_{i,j}$ cover $f^{-1}(V)$ and so it suffices to show that $W_{ij}\cap W_{kl}$ is quasi-compact for $i\ne k$.
            But by part $(1)$, the $V_{g_ig_j}$ also have property $(P)$.
            Moreover, $W_{ij}\cap W_{kl}\subseteq f^{-1}(V_{g_ig_k})$ and so $W_{ij}\cap W_{kl} = W_{ij}\cap f^{-1}(V_{g_ig_k}) \cap W_{kl}\cap f^{-1}(V_{g_ig_k})$.
            But $W_{ij}\cap f^{-1}(V_{g_ig_k}) = (W_{ij})_{f^\#(V)(g_k)}$ is affine.
            Thus $W_{ij}\cap W_{kl}$ is the intersection of two affines in the quasi-separated space $f^{-1}(V_{g_ig_k})$ and is thus quasi-compact.
    \end{enumerate}
    The result follows from the affine communication lemma.
\end{proof}
\begin{remark}
    If $\phi:A\to B$ is ring homomorphism, then $\Spec(\phi)$ is always quasi-separated (choose the trivial covers for both spaces).
\end{remark}
\begin{proposition}
    Being quasi-separated is invariant under base change.
\end{proposition}
\subsection{Locally of finite type}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is locally of finite type if there is an affine covering $\{V_i\}_i$ of $Y$, and for each $i$, and affine covering $\{U_{ij}\}_j$ of $f^{-1}(V_i)$ such that $\shf{O}_X(U_{ij})$ is as finitely generated $\shf{O}_Y(V_i)$-algebra.
\end{definition}
\begin{proposition}
    \label{prop:fg_aff_local}
    Let $\phi:B\to A$ be a ring homomorphism and $(f_1,\dots,f_n) = A$.
    Then $A$ is a finitely generated $B$-algebra iff $A_{f_i}$ is a finitely generated $B$-algebra for all $i$.
\end{proposition}
\begin{thm}
    Let $(f,f^\#):X\to Y$ be locally of finite type.
    Then for any affine $V\subseteq Y$ and affine $U\subseteq f^{-1}(V)$, $\shf{O}_X(U)$ is a finitely generated $\shf{O}_Y(V)$-algebra.
\end{thm}
\begin{proof}
    Let us say that an open affine subset $V\subseteq Y$ has the property $(P)$ if for all open affine $U\subseteq f^{-1}(V)$, $\shf{O}_X(U)$ is finitely generated as a $\shf{O}_Y(V)$-algebra.
    We show that $(P)$ is an affine-local property.
    \begin{enumerate}
        \item It is clear that if $V$ has property $(P)$ then so does $V_g$ for $g\in \shf{O}_Y(V)$.
        \item Suppose that $(g_1,\dots,g_k) = \shf{O}_Y(V)$ and that $V_{g_i}$ has property $(P)$ for all $i$.
    Let $U\subseteq f^{-1}(V)$ be affine and open and let $\psi:A\to C$ denote the corresponding morphism where $A = \shf{O}_Y(V)$ and $C = \shf{O}_X(U)$.
    We have that $f$ restricts to a morphism $U_{\psi(g_i)}\to V_{f_i}$ for all $i$.
    Since $U_{\psi(g_i)}$ is affine, $C_{\psi(g_i)}$ is a finitely generated $A_{g_i}$-algebra and hence a finitely generated $A$-algebra.
    Since $(g_1,\dots,g_k) = A$ it follows that $(\psi(g_1),\dots,\psi(g_k)) = C$ and so $C$ is a finitely generated $A$-algebra.
    \end{enumerate}
    It follows that the property $(P)$ is an affine-local property.
    But by proposition \ref{prop:fg_aff_local} and the affine communication lemma, each of the $V_i$ have property $(P)$.
    Since the $V_i$ cover $Y$, the result follows from the affine communication lemma.
\end{proof}
\begin{remark}
    If $\phi:A\to B$ is ring homomorphism, then $\Spec(\phi)$ is locally of finite type iff $B$ is a finitely generated $A$-algebra via $\phi$.
\end{remark}
\begin{proposition}
    Being locally of finite type is invariant under base change.
\end{proposition}
\subsection{Finite type}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is of finite type if it is quasi-compact and locally of finite type.
\end{definition}
\begin{remark}
    If $\phi:A\to B$ is ring homomorphism, then $\Spec(\phi)$ is of finite type iff $B$ is a finitely generated $A$-algebra via $\phi$.
\end{remark}
\subsection{Finite}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is finite if it is affine and locally of finite type.
\end{definition}
\subsection{Closed immersion}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is a closed immersion if $f(X)$ is closed in $Y$, $f$ is a homeomorphism onto its image, and the morphism $f^\#$ is surjective.
\end{definition}
\begin{remark}
    If $\phi:A\to B$ is ring homomorphism, then $\Spec(\phi)$ is a closed immersion iff $\phi$ is a surjection.
\end{remark}
\begin{proposition}
    Let $f:X\to Y$ be a morphism and suppose there is an open cover $\set{U_i}_i$ of $Y$ such that $f|_{f^{-1}(U_i)}:f^{-1}(U_i)\to U_i$ is a closed immersion for all $i$.
    Then $f$ is a closed immersion.
\end{proposition}
\begin{lemma}
    Let $Y\to \Spec(A)$ be a closed immersion. 
    Then $Y$ is affine.
\end{lemma}
\begin{proof}
    See Hartshorne II.3.11 b).
\end{proof}
\begin{corollary}
    Let $f:X\to Y$ be a closed immersion. 
    Then $f$ is an affine morphism.
\end{corollary}
\begin{proof}
    Let $U$ be an affine susbet of $Y$.
    Then $f$ restricted to $f^{-1}(U)$ is a closed immersion.
    The result then follows from the lemma.
\end{proof}
\begin{proposition}
    Being a closed immersion is invariant under base change.
\end{proposition}
\begin{proof}
    Let $f:X\to S$ be a closed immersion and $g:S'\to S$ any morphism of schemes.
    It suffices to check for $X,S,S'$ affine.
    But then the result follows from the fact that tensoring is right exact.
\end{proof}
\subsection{Open immersion}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is an open immersion if $f(X)$ is open in $Y$, $f$ is a homeomorphism onto its image, and $f_p^\#$ is an isomorphism for all $p\in X$.
\end{definition}
\begin{proposition}
    Being an open immersion is invariant under base change.
\end{proposition}
\begin{proof}
    Clear if you view $i:U\to X$ as a subset of $X$ (then $V\times_SS'$ is an open subset of $S\times_SS' = S'$).
\end{proof}
\subsection{Affine}
\begin{definition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes.
    We say $(f,f^\#)$ is affine if there is an affine covering $\{V_i\}_i$ of $Y$ such that $f^{-1}(V_i)$ is affine for all $i$.
\end{definition}
\begin{thm}
    Let $(f,f^\#):X\to Y$ be affine.
    Then for any affine $V\subseteq Y$, $f^{-1}(V)$ is affine.
\end{thm}
\begin{proof}
    Let us say that an open affine subset $V\subseteq Y$ has the property $(P)$ if $f^{-1}(V)$ is affine.
    We show that $(P)$ is an affine-local property.
    \begin{enumerate}
        \item If $V$ has property $(P)$, then clearly $V_g$ for $g\in\shf{O}_Y(V)$ does too.
        \item Suppose that $(g_1,\dots,g_k) = \shf{O}_Y(V)$ and that $V_{g_i}$ has property $(P)$ for all $i$.
            Then $f$ restricted to $f^{-1}(V)\to V$ is quasi-compact and quasi-separated.
            It follows that $f^{-1}(V)$ is quasi-compact and quasi-separated.
            Moreover, $f^{-1}(V)_{f^\#(V)(g_i)}$ is affine for all $i$, and $(f^\#(V)(g_1),\dots,f^\#(V)(g_k)) = \Gamma(f^{-1}(V),\shf{O}_X)$.
            It follows from proposition \ref{prop:aff_cover_aff} that $f^{-1}(V)$ is affine.
    \end{enumerate}
    The result follows from the affine communication lemma.
\end{proof}
\begin{remark}
    If $\phi:A\to B$ is a ring homomorphism, then $\Spec(\phi)$ is always affine (choose the trivial cover for both spaces).
\end{remark}
\begin{proposition}
    Affineness is invariant under base-change.
\end{proposition}
\begin{proof}
    Let $f:X\to S$ be an affine morphism and $g:S'\to S$ any morphism of schemes.
    We wish to show that $f':X_{S'} = X\times_{S}S'\to S'$ is affine as well.
    Let $\set{U_i}_i$ be a cover of $S$ by affine open subsets and for each $i$ let $\set{V_{ji}}_{ji}$ be a cover of $g^{-1}(U_i)$ by affine open subsets.
    Then 
    \begin{equation}
        f'^{-1}(V_{ji}) = X\times_SV_{ji} = f^{-1}(U_i)\times_{U_i}V_{ji}
    \end{equation}
    is affine since $f^{-1}(U_i)$ is.
    Thus $f'$ is affine.
\end{proof}
\section{\texorpdfstring{$\shf{O}_X$}{OX}-Modules}
\begin{definition}
    Let $(X,\shf{O}_X)$ be a locally ringed space.
    An $\shf{O}_X$-module is a sheaf $\shf{F}$ of abelian groups with a compatible $\shf{O}_X$ action.
    Morphisms of $\shf{O}_X$-modules are morphisms of sheaves of abelian groups that respect the $\shf{O}_X$-module structure.
\end{definition}
\begin{thm}
    The category of $\shf{O}_X$-modules is an abelian category.
\end{thm}
\begin{proof}
    Additive structure on hom-sets is obvious.
    Kernels are the same as the kernels in $\Ab(X)$, with the obvious $\shf{O}_X$-module structure.
    Similarly for cokernels (if a presheaf has an $\shf{O}_X$-module structure, then so does its sheafification by acting on the stalks).
    The rest then follows.
\end{proof}
\begin{definition}
    (Tensor product).
    Let $\shf{F}$ and $\shf{G}$ be $\shf{O}_X$-modules.
    Define the tensor product of $\shf{F}$ and $\shf{G}$, $\shf{F}\otimes_{\shf{O}_X}\shf{G}$ to be the sheafification of the presheaf tensor product with the obvious $\shf{O}_X$-module structure.
\end{definition}
\begin{definition}
    (Pullback).
    Let $f:X\to Y$ be a continuous map, and $\shf{F}$ an $\shf{O}_Y$.
    Then $f^{-1}\shf{F}$ is naturally a $f^{-1}\shf{O}_Y$-module.
    Moreover from the inverse image - direct image adjunction we obtain a map $f^{-1}\shf{O}_Y\to \shf{O}_X$ from $f^\#:\shf{O}_Y\to f_*\shf{O}_X$.
    We can thus form the sheaf $f^{-1}\shf{F}\otimes_{f^{-1}\shf{O}_Y}\shf{O}_X$.
    This sheaf is naturally an $\shf{O}_X$-module and we call it $f^*\shf{F}$.
\end{definition}
\begin{proposition}
    The maps $X\mapsto \Mod(X)$, $f\mapsto f^*$ give rise to a functor $\Sch^{op}\to \Mod$.
\end{proposition}
\begin{proof}
    Clear that the identity maps to the identity.
    Now suppose we have maps $f:X\to Y,g:Y\to Z$ and let $\shf{F}\in \Mod(Z)$.
    Then
    \begin{align}
        f^*(g^*(\shf F)) &= f^*(g^{-1}\shf F\otimes_{g^{-1}\shf O_Z}\shf O_Y) \nonumber \\
                         &= f^{-1}\left(g^{-1}\shf F\otimes_{g^{-1}\shf O_Z}\shf O_Y\right)\otimes_{f^{-1}\shf O_Y}\shf O_X \nonumber \\
                         &\cong (g\circ f)^{-1}\shf{F}\otimes_{(g\circ f)^{-1}\shf O_Z}\shf O_X \nonumber \\
                         &= (g\circ f)^*(\shf F).
    \end{align}
\end{proof}
\begin{thm}
    Let $\shf F,\shf G\in \Mod(Y)$ and $f:X\to Y$.
    Then 
    \begin{equation}
        f^*(\shf F\otimes_{\shf O_Y}\shf G) \cong f^*\shf F\otimes_{\shf O_X}f^*\shf G.
    \end{equation}
\end{thm}
\begin{remark}
    If $i:U\hookrightarrow X$ is the inclusion map for an open subset $U\subseteq X$, then $i^* = i^{-1}$.
\end{remark}
\begin{definition}
    (Direct image).
    Let $f:X\to Y$ be a continuous map, and $\shf{F}$ an $\shf{O}_X$.
    Then $f_*\shf{F}$ is naturally a $f_*\shf{O}_X$ module, and hence a $\shf{O}_Y$-module via $f^\#:\shf{O}_Y\to f_*\shf{O}_X$.
\end{definition}
\begin{thm}
    \label{thm:tensor-hom}
    Let $\shf{F}$ be a $(\shf{A},\shf{B})$-bimodule.
    Then $-\otimes_{\shf{A}}\shf{F}\dashv \sheafHom_{\shf{B}}(\shf{F},-)$ as functors between $\Mod(\shf{A})$ and $\Mod(\shf{B})$.
\end{thm}
\begin{proof}
    Follows from the corresponding tensor-hom adjunction for modules.
\end{proof}
\begin{lemma}
    Let $f:X\to Y$, $\shf{F}\in \Mod(Y)$ and $\shf{G}\in \Mod(X)$.
    Then under the natural bijection
    \begin{equation}
        \Hom_\Ab(f^{-1}\shf{F},\shf{G}) \leftrightarrow \Hom_\Ab(\shf{F},f_*\shf{G})
    \end{equation}
    $f^{-1}\shf{O}_Y$-module morphisms biject with $\shf{O}_Y$-module morphisms.
\end{lemma}
\begin{thm}
    Let $f:X\to Y$ be a continuous map. 
    Then $f^*\dashv f_*$ as functors between $\Mod(X)$ and $\Mod(Y)$.
\end{thm}
\begin{proof}
    Let $\shf{F}\in \Mod(Y)$ and $\shf{G}\in \Mod(X)$.
    Note that $\shf{O}_X$ is an $(f^{-1}\shf{O}_Y,\shf{O}_X)$-bimodule.
    We thus have the following chain of natural bijections
    \begin{align}
        \Hom_{\shf{O}_X}(f^*\shf{F},\shf{G}) &\leftrightarrow \Hom_{f^{-1}\shf{O}_Y}(f^{-1}\shf{F},\sheafHom_{\shf{O}_X}(\shf{O}_X,\shf{G})) \nonumber \\
                                             &\leftrightarrow \Hom_{f^{-1}\shf{O}_Y}(f^{-1}\shf{F},\shf{G}) \nonumber \\
                                             &\leftrightarrow \Hom_{\shf{O}_Y}(\shf{F},f_*\shf{G})
    \end{align}
    where the last bijection follows from the lemma.
\end{proof}
\begin{remark}
    Given an $\shf{O}_Y$-module $\shf{F}$ we have a morphism 
    \begin{equation}
        f^{-1}\shf{F}\to f^{-1}\shf{F}\otimes_{f^{-1}\shf{O}_Y}\shf{O}_X = f^*\shf{F}.
    \end{equation}
    Thus we have a morphism $\shf{F}\to f_*f^{-1}\shf{F} \to f_*f^*\shf{F}$.
    This morphism is the same as the one arising from the $f^*\dashv f_*$ adjunction.
\end{remark}
\begin{definition}
    Let $\shf{F}$ be an $\shf{O}_Y$-moudle, and $\sigma\in \shf{F}(U)$.
    Write $f^*\sigma$ for the element in $(f^*\shf{F})(f^{-1}(U))$ under the morphism $\shf{F}\to f_*f^*\shf{F}$.
\end{definition}
\begin{remark}
    When $\shf{F} = \shf{O}_Y$, $f^* = f^\#$.
\end{remark}
\begin{proposition}
    Let $\shf{F}$ be an $\shf{O}_Y$-module, $\sigma\in \shf{F}(Y)$ and $\phi:\shf{O}_Y\to \shf{F}$ the corresponding map.
    Then $f^*\phi:\shf{O}_X\to f^*\shf{F}$ is mulitplication by $f^*\sigma$.
\end{proposition}
\begin{proof}
    $\id\to f_*f^*$ a natural transformation and so
    \begin{equation}
        \begin{tikzcd}
            \shf{O}_Y \arrow[r] \arrow[d] & \shf{F} \arrow[d] \\
            f_*\shf{O}_X \arrow[r] & f_*f^*\shf{F}
        \end{tikzcd}
    \end{equation}
    commutes.
\end{proof}
\begin{definition}
    Let $R$ be a ring and $M$ an $R$-module. 
    Define $\tilde M$ to be the $\shf{O}_{\Spec(R)}$-module which is locally $M_r$.
\end{definition}
\begin{thm}
    $\tilde \bullet$ is a fully faithful exact functor from $\Mod_R$ to $\Mod(\Spec(R))$.
\end{thm}
\begin{proof}
    Localisation is exact.
\end{proof}
\begin{corollary}
    $\tilde \bullet$ and $\Gamma$ form part of an adjoint equivalence of categories between $\Mod_R$ and $\Mod(\Spec(R))$.
\end{corollary}
\section{Locally free \texorpdfstring{$\shf{O}_X$}{OX}-modules}
\begin{definition}
    Let $(X,\shf{O}_X)$ be a scheme and $\shf{F}$ an $\shf{O}_X$-module.
    We say $\shf{F}$ is locally free of rank $n$ if there exists an open cover $\set{U_i}_i$ of $X$ such that $\shf{F}|_{U_i} \cong \shf{O}_{U_i}^{\oplus n}$ for all $i$.
\end{definition}
\begin{remark}
    Given a locally free sheaf $\shf{F}$ and an open cover we obtain transition functions $\psi_{ji}\in \GL_n(\shf{O}_{U_{ij}})$.
    Conversely, given such data we obtain a sheaf isomorphic to the original one.
\end{remark}
\begin{lemma}
    \label{lem:pullback}
    Let $f:X\to Y$ be a morphism of schemes and $\phi:\shf O_Y\to \shf O_Y$ the $\shf O_Y$-module homomorphism given by multiplication by $\alpha\in\shf O_Y(Y)$.
    Then $f^*\phi:\shf O_X\to \shf O_X$ is given by multiplication by $f^\#(Y)(\alpha)$.
\end{lemma}
\begin{proof}
    We check that they are equal on stalks.
    \begin{equation}
        \begin{tikzcd}
            \shf O_{Y,f(p)}\otimes_{\shf O_{Y,f(p)}}\shf O_{X,p} \arrow[r] & \shf O_{Y,f(p)}\otimes_{\shf O_{Y,f(p)}}\shf O_{X,p} \arrow[d] \\
            \shf O_{X,p} \arrow[r,"f^*\phi"] \arrow[u] & \shf O_{X,p}.
        \end{tikzcd}
    \end{equation}
    Following this diagram we get that 
    \begin{equation}
        1\mapsto 1\otimes 1\mapsto \alpha_p\otimes 1 = 1\otimes f_p^\#(\alpha_p)\mapsto f_p^\#(\alpha_p).
    \end{equation}
    Thus $f^*\phi$ is given by multiplication by $f^\#(Y)(\alpha)$.
\end{proof}
\begin{thm}
    Let $f:X\to Y$ be a morphism of schemes, and $\shf{F}$ a locally free $\shf{O}_Y$-module.
    Then $f^*\shf{F}$ is locally free of the same rank.
    Moreover, if $\set{\psi_{ji}}$ denote the transition functions for an open cover $\set{U_i}_i$ for $Y$, then $f^\#(\psi_{ji})$ are transition functions for $f^*\shf{F}$ on the open cover $\set{f^{-1}(U_i)}_i$.
\end{thm}
\begin{proof}
    There is an isomorphism $\shf{F}|_{U_i}\to \shf{O}_{U_i}^{\oplus n}$.
    Thus 
    \begin{equation}
        (f^*\shf{F})|_{f^{-1}(U_i)}\cong \left(f|_{f^{-1}(U_i)}\right)^* (\shf F|_{U_i}) \cong \shf O_{f^{-1}(U_i)}^{\oplus n}
    \end{equation}
    and so $f^*\shf F$ is also locally free of rank $n$.
    The result on the transition functions follows from lemma \ref{lem:pullback}
\end{proof}
\begin{proposition}
    Let $\shf F$ be a locally free $\shf O_X$-module.
    Then $-\otimes_{\shf O_X}\shf F$ is exact.
\end{proposition}
\section{Line bundles}
\begin{definition}
    Let $S$ be a scheme and $\shf{L}, \shf{L}'$ be locally free sheaves on $S$.
    We say the morphisms $\phi:\bigoplus\shf{O}_S\to \shf{L}$, $\psi:\bigoplus\shf{O}_S\to \shf{L}'$ are isomorphic if there is an isomorphism $i:\shf{L} \to \shf{L}'$ such that $\psi = i \circ \phi$.
\end{definition}
\begin{definition}
    Let $r\ge0$.
    Define $\underline \P^r$ to be the functor from $\Sch^{op}$ to $\Set$ which associates with the scheme $S$ the set of isomorphism classes of sujective morphisms $\phi:\bigoplus_{k=0}^r\shf{O}_S\to \shf{L}$ where $\shf{L}$ is a locally free sheaf of rank $1$. 
    Given $f:T\to S$, $\underline \P^r(f)$ sends $\phi$ to $f^*\phi$.
\end{definition}
\begin{definition}
    $\P^r_\Z := \Proj(\Z[x_0,\dots,x_r])$.
\end{definition}
\begin{lemma}
    Let $\shf{L}$ be a locally free sheaf of rank $1$ on a scheme $S$ and $\sigma\in \shf{L}(S)$.
    Then $S_\sigma := \set{s\in S: \sigma\not\in \mf m_s\shf{L}_s}$ is an open subset of $S$ and trivialises $\shf{L}$.
    Moreover, if $\xi:T\to S$ is a morphism of schemes then $T_{\xi^*\sigma} = \xi^{-1}(S_\sigma)$.
\end{lemma}
\begin{proof}
    Let $\set{U_i}_i$ be a trivialising open cover for $\shf{L}$.
    Then $\psi_i:\shf{L}|_{U_i}\xrightarrow{\sim}\shf{O}_S|_{U_i}$ and under this isomorphism $\mf m_s\shf{L}_s$ corresponds to $\mf m_s$.
    Thus $S_\sigma\cap U_i$ is open for all $i$ and so $S_\sigma$ is open.
    Now define the map $\phi:\shf{O}_X\to \shf{L}$ by $1\mapsto \sigma$.
    On $S_\sigma \cap U_i$ the composition $\shf{O}_X|_{S_\sigma \cap U_i}\xrightarrow{\phi}\shf{L}|_{S_\sigma \cap U_i}\xrightarrow{\psi_i}\shf{O}_X|_{S_\sigma \cap U_i}$ must be multiplication by some $\alpha\in \Gamma(S_\sigma \cap U_i,\shf{O}_X)$.
    But looking at stalks, this $\alpha$ must be invertible and so the composition must be an isomorphism.
    But then $\phi|_{S_\sigma\cap U_i}$ must be too and hence $\phi|_{S_\sigma}$ is an isomorphism.

    For the last part note that we have the following commutative diagram
    \begin{equation}
        \begin{tikzcd}
            \shf{L}|_{U_i} \arrow[d] \arrow[r] & \shf{O}_S|_{U_i} \arrow[d] \\
            (\xi|_{\xi^{-1}(U_i)})_*((\xi^*\shf{L})|_{\xi^{-1}(U_i)}) \arrow[r] & (\xi|_{\xi^{-1}(U_i)})_*(\shf{O}_T|_{\xi^{-1}(U_i)}).
        \end{tikzcd}
    \end{equation}
    It follows that $\xi^*(\sigma|_{U_i})$ maps to $\xi^\#(\psi_i(\sigma|_{U_i}))$ under $\xi^*\psi_i$.
    Thus 
    \begin{equation}
        T_{\xi^*\sigma} \cap \xi^{-1}(U_i) = \xi^{-1}(U_i)_{\xi^\#(\psi_i(\sigma|_{U_i}))} = \xi^{-1}\left((U_i)_{\psi_i(\sigma|_{U_i})}\right) = \xi^{-1}(U_i\cap S_{\sigma})
    \end{equation}
    and so the result follows.
\end{proof}
\begin{lemma}
    Let $S$ be a scheme, $\shf{L}$ a locally free sheaf of rank 1 and 
    \begin{equation}
        \phi:\bigoplus_{k=0}^r\shf{O}_S\to \shf{L}
    \end{equation}
    a surjective morphism of $\shf{O}_S$-modules.
    Then there is a morphism $\eta_\phi:S\to \P^r_\Z$.
    Moreover, this construction only depends on the isomorphism class of $\phi$ and is functorial in $S$ i.e. given $\gamma:T\to S$ we have $\eta_{\gamma^*(\phi)} = \eta_\phi\circ \gamma$.
\end{lemma}
\begin{remark}
    Morally such a morphism gives $r+1$ sections $\sigma_0,\dots,\sigma_r$. 
    We then obtain the morphism $S\to \P^r_\Z$ by $s\mapsto (\sigma_0:\cdots:\sigma_r)$.
\end{remark}
\begin{proof}
    Let $e_i = \delta_{ij}$ and let $\sigma_0,\dots,\sigma_r$ be the images of $e_0,\dots,e_r$ respectively.
    Since $\phi$ is surjective, $S = \cup_iS_{\sigma_i}$.
    Let $\psi_i:\shf{O}_S|_{S_{\sigma_i}}\to \shf{L}|_{S_{\sigma_i}}$ denote the trivialising isomorphisms from the previous lemma and let $\xi_i$ be the inverse of $\psi_i$.
    Restricting $\phi$ to $S_{\sigma_i}$ we obtain the composition
    \begin{equation}
        \label{eq:aff}
        \bigoplus_{k=0}^r\shf{O}_{S_{\sigma_i}} \xrightarrow{\phi|_{S_{\sigma_i}}} \shf{L}|_{S_{\sigma_i}} \xrightarrow{\xi_i} \shf{O}_{S_{\sigma_i}}.
    \end{equation}
    Let $f_{ji}$ denote the image of $e_j$ under this composition.
    Then $f_{ji}\cdot\sigma_i|_{S_{\sigma_i}} = \sigma_j|_{S_{\sigma_i}}$.
    It follows that 
    \begin{equation}
        f_{ji}|_{S_{\sigma_i}\cap S_{\sigma_j}} \cdot f_{ij}|_{S_{\sigma_i}\cap S_{\sigma_j}} \cdot \sigma_j|_{S_{\sigma_i}\cap S_{\sigma_j}} = \sigma_j|_{S_{\sigma_i}\cap S_{\sigma_j}}.
    \end{equation}
    Applying $\xi_i|_{S_{\sigma_i}\cap S_{\sigma_j}}$ to both sides yields that 
    \begin{equation}
        f_{ji}|_{S_{\sigma_i}\cap S_{\sigma_j}}  = f_{ij}|_{S_{\sigma_i}\cap S_{\sigma_j}}^{-1}.
    \end{equation}
    Similarly we get 
    \begin{equation}
        f_{kj}|_{S_{\sigma_i}\cap S_{\sigma_j}}f_{ji}|_{S_{\sigma_i}\cap S_{\sigma_j}} = f_{ki}|_{S_{\sigma_i}\cap S_{\sigma_j}}, \quad f_{ii} = 1.
    \end{equation}

    Now, equation \ref{eq:aff} gives rise to a morphism $(\eta_{\phi})_i:S_{\sigma_i}\to U_i$ where $U_i$ is the standard affine patch $D_+(x_i)\subseteq \P^r_\Z$.
    This morphism sends $x_j/x_i\in \shf{O}_{\P^r_\Z}(U_i)$ to $f_{ji}$ (and is uniquely defined by this fact).
    It follows that
    \begin{equation}
        (\eta_{\phi})_i^{-1}(U_i\cap U_j) = (S_{\sigma_i})_{f_{ji}} = S_{\sigma_i} \cap S_{\sigma_j}.
    \end{equation}
    Thus the map $(\eta_\phi)_i|_{S_{\sigma_i}\cap S_{\sigma_j}}$ factors 
    \begin{equation}
        \begin{tikzcd}
            S_{\sigma_i}\cap S_{\sigma_j} \arrow[r] \arrow[dr] & \Spec(\Z[x_0/x_i,\dots,x_n/x_i]) \\
                                                               & \Spec(\Z[x_0/x_i,\dots,x_n/x_i]_{x_j/x_i}) \arrow[u]
        \end{tikzcd}
    \end{equation}
    and similarly for $(\eta_\phi)_j|_{S_{\sigma_i}\cap S_{\sigma_j}}$.
    We thus have maps
    \begin{equation}
        \begin{tikzcd}
                                              & \Spec(\Z[x_0/x_i,\dots,x_0/x_i]_{x_j/x_i}) \\
            S_{\sigma_i}\cap S_{\sigma_j}\arrow[ur,"(\eta_\phi)_{ji}"] \arrow[dr,"(\eta_\phi)_{ij}"] & \\
                                                               & \Spec(\Z[x_0/x_j,\dots,x_0/x_j]_{x_i/x_j}) \arrow[uu,"\zeta"]
        \end{tikzcd}
    \end{equation}
    where the vertical map is induced from $x_k/x_i\mapsto (x_k/x_j)\cdot (x_i/x_j)^{-1}$.
    To see that this diagram commutes note that $(\eta_\phi)_{ji}(x_k/x_i) = f_{ki}|_{S_{\sigma_i}\cap S_{\sigma_j}}$ while
    \begin{align}
        (\eta_\phi)_{ij}\circ \zeta(x_k/x_i) &= (\eta_\phi)_{ij}\left((x_k/x_j)\cdot (x_i/x_j)^{-1}\right) \nonumber \\
                                             &= f_{kj}|_{S_{\sigma_i}\cap S_{\sigma_j}} \cdot f_{ij}|_{S_{\sigma_i}\cap S_{\sigma_j}}^{-1} \nonumber \\
                                             &= f_{kj}|_{S_{\sigma_i}\cap S_{\sigma_j}} \cdot f_{ji}|_{S_{\sigma_i}\cap S_{\sigma_j}} = f_{ki}|_{S_{\sigma_i}\cap S_{\sigma_j}}.
    \end{align}
    It follows that $(\eta_\phi)_i|_{S_{\sigma_i} \cap S_{\sigma_j}} = (\eta_\phi)_j|_{S_{\sigma_i} \cap S_{\sigma_j}}$ and hence we obatin a map $\eta_\phi:S\to \P^r_\Z$.
    This construction clearly only depends on the isomorphism class of $\phi$ (the $f_{ji}$'s are independent of isomorphism class).

    Finally we show functoriality.
    Let $\gamma:T\to S$ be a morphism of schemes.
    Then $e_1,\dots,e_r$ get sent to $\gamma^*\sigma_1,\dots,\gamma^*\sigma_r$ under $\gamma^*(\phi)$.
    The corresponding open sets are $T_{\gamma^*\sigma_i} = \gamma^{-1}(S_{\sigma_i})$ and the corresponding $f_{ji}$'s are $\gamma^*f_{ji} = \gamma^\#f_{ji}$.
    It follows that for each $i$, $(\eta_{\gamma^*(\phi)})_i = (\eta_\phi)_i\circ \gamma|_{T_{\gamma^*\sigma_i}}$.
    Therefore we get that $\eta_{\gamma^*(\phi)} = \eta_\phi\circ \gamma$.
\end{proof}
\begin{remark}
    \label{rem:trans_fn}
    The $f_{ji}|_{S_{\sigma_i}\cap S_{\sigma_j}}$ are the transition functions with respect to the open cover $S_{\sigma_i}$.
\end{remark}
\begin{definition}
    Let $\shf{O}(1)$ denote the sheaf on $\P^r_\Z$ with transition functions $\psi_{ji} = x_i/x_j$.
    Write $\chi_k$ for the section corresponding to $x_k/x_i$ on $U_i$ for $i=0,\dots,r$.
    Then we obtain a surjective morphism $\phi_{\P^r_\Z}:\bigoplus_{k=0}^r\shf{O}_{\P^r_\Z} \to \shf{O}(1)$.
    Note that $\eta_{\phi_{\P^r_\Z}} = \id_{\P^r_\Z}$.
\end{definition}
\begin{thm}
    $\underline \P^r$ is a representable functor with representative $\P^r_\Z$.
\end{thm}
\begin{proof}
    From the lemma we have a natural transformation $\underline \P^r \Rightarrow \Hom(-,\P^r_\Z)$.
    Now consider that map $\Hom(S,\P^r_\Z) \to \underline \P^r(S)$ given by $\xi \to \xi^*(\phi_{\P^r_\Z})$.
    Then 
    \begin{equation}
        \eta_{\xi^*(\phi_{\P^r_\Z})} = \eta_{\phi_{\P^r_\Z}} \circ \xi = \xi
    \end{equation}
    so the composition one way is the identity.
    Conversely, consider a $\phi: \bigoplus_{k=0}^r\shf{O}_S\to \shf L\in \underline \P^r(S)$.
    We wish to show that $(\eta_\phi)^*\shf{O}(1) \cong \shf L$ and under this isomorphism, $(\eta_\phi)^*(\phi_{\P^r_\Z})) = \phi$.
    First note that $(\eta_\phi)^{-1}(U_i) = S_{\sigma_i}$.
    Moreover, the corresponding transition functions for $(\eta_\phi)^*\shf{O}(1)$ are $(\eta_\phi)^\#(x_i/x_j) = f_{ij}|_{S_{\sigma_i} \cap S_{\sigma_j}}$.
    It follows from remark \ref{rem:trans_fn} that $(\eta_\phi)^*\shf{O}(1) \cong \shf L$.
    Finally $(\eta_\phi)^*(\chi_k)$ maps to $f_{ki}$ on the trivialisation on $S_{\sigma_i}$.
    The result follows.
\end{proof}
\section{Ample line bundles}
\begin{lemma}
    \label{lem:ext}
    Let $X$ be a scheme, $\shf{F}$ a quasi-coherent $\shf{O}_X$-module, $\shf{L}$ a line bundle and $f\in \Gamma(X,\shf{L})$.
    \begin{enumerate}
        \item If $X$ is quasi-compact, $s\in \shf{F}(X)$ and $s|_{X_f} = 0$ then there is an $n\ge1$ such that $s\otimes f^{\otimes n} = 0$ in $\shf{F} \otimes \shf{L}^{\otimes n}$.
        \item If $X$ is qsqc and $s\in \shf{F}(X_f)$ then there is an $n\ge1$ such that $s\otimes f^{\otimes n} = t|_{X_f}$ for some $t\in \left(\shf{F}\otimes \shf L^{\otimes n}\right)(X)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    $(1)$ Let $\set{U_i}$ be a finite trivialising cover for $\shf L$ consisting of affines and let $g_i\in \shf{O}_X(U_i)$ be the section corresponding to $f|_{U_i}$ under $\shf L|_{U_i} \cong \shf O_X|_{U_i}$.
    Then $U_i\cap X_f = (U_i)_{g_i}$ so there is an $n\ge1$ (independent of $i$) such that $g_i^ns|_{U_i} = 0$.
    But under the isomorphism $\shf F|_{U_i} \cong \shf F|_{U_i}\otimes \shf O_X|_{U_i}^{\otimes n}\cong \shf F|_{U_i}\otimes \shf L|_{U_i}^{\otimes n}$, $g_i^ns|_{U_i}$ maps to $s|_{U_i}\otimes f|_{U_i}^{\otimes n}$.
    It follows that $s\otimes f^{\otimes n} = 0$.
    $(2)$ Let $\set{U_i}$ and $\set{g_i}$ be as before and let $\set{\psi_{ji}}$ be the transition functions.
    There exists an $n$ (independent of the $i$) such that $g_i^ns|_{(U_i)_{g_i}} = t_i|_{(U_i)_{g_i}}$ for some $t_i\in \shf F(U_i)$.
    Let $\shf G = \shf F\otimes \shf L^{\otimes n}$ and $t_i'$ be the element in $\shf G(U_i)$ corresponding to $t_i$. 
    Then $t_i'|_{U_i\cap X_f} = s\otimes f^{\otimes n}|_{U_i\cap X_f}$.
    Thus we have $t_i'|_{U_i\cap U_j\cap X_f} = t_j'|_{U_i\cap U_j\cap X_f}$.
    But $U_i\cap U_j$ is quasi-compact since $X$ is quasi-serparated and so by $(1)$ there is a $m$ (independent of $i,j$) such that $t_i'\otimes f^{\otimes m}|_{U_i\cap U_j} = t_j'\otimes f^{\otimes m}|_{U_i\cap U_j}$.
    It follows that there is a $t\in \shf G\otimes \shf L^{\otimes m}(X)$ that restricts to the $t_i'\otimes f^{\otimes m}$ and hence to $s\otimes f^{\otimes(m+n)}$ on $X_f$.
\end{proof}
\begin{definition}
    A line bundle $\shf L$ is ample if for any coherent sheaf $\shf F$ on $S$, there is a $n_0\in \N$ such that $\shf F\otimes \shf L^{\otimes n}$ is generated by global sections for all $n\ge n_0$.
\end{definition}
\begin{thm}
    Let $S$ be a noetherian scheme.
    The line bundle $\shf L$ is very ample iff there is $n\in N$ and $\sigma_1,\dots,\sigma_k\in\Gamma(S,\shf L^{\otimes n})$ such that $S_{\sigma_i}$ is affine for all $i$ and $S = \cup_iS_{\sigma_i}$.
\end{thm}
\begin{proof}
    $(\Leftarrow)$ Let $\shf F$ be a coherent sheaf on $S$.
    Then $\shf F|_{S_{\sigma_i}}$ is globally generated, say by $t_{ji}\in \shf F(S_{\sigma_i})$, since $S_{\sigma_i}$ is affine.
    By lemma \ref{lem:ext}, there is an $n\ge 1$ independent of $i$, and $\lambda_{ji}\in (\shf F\otimes \shf L^{\otimes n})(X)$ such that $\lambda_{ji}|_{S_{\sigma_i}} = t_{ji}\otimes \sigma_i^{\otimes n}$.
    It is clear that these $\lambda_{ji}$ globally generate $\shf F\otimes \shf L^{\otimes n}$.
    It is straighfroward to see that $\shf F\otimes \shf L^{\otimes m}$ is also globally generated for $m\ge n$.

    $(\Rightarrow)$ Let $\set{U_i}_i$ be an open cover of $S$ consisting of affines which trivialise $\shf L$.
    Let $Y_i = S\backslash U_i$ and $\shf J_{Y_i}$ be the ideal sheaf associated to $Y_i$.
    Since $\shf L$ is ample there is an $n$ independent of $i$, such that $\shf J_{Y_i}\otimes \shf L^{\otimes n}$ is globally generated for all $i$.
    Let $\tilde\sigma_{ji}\in \shf J_{Y_i}\otimes \shf L^{\otimes n}$ be such that for all $x\in U$ there is a $j$ such that $\tilde\sigma_{ji}\not\in \mf m_x$ (note that $\shf J|_{U_i}\cong \shf O_S|_{U_i}$).
    We have the exact sequence $0\to \shf J_{U_i} \to \shf O_S$ and hence the exact sequence $0\to \shf J|_{U_i}\otimes \shf L^{\otimes n} \to \shf L^{\otimes n}$.
    Let $\sigma_{ji}$ be the image of $\tilde\sigma_{ji}$ in $\shf L^{\otimes n}$.
    Then by construction we have $S_{\sigma_{ji}}\subseteq U_i$ and in fact $U_i = \cup_{j}S_{\sigma_{ji}}$.
    Since $U_i$ is affine and trivialises $\shf L$ we also have that $S_{\sigma_{ji}}$ is also affine.
    The result follows.
\end{proof}
\begin{corollary}
    $\shf O(1)$ is ample.
\end{corollary}
\begin{lemma}
    Let $S$ be a Noetherian scheme, $\shf L$ a line bundle on $S$, $\phi:\bigoplus_{k=0}^r\shf O_S\to \shf L$ a surjective $\shf O_S$-module homomorphism and $\sigma_0,\dots,\sigma_r$ the distinguished images of $\phi$ in $\shf L$.
    If $S_{\sigma_i}$ is affine for all $i$, then the resulting morphism $S\to \P^r_\Z$ is a closed immersion.
\end{lemma}
\begin{thm}
    Let $f:S\to \Spec(R)$ be a morphism of finite type, $R$ a Noetherian ring and $\shf L$ an ample line bundle on $S$.
    Then there is an $n\ge 1$ and $\sigma_0,\dots,\sigma_r\in \Gamma(S,\shf L^{\otimes n})$ such that the corresponding morphism $S\to \P^r_R$ is a closed immersion into an open subset of $\P^r_R$.
\end{thm}
\begin{proof}
    Since $f$ is finite, $S$ is Noetherian.
    Replacing $\shf L^{\otimes n}$ with $\shf L$, we get that there are $\sigma_1,\dots,\sigma_k\in \Gamma(S,\shf L)$ such that $S = \cup_iS_{\sigma_i}$ and the $S_{\sigma_i}$ are affine.
    Each $\Gamma(S_{\sigma_i},\shf O_S)$ is a finitely generated $R$-algebra.
    Let $\set{\sigma_{ji}}$ be the image of a generating set in $\Gamma(S_{\sigma_i},\shf L)$.
    There exists an $n$ independent of $i$ and $t_{ji}\in \Gamma(S,\shf L^{\otimes n})$ such that $\sigma_{ji}\otimes \sigma_i^{\otimes n} = t_{ji}|_{S_{\sigma_i}}$.
    Let $\Sigma$ be the set of $t_{ji}$'s and $\sigma_i$'s and $\psi:\set{0,\dots,r}\to \Sigma$ an arbitrary enumeration of $\Sigma$.
    The resulting morphism $S\to \P^r_R$ is obtained by gluing together the morphisms
    \begin{equation}
        S_{\sigma_i} \to \Spec(R[x_0/x_{\psi^{-1}(\sigma_i)},\dots,x_r/x_{\psi^{-1}(\sigma_i)}]).
    \end{equation}
    These maps are closed immersions (the corresponding maps on global sections are surjective) and so the result follows.
\end{proof}
\section{Cohomological results}
\begin{lemma}
    Let $f:X\to Y$ be an affine morphism of schemes and suppose that $X$ is noetherian.
    Then for all quasi-coherent $\shf O_X$-modules $\shf F$, we have $R^kf_*(\shf F) = 0$ for all $k>0$.
\end{lemma}
\begin{lemma}
    Let $X$ be a Noetherian scheme and $i:X\to Y$ be a closed immersion.
    Then $i$ is an affine morphism.
\end{lemma}
\begin{proof}
    WLOG $Y$ is affine.
    Note that $i_*:\Ab(X)\to \Ab(Y)$ is an exact functor.
    Let $\shf F$ be a quasi-coherent $\shf O_X$-module and $0\to \shf F\to \shf I^\bullet$ a flasque quasi-coherent resolution.
    Then $0 \to i_*\shf F\to i_*\shf I^\bullet$ is a flasque quasi-coherent resolution of $i_*\shf F$.
    Thus, as $Y$ is affine,
    \begin{equation}
        0 = H^k(\Gamma(Y,i_*\shf I^\bullet)) = H^k(\Gamma(X,\shf I^\bullet)) = H^k(X,\shf F)
    \end{equation}
    for $k>0$.
    Thus $X$ must be affine.
\end{proof}
\section{Flatness}
\begin{definition}
    Let $f:X\to Y$ be a morphism of schemes and $\shf F$ an $\shf O_X$-module.
    We say that $\shf F$ is flat over $Y$ at $x\in X$ if $\shf F_x$ is flat as an $\shf O_{Y,f(x)}$-module.
    We sat that $\shf F$ is flat over $Y$ if $\shf F$ is flat at every $x\in X$.
\end{definition}
\begin{proposition}
    Let $\phi:A\to B$ be a ring homomorphism and $M$ a $B$-module.
    $\tilde M$ is flat over $\Spec(A)$ iff $M$ is flat as an $A$-module.
\end{proposition}
\begin{proof}
    $\tilde M$ is flat over $\Spec(A)$ iff $M_{\mf p}$ is flat as an $A_{\phi^{-1}(\mf p)}$ module for all $\mf p\in \Spec(B)$.
\end{proof}
\chapter{Spectral sequences}
\section{Grothendieck spectral sequence}
\begin{thm}
    (Grothendieck spectral sequence).
    Let $F:\mathcal A \to \mathcal B$ and $G:\mathcal B \to \mathcal C$ be left exact functors and suppose that $F$ sends injective objects to $G$-acylic objects.
    Then for $A$ an object in $\mathcal A$ there is a spectral sequence $\{E_r(A)\}$ such that 
    \begin{equation}
        E_2^{p,q}(A) = R^pG(R^qF(A)) \Rightarrow R^{p+q}(GF)(A).
    \end{equation}
\end{thm}
\begin{corollary}
    (Leray spectral sequence).
    Let $f:X\to Y, g:Y\to Z$ be continuous maps.
    Then for a sheaf $\shf{F}$, there is a $E_2$ cohomological spectral sequence
    \begin{equation}
        R^pg_*(R^qf_*(\shf{F})) \Rightarrow R^{p+q}(g\circ f)_*(\shf{F})
    \end{equation}
    which is functorial in $\shf{F}$.
\end{corollary}
\begin{proof}
    $f_*$ sends injective sheaves to flabby sheaves, which are $g_*$-acyclic.
\end{proof}
\chapter{Group cohomology}

\chapter{Appendix - Categorical results}
\section{Category theory results}
\begin{proposition}
    \label{prop:cat_factor}
    Let $F\dashv G$ and $G$ be full.
    Let $e$ be the unit of the adjunction.
    Then every morphism $x\to Gy$ factors uniquely through $e_x:x\to GFx$.
\end{proposition}
\begin{proof}
    Let $\alpha$ and $\beta$ denote the forward and backward maps in
    \begin{equation}
        \Hom(Fx,y) \leftrightarrow \Hom(x,Gy)
    \end{equation}
    respectively.
    Let $f:x\to Gy$.
    Then $f = \alpha(\beta(f))$.
    But $\alpha(\beta(f)) = G\beta(f)\circ e_x$ so we get existence of a factorisation.
    For uniqueness, suppose $f = h\circ e_x$.
    Since $G$ is full there is a $l:Fx\to y$ such that $h = Gl$.
    So $\alpha(l) = \alpha(\beta(f))$.
    But $\alpha$ is a bijection so $l = \beta(f)$ and hence $h = G\beta(f)$ which gives uniqueness.
\end{proof}
\chapter{Appendix - Sheaf theoretic results}
\section{Properties of sheaves of rings}
\begin{thm}
    Let $\shf{F}$ be a sheaf of rings on X and $s\in \shf{F}(X)$.
    The following are equivalent:
    \begin{enumerate}
        \item $s$ is invertible,
        \item There exists an open cover $\set{U_i}_i$ of $X$ such that $s|_{U_i}$ is invertible for all $i$,
        \item $s_x$ is invertible for all $x\in X$.
    \end{enumerate}
\end{thm}
\begin{proof}
    $(1)\Rightarrow(2)$ Trivial. 
    $(2)\Rightarrow (1)$ Suppose $s|_{U_i}$ is invertible for all $i$.
    Then there are $t_i\in\shf{F}(U_i)$ such that $t_is|_{U_i} = 1$.
    But then, since inverses are unique we must have $t_i|_{U_i\cap U_j} = t_j|_{U_i\cap U_j}$ since they are both the inverse of $s|_{U_i\cap U_j}$.
    Thus there is a section $t\in \shf{F}(U)$ that restricts to the $t_i$.
    Checking locally it follows that $ts = 1$ and so $s$ is invertible.
    $(2)\Leftrightarrow(3)$ Trivial.
\end{proof}
\section{Locally ringed spaces}
\begin{lemma}
    Let $(f,f^\#),(g,g^\#):(X,\shf{O}_X)\to (Y,\shf{O}_Y)$ be morphisms of locally ringed spaces.
    Let $\mathcal U = \{U_i\}$ be an open covering of $X$.
    If the morphisms agree on the restrictions to the $U_i$ then they are equal.
\end{lemma}
\begin{proof}
    We certainly have $f = g$.
    The result then follows from sheaf condition (A).
\end{proof}
\begin{proposition}
    Let $X, Y$ and $\{Z_i\}_i$ be locally ringed spaces together with open immersions $f_i:Z_i\to X, g_i:Z_i\to Y$.
    Let $\alpha:X\to Y$ be a morphism such that $\alpha\circ f_i = g_i$ for all $i$ and $\alpha:f_i(Z_i)\cap f_j(Z_j) \to g_i(Z_i)\cap g_j(Z_j)$ is an isomorphism for all $i,j$.
    Then $\alpha$ is an isomorphism.
\end{proposition}
\begin{proof}
    We have that $\alpha:f_i(Z_i)\to g_i(Z_i)$ is an isomorphism for all $i$.
    So we can define inverses $\beta_i:g_i(Z_i)\to f_i(Z_i)$.
    They agree on overlaps and so they glue to give a global inverse $\beta$.
\end{proof}
\begin{proposition}
    Let $f:X\to Y$ be a morphism of schemes and let $\set{U_i}$ be an open cover of $Y$ such that the restriction of $f$ to a morphism $f^{-1}(U_i) \to U_i$ is an isomorphism for all $i$.
    Then $f$ is an isomorphism.
\end{proposition}
\section{Restriction}
\begin{remark}
    Recall from chapter \ref{ch:sheafs} that given $f:X\to Y$ we obtain functors $f_*,\lim_f,f^{-1}$ between $\Sh(X)$ and $\Sh(Y)$.
    These constructions were themselves functorial and give rise to contra/co-variant functors $\Top\to \Set$.
    The same also holds for $f_*,f^*$ as functors between $\Mod(X)$ and $\Mod(Y)$.
\end{remark}
\begin{thm}
    Let $f:X\to Y$ be a continuous map and $U\subseteq X$, $V\subseteq Y$ be open subsets such that $f(U)\subseteq V$.
    Moreover, let $f|_{U,V}$ denote the map $U\to V$ arising from $f|_U$.
    Then for $\shf{F}\in \Sh(X)$ and $\shf{G}\in \Sh(Y)$ we have
    \begin{enumerate}
        \item $(f^{-1}\shf{G})|_U \cong f|_U^{-1}\shf{G} \cong f|_{U,V}^{-1}(\shf{G}|_V)$
        \item $(f_*\shf{F})|_V \cong (f|_{U,V})_*(\shf{F}|_U)$ when $U = f^{-1}(V)$
    \end{enumerate}
    where are isomorphisms are natural.
\end{thm}
\begin{proof}
    \begin{enumerate}
        \item $f|_U = f \circ i_U$ and so we obtain the first isomorphism.
            $f|_U = i_V \circ f|_{U,V}$ and so we obtain the second isomorphism.
        \item Straightforward calculation.
    \end{enumerate}
\end{proof}
\section{Miscellaneous}
\begin{proposition}
    Let $X$ be a topological space and $\shf{F}$ a sheaf on $X$.
    If $U,V$ are disjoint open subsets of $X$, the $\shf{F}(U\cup V) \cong \shf{F}(U)\times \shf{F}(V)$.
\end{proposition}
\begin{proof}
    Obvious.
\end{proof}
\chapter{Appendix - Graded rings and Proj}
\section{Graded rings}
\subsection{General results}
\begin{definition}
    A ($\Z$-)graded ring is a ring $S$ together with a decomposition $S = \bigoplus_{d\in\Z}S_d$ as abelian groups, such that $S_d\cdot S_e\subseteq S_{d+e}$.
    An ideal $\mf a$ of $S$ is called homogeneous if $\mf a = \bigoplus_{d\in\Z}\mf a\cap S_d$.
    A map $\phi:S\to T$ between graded rings is called a graded morphism if it is a ring homomorphism and $\phi(S_d)\subseteq T_d$ for all $d$.
\end{definition}
\begin{proposition}
    Let $S$ be a graded ring and $\mf a$ an ideal of $R$.
    The following are equivalent:
    \begin{enumerate}
        \item $\mf a$ is a homogeneous ideal
        \item $\mf a$ is generated by homogeneous elements
        \item $a\in\mf a\Rightarrow$ the homogeneous parts of $a$ lie in $\mf a$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    $(1)\Rightarrow(2)$ $\mf a$ is generated by $\cup_{d\in\Z}\mf a\cap S_d$. 
    $(2)\Rightarrow(3)$ Trivial. 
    $(3)\Rightarrow(1)$ We always have $\mf a \supseteq \bigoplus_{d\in\Z}\mf a\cap S_d$.
    Now suppose $a\in \mf a$.
    Then clearly $a$ lies in $\bigoplus_{d\in\Z}\mf a\cap S_d$.
\end{proof}
\begin{proposition}
    Let $\phi:S\to T$ be a graded homomorphism and $\mf a$ a homogeneous ideal of $T$.
    Then $\phi^{-1}(\mf a)$ is a homogeneous ideal of $S$.
\end{proposition}
\begin{proof}
    Suppose $\phi(s) \in \mf a$.
    Then $\sum_n\phi(s_n) \in \mf a$.
    But $\mf a$ is homogeneous and so $\phi(s_n)\in \mf a$ for all $n$.
    Thus $s_n\in \phi^{-1}(\mf a)$ for all $n$ and so $\phi^{-1}(\mf a)$ is a homogeneous ideal.
\end{proof}
\begin{proposition}
    The sum, product, intersection and radical of homogeneous ideals are homogeneous.
\end{proposition}
\begin{proof}
    The only nontrivial case is showing that if $\mf a$ is homogeneous then so is $\rad(\mf a)$.
    Let $r = \sum_{d} r_d \in \rad(\mf a)$.
    Then there exists an $n\ge1$ such that $r^n\in \mf a$.
    Let $d_0$ be minimal such that $r_{d_0}\ne 0$.
    Then $r_{d_0}^n$ is the degree $nd_0$ homogeneous part of $r^d$.
    Since $\mf a$ is homogeneous, we must have $r_{d_0}^n\in \mf a$ and so $r_{d_0}\in \rad(\mf a)$.
    Now repeat with $r-r_{d_0}$ to get that the homogeneous parts of $r$ must lie in $\rad(\mf a)$.
\end{proof}
\begin{proposition}
    Let $S$ be a graded ring and $\mf a$ a homogeneous ideal of $S$.
    Then $\mf a$ is prime iff $fg\in \mf a \Rightarrow f\in\mf a$ or $g\in\mf a$ for all homogeneous $f,g\in S$.
\end{proposition}
\begin{proof}
    $(\Rightarrow)$ Trivial. 
    $(\Leftarrow)$ Let $f = \sum_{d}f_d,g = \sum_{d}g_d\in S$ and suppose $fg\in \mf a$.
    Let $d_0$ be the minimal $d$ such that $f_d\ne 0$, and similarly define $d_0'$ in terms of $g$.
    Then $f_{d_0}g_{d_0'}$ is the $d_0+d_0'$ homogeneous part of $fg$ and so must lie in $\mf a$.
    Thus either $f_{d_0}\in \mf a$ or $g_{d_0'}\in \mf a$.
    If both are in $\mf a$, then repeat to $(f-f_{d_0})(g-g_{d_0'})\in \mf a$.
    Otherwise, one must lie in $\mf a$ and the other does not.
    If $f_{d_0}\in \mf a$ and $g_{d_0'}\not\in \mf a$ then $(f-f_{d_0})g\in \mf a$.
    Let $d_1$ denote the degree of the homogeneous part of $f-f_{d_0}$ of minimal degree.
    Then $f_{d_1}g_{d_0'}\in\mf a$.
    But $g_{d_0'}\not\in\mf a$ and so $f_{d_1}\in\mf a$.
    In the other case argue similarly.
    Repeating in the manner we obtain that either $f$ of $g$ must lie in $\mf a$.
\end{proof}
\begin{proposition}
    Let $S$ be a graded ring and $\mf a$ a homogeneous ideal of $S$.
    Then $\mf a$ is a radical ideal iff $f^n\in \mf a \Rightarrow f\in \mf a$ for all homogeneous $f\in S$.
\end{proposition}
\begin{proof}
    $(\Rightarrow)$ Trivial. 
    $(\Leftarrow)$ Let $f\in S$ be such that $f^n\in \mf a$.
    Let $d_0$ be the minimal $d$ such that $f_d\ne 0$.
    Then $(f^n)_{dn} = f_{d_0}^n$.
    Since $\mf a$ is homogeneous, this implies that $f_{d_0}^n\in \mf a$ and so $f_{d_0}\in \mf a$.
    Repeat to $f-f_{d_0}$.
\end{proof}
\begin{thm}
    (Graded localisation).
    Let $S$ be a $\Z$-graded ring and $T$ a multiplicative subset of $S$ consisting of homogeneous elements.
    Then $T^{-1}S$ is a $\Z$-graded ring and the canonical morphism $\phi:S\to T^{-1}S$ is a graded morphism.
\end{thm}
\begin{proof}
    $T^{-1}S$ is a certainly a ring so we only need to define a grading on it.
    Let $T_k$ denote the elements of $T$ with grading $k$ and define $(T^{-1}S)_n$ to be the set of elements in $T^{-1}S$ that can be written as $s/t$ for some $s\in S_i, t\in T_j$ with $i-j = n$.
    We claim that $T^{-1}S = \bigoplus_{n\in\Z}(T^{-1}S)_n$.
    It is clear that $\sum_n(T^{-1}S)_n = T^{-1}S$.
    Now suppose there are distinct $n_1,\dots,n_k\in\Z$ and $x_1\in(T^{-1}S)_{n_1},\dots,x_k\in(T^{-1}S)_{n_k}$ such that $\sum_ix_i = 0$.
    We can write each $x_i$ as $s_i/t_i$ where $s_i\in S, t_i\in T$ are both homogeneous and $\deg(s_i)-\deg(t_i)=n_i$.
    WLOG all the $t_i$ are equal to some $t\in T$.
    Then there is some $u\in T$ such that $u\sum_is_i = 0$.
    But each $s_i$ has a different degree and so $us_i = 0$ for all $i$.
    It follows that each $x_i = 0$ too.
    Thus $T^{-1}S = \bigoplus_{n\in\Z}(T^{-1}S)_n$.
    Finally, the fact that $(T^{-1}S)_n(T^{-1}S)_m\subseteq(T^{-1}S)_{n+m}$ is obvious, and so is the fact that $\phi$ is a graded morphism.
\end{proof}
\begin{proposition}
    Let $\phi:S\to T^{-1}S$ be the canonical homomorphism.
    \begin{enumerate}
        \item Let $I$ be a homogeneous ideal of $S$.
            Then $T^{-1}I$ is a homogeneous ideal of $T^{-1}S$.
        \item Let $J$ be a homogeneous ideal of $T^{-1}S$.
            Then $\phi^{-1}(J)$ is a homogeneous ideal of $S$.
    \end{enumerate}
\end{proposition}
\begin{proof}
    $(1)$ $T^{-1}I$ is generated by the homogeneous elements of $I$.
    $(2)$ $\phi$ is a graded morphism.
\end{proof}
\begin{definition}
    We say a $\Z$-graded ring $S$ is $\Z_{\ge0}$-graded if $S_d = 0$ for all $d<0$.
    For an element $s\in S$ we write $\deg(s)$ for the grading of the homogeneous part of largest grading amongst the non-zero homogeneous parts of $s$.
    We write $S_+$ for the ideal $\bigoplus_{d>0}S_d$.
    We call $S_+$ the irrelevant ideal.
\end{definition}
\begin{remark}
    From now on graded ring will refer to a $\Z_{\ge 0}$-graded ring.
\end{remark}
\begin{definition}
    Fix a ring $A$ and let $S$ be a graded ring.
    If $S_0 = A$ we say that $S$ is a \textit{graded ring over $A$}.
    If $S_+$ is a finitely generated ideal of $S$, we say that $S$ is a \textit{finitely generated graded ring over A}.
    If $S$ is generated by $S_1$ as an $A$-algebra, we say that $S$ is \textit{generated in degree 1}.
\end{definition}
\begin{proposition}
    $S$ is a finitely generated graded ring over $A$ iff $S$ is a finitely generated graded $A$-algebra.
\end{proposition}
\begin{proof}
    $(\Rightarrow)$ Suppose $S_+ = (r_1,\dots,r_k)$.
    WLOG the $r_i$ are all homogeneous.
    We prove by induction on $\deg(r)$ that $r$ lies in $A[r_1,\dots,r_n]$.
    If $\deg(r) = 0$ the result is clear.
    Now suppose $r$ has $\deg(r)>0$.
    Write $r = r_a+r_+$ where $r_a\in A$ and $r_+\in S_+$.
    Since $r_+\in S_+$, we can write $r_+ = \sum_is_ir_i$ for some $s_i\in S$.
    Since $\deg(r_i)>0$, $\deg(s_i)<\deg(r_+)$ for all $i$.
    But then each $s_i\in A[r_1,\dots,r_n]$ by the induction hypothesis.
    It is then clear that $r\in A[r_1,\dots,r_n]$.

    $(\Leftarrow)$ Suppose $S = A[r_1,\dots,r_n]$.
    WLOG $r_i\in S_+$ for all $i$.
    Then $(r_1,\dots,r_n)\subseteq S_+$.
    But $S = A \oplus (r_1,\dots,r_n)$.
    Thus $(r_1,\dots,r_n)=S_+$.
\end{proof}
\begin{corollary}
    $S$ is Noetherian iff $A$ is Noetherian and $S$ is a finitely generated graded ring.
\end{corollary}
\begin{proof}
    $(\Rightarrow)$ If $S$ is Noetherian, then $S_+$ is finitely generated, so $S$ is a finitely generated graded ring.
    To see that $A$ must be Noetherian note that $A \cong S/S_+$ is a quotient of a Noetherian ring and so must be Noetherian itself.
    $(\Leftarrow)$ If $A$ is Noetherian and $S$ is a finitely generated graded ring, then $S$ is a finitely generated $A$-algebra and so must be Noetherian too (by Hilbert's basis theorem + quotients).
\end{proof}
\subsection{Graded localisation}
\begin{definition}
    Let $S$ be a graded ring and $\mf p$ a homogeneous prime ideal of $S$.
    Write $S_{(\mf p)}$ for the $0^{th}$ graded component of $T^{-1}S$ where $T$ is the set of homogeneous elements in $S$ not in $\mf p$.

    For $f\in S_+$ homogeneous write $S_{(f)}$ for the $0^{th}$ graded component of $S_f$.
\end{definition}
\begin{proposition}
    Let $S$ be a graded ring and write $S^{(d)}$ for the subring $\bigoplus_{k\ge0}S_{kd}$.
    If $f\in S$ is a homogeneous element of degree $d$ then $S_{(f)} \cong S^{(d)}/(1-f)$.
\end{proposition}
%\begin{proof}
    %Define the map $\alpha: S^{(d)}\to S_{(f)}$ by sending $s\in S_{kd}$ to $s/f^k$ and extending linearly to the whole of $S^{(d)}$.
    %This clearly defines a ring homomorphism with $(f-1)$ in its kernel so we obtain a map $\bar \alpha:S^{(d)}/(f-1)\to S_{(f)}$.
%
    %To construct the inverse we define the map $\beta:S_{(f)}\to S^{(d)}/(f-1)$ as follows: let $x\in S_{(f)}$. 
    %Then there exists an $k\ge 0$ and $s\in S_{dk}$ such that $x = s/f^k$.
    %Define $\beta(x)$ to be the image of $s$ in $R^{(d)}/(f-1)$.
    %To see that this is well defined, suppose $k'\ge0,s'\in S_{dk'}$ are also such that $x = s'/f^{k'}$.
    %Then there is a $l\ge 0$ such that $f^l(f^{k'}s-f^ks') = 0$.
    %It follows that $s=s'$ in $R^{(d)}/(f-1)$.
    %It is clear that $\beta$ is a ring homomorphism and that $\bar\alpha$ and $\beta$ are inverse.
%\end{proof}
\begin{definition}
    Let $\mf a\normal S_{(f)}$ be a radical ideal.
    Define $\Psi(\mf a)_n = \set{x\in S_n:x^d/f^n \in \mf a}$ and $\Psi(\mf a) = \bigoplus_{n\ge0}\Psi(\mf a)_n$.
\end{definition}
\begin{lemma}
    $\Psi(\mf a)$ is a homogeneous radical ideal of $S$.
    If $\mf a$ is additionally prime, then so is $\Psi(\mf a)$.
\end{lemma}
\begin{proof}
    We first check that $\Psi(\mf a)$ is an ideal.
    Let $x,y\in \Psi(\mf a)_n$.
    Then $x^d/f^n$ and $y^d/f^n$ lie in $\mf a$.
    Thus $((x+y)^d/f^n)^2\in \mf a$ and so $(x+y)^d/f^n\in \mf a$.
    Let $x\in\Psi(\mf a)_n$ and $s\in S_k$.
    Then $x^d/f^n\in \mf a$ and so $(sx)^d/f^{k+n}\in \mf a$.
    Thus $\mf a$ is an ideal.
    By definition it must be homogeneous.
    To check that $\Psi(\mf a)$ is a radical ideal suppose $x\in S_k$ and $x^n\in \Psi(\mf a)_{kn}$ for some $n$.
    Then $x^{dn}/f^{kn} = (x^d/f^k)^n\in \mf a$.
    But $\mf a$ is a radical ideal and so $x^d/f^k\in \mf a$ as required.

    Finally, suppose $\mf a$ is prime.
    Let $x\in S_m,y\in S_n$ be such that $xy\in \Psi(\mf a)_{m+n}$.
    Then $(xy)^d/f^{m+n} = (x^d/f^m)(y^d/f^n)\in \mf a$.
    Thus either $x\in \Psi(\mf a)_m$ of $y\in \Psi(\mf a)_n$.
\end{proof}
\begin{thm}
    \label{thm:f_loc}
    Let $S$ be a graded ring and let $f\in S_+$ be a homogeneous element of degree $d$.
    Then there are maps $\Phi$ and $\Psi$,
    \begin{equation}
        \begin{tikzcd}
            \left\{\mf b \normal S : \begin{array}{c} \mf b \text{ is homog. and radical}\end{array}\right\} \arrow[r,shift right,swap,"\Phi"] & \set{\mf a \normal S_{(f)}: \mf a\text{ radical}} \arrow[l,shift right,swap,"\Psi"]
        \end{tikzcd}
    \end{equation}
    such that $\Phi\circ \Psi = \id$ and $\mf b\subseteq \Psi\circ\Phi(\mf b)$.
    Moreover, these maps restict to a bijection
    \begin{equation}
        \begin{tikzcd}
            \left\{\mf q \normal S : \begin{array}{c} \mf q \text{ is homog. and} \\ \text{prime and } \mf q\not\ni f \end{array}\right\} \arrow[r,shift right,swap,"\Phi"] & \set{\mf p \normal S_{(f)}: \mf p\text{ prime}} \arrow[l,shift right,swap,"\Psi"].
        \end{tikzcd}
    \end{equation}
\end{thm}
\begin{proof}
    Define $\Phi$ by $\mf b\mapsto \mf bS_f\cap S_{(f)}$.
    It is clear that $\Phi(\mf b)$ is radical (resp. prime) if $\mf b$ is radical (resp. prime not containing $f$).
    Moreover we have the explicit description
    \begin{equation}
        \Phi(\mf b) = \set{x\in S_f: x = b/f^k, b\in \mf b_{kd}}
    \end{equation}
    (this holds for any ideal $\mf b$).
    Let $\Psi$ be as defined earlier.
    By the lemma it sends radical (resp. prime) ideals to radical (resp. prime not containing $f$) ideals.

    It is straightforward to check that $\Phi(\Psi(\mf a)) = \mf a$ whenever $\mf a$ is a radical ideal.
    It is also easy to see that $\mf b \subseteq \Psi(\Phi(\mf b))$ for any ideal $\mf b$.
    It remains to check that $\mf q \supseteq \Psi(\Phi(\mf q))$ when $\mf q$ is a homogeneous prime not containing $f$.
    But this is obvious.
\end{proof}
\begin{corollary}
    We have a bijection 
    \begin{equation}
        \set{\mf p \normal S_{(f)}: \mf p\text{ prime}} \leftrightarrow \left\{\mf q \normal S_f : \mf q \text{ homog. and prime} \right\}.
    \end{equation}
\end{corollary}
\begin{proposition}
    Let $S$ be a graded ring, $f\in S_+$ be a homogeneous element of degree $d$ and $\Phi$ be as in the theorem.
    Then for $\mf q\normal S$ a homogeneous prime not containing $f$ we have 
    \begin{equation}
        S_{(\mf q)} \cong \left(S_{(f)}\right)_{\Phi(\mf q)}.
    \end{equation}
\end{proposition}
\begin{proof}
    Let $T$ be the multiplicative set of homogeneous elements in $S$ not in $\mf q$.
    There is a canonical homomorphism $S\to T^{-1}S$.
    Since $f\in T$, this induces a homomorphism $S_f\to T^{-1}S$ which preserves the grading.
    We thus obtain a map $\phi:S_{(f)}\to S_{(\mf q)}$.
    Moreover,
    \begin{align}
        S_{(f)}\backslash \Phi(\mf q) &= \set{x\in S_f: \exists a\in S_{dk}\backslash q_{dk} \text{ s.t. } x=a/f^k} \nonumber \\
                                      &= \set{x\in S_{(f)}: x=a/f^k, a\in S_{dk} \Rightarrow a\not\in \mf q_{dk}}.
    \end{align}
    and so it follows that $S_{(f)}\backslash \Phi(\mf q)$ maps into $(S_{\mf q})^\times$ under $\phi$.
    We now wish to show that $S_{(\mf q)}$ has the required universal property.
    Let $\psi:S_{(f)}\to R$ be any ring homomorphism such that $S_{(f)}\backslash\Phi(\mf q)$ gets sent into $R^\times$ and let $x\in S_{(\mf q)}$.
    We can write $x = a/t$ where $a\in S_m, t\in T$ where $m:= \deg(t)$.
    Since $T\cap \mf q = \emptyset$, $t^d\not\in \mf q$ and so $t^d/f^m\in S_{(f)}\backslash\Phi(\mf q)$.
    We thus define $\eta:S_{(\mf q)}\to R$ by
    \begin{equation}
         \eta(x) = \phi(at^{d-1}/f^m)\cdot\phi(t^d/f^m)^{-1}.
    \end{equation}
    This is well defined: if $x = a'/t'$ write $m'$ for the degree of $t'$.
    There exists $u\in T$ such that $u(t'a-ta') = 0$.
    Write $k$ for the degree of $u$.
    Then
    \begin{equation}
        \frac{u^dt^{d-1}t'^da}{f^{k+m+m'}} = \frac{u^dt'^{d-1}t^da'}{f^{k+m+m'}}
    \end{equation}
    and so since $u^d/f^k\in S_{(f)}\backslash \Phi(\mf q)$,
    \begin{equation}
        \phi\left(\frac{t^{d-1}a}{f^{m}}\right)\phi\left(\frac{t^d}{f^{m}}\right)^{-1} = \phi\left(\frac{t^{d'-1}a'}{f^{m'}}\right)\phi\left(\frac{t'^d}{f^{m'}}\right)^{-1}
    \end{equation}
    as required.
    It is then straightforward to check that $\eta$ is a ring homomorphism and that $\phi = \eta\circ\psi$.
    Uniqueness follows from that fact that $x = (at^{d-1}/f^m)\cdot(t^d/f^m)^{-1}$ in $S_{(\mf q)}$.
\end{proof}
\begin{corollary}
    $S_{(\mf p)}$ is a local ring with maximal ideal $\mf q \cdot (T^{-1}S)\cap S_{(\mf q)}$.
\end{corollary}
\subsection{Miscellaneous}
\begin{definition}
    Let $S$ be a graded ring and let $I$ be an ideal of $S$.
    Write $I^h$ for the ideal generated by the homogeneous elements of $I$.
\end{definition}
\begin{proposition}
    If $\mf p$ is a prime ideal of $S$. 
    Then $\mf p^h$ is also prime.
\end{proposition}
\begin{proof}
    Let $a,b\in S$ be homogeneous.
    If $ab\in \mf p^h\subseteq \mf p$ then either $a\in\mf p$ or $b\in\mf p$.
    But since $a,b$ are homogeneous either $a\in\mf p^h$ or $b\in\mf p^h$.
\end{proof}
\begin{corollary}
    Let $S$ be a graded ring.
    Then for a homogeneous ideal $I$, we have 
    \begin{equation}
        \rad(I) = \bigcap_{\substack{\mf p\supseteq I, \\\text{ homog}}} \mf p.
    \end{equation}
\end{corollary}
\begin{proof}
    We certainly have $(\subseteq)$.
    $(\supseteq)$ follows from the fact that if $\mf a\subseteq \mf p$ then $\mf a \subseteq \mf p^h\subseteq \mf p$.
\end{proof}
\section{The Proj construction}
\begin{definition}
    Let $S$ be a graded ring.
    Define $\Proj(S)$ to be the set of all homogeneous prime ideals of $S$ which do not contain $S_+$.
    If $\mf a$ is a homogeneous ideal of $S$ we define $V(\mf a) = \set{\mf p\in \Proj(S):\mf p\supseteq \mf a}$.
    As before these sets define a topology on $\Proj(S)$.
\end{definition}
\begin{remark}
    Note that we still have $V(I) = V(\rad(I))$.
\end{remark}
\begin{definition}
    (Basic open sets).
    Let $f\in S_+$ be a homogeneous element of $S$.
    Define $D_+(f) = \Proj(S)\backslash V((f))$.
\end{definition}
\begin{proposition}
    The basic open sets form a base of the topology on $\Proj(S)$.
\end{proposition}
\begin{proof}
    Clearly $D_+(f)\cap D_+(g) = D_+(fg)$.
    Finally note that 
    \begin{equation}
        V(I) = V(I\cap S_+) = \bigcap_{\substack{f\in I\cap S_+ \\ \text{homog}}}V((f))
    \end{equation}
    and so $\Proj(S)\backslash V(I) = \bigcup_{\substack{f\in I\cap S_+ \\ \text{homog}}}D_+(f)$.
\end{proof}
\begin{proposition}
    Let $S$ be a graded ring and $I$ a homogeneous ideal of $S$.
    Then $V(I) = \emptyset$ iff $\rad(I) \supseteq S_+$.
\end{proposition}
\begin{proof}
    $(\Leftarrow)$ Follows from $V(I) = V(\rad(I))$.
    $(\Rightarrow)$ $V(I) = \emptyset$. Thus $I\subseteq \mf p$ implies $S_+ \subseteq \mf p$. 
    But then $S_+ \subseteq \rad(I)$.
\end{proof}
\begin{lemma}
    Let $f\in S_+$ be a homogeneous element and let $\Phi:D_+(f)\to \Spec(S_{(f)})$ be the map from theorem \ref{thm:f_loc}.
    Then $\Phi$ is a homeomorphism.
\end{lemma}
\begin{proof}
    Let $C$ be a closed subset of $\Spec(S_{(f)})$. 
    Then $C = V(\mf a)$ for some radical ideal $\mf a\normal S_{(f)}$.
    It is easy to see from theorem \ref{thm:f_loc} that $\Phi^{-1}(C) = V(\Psi(\mf a))\cap D_+(f)$.
    Similarly, any closed subset of $D_+(f)$ is of the form $D_+(f)\cap V(\mf b)$ for some homogeneous radical ideal $\mf b$ and $\Phi(D_+(f)\cap V(\mf b)) = V(\Phi(\mf b))$.
\end{proof}
\begin{remark}
    Let $g = s/f^k\in S_{(f)}$.
    Then $\mf q\in \Phi^{-1}(V(g))$ iff $\Phi(\mf q)\supseteq (g)$ iff $s\in \mf q$ iff $\mf q\in D_+(f)\cap V((s))$.
    Thus $\Phi^{-1}(D(g)) = D_+(fs)$.
\end{remark}
\begin{definition}
    We can turn $\Proj(S)$ into a locally ringed space by defining the structure sheaf to be
    \begin{equation}
        \shf{O}_{\Proj(S)}(U) = \left\{s:U\to\coprod_{\mf p\in \Proj(S)}S_{(\mf p)}:\begin{array}{c} \text{for each $\mf p\in U$ there exists an} \\ \text{open neighbourhood $V$ of $\mf p$ in $U$, }\\ \text{and homogeneous elements $a,f\in S$} \\ \text{of the same degree such that for all} \\ \text{$\mf q\in V$, $f\not\in \mf q$ and $s(\mf q) = a/f$ in $S_{(\mf q)}$.}\end{array}\right\}.
    \end{equation}
\end{definition}
\begin{thm}
    Let $S$ be a graded ring.
    \begin{enumerate}
        \item For any $\mf p\in \Proj(S)$, $\shf{O}_{\mf p}\cong S_{(\mf p)}$.
        \item For any homogeneous $f\in S_+$, $(D_+(f),\shf{O}|_{D_+(f)}) \cong \Spec(S_{(f)})$.
        \item $\Proj(S)$ is a scheme.
    \end{enumerate}
\end{thm}
\begin{proof}
    $(1)$ Trivial. Note that this means that $\Proj(S)$ is a locally ringed space.
    $(2)$ We have from the previous lemma that the underlying topological spaces are homeomorphic.
    We have also established that $S_{(\mf q)}\cong (S_{(f)})_{\Phi(\mf q)}$.
    Using this isomorphism we can construct a map $D_+(f)\to \Spec(S_{(f)})$ which is an isomorphism on stalks.
    It follows that they must be isomorphisms as locally ringed spaces.
    $(3)$ then follows.
\end{proof}
\chapter{Appendix - Scheme theoretic results}
\section{Basic open sets}
\begin{proposition}
    Let $X$ be a scheme and $f\in \Gamma(X,\shf{O}_X)$.
    Then for affine $U\subseteq X$, $X_f\cap U = U_{f|_U}$ is a basic open set.
\end{proposition}
\begin{proof}
    It suffice to prove that for $X=\Spec(R)$ and $r\in R$, $X_r = D_r(R)$.
    But
    \begin{equation}
        X_r = \set{\mathfrak p \normal R : r/1 \not\in \mathfrak p_{\mathfrak p}} = \set{\mathfrak p \normal R : r\not\in \mathfrak p} = D_r(R).
    \end{equation}
\end{proof}
\begin{proposition}
    Let $(f,f^\#):X\to Y$ be a morphism of schemes and $r\in \Gamma(Y,\shf{O}_Y)$.
    Then $f^{-1}(Y_r) = X_{f^\#(Y)(r)}$.
\end{proposition}
\begin{proof}
    Recall that $f^\#_x:\shf{O}_{Y,f(x)}\to \shf{O}_{X,x}$ is a morphism of local rings.
    Thus $r_{f(x)}\in \mathfrak m_{f(x)}$ iff $f^\#_x(r_{f(x)}) \in \mathfrak m_x$.
    But $f^\#_x(r_{f(x)}) = f^\#(Y)(r)_x$ and so
    \begin{align}
        f^{-1}(Y_r) &= \set{x\in X: r_{f(x)} \not\in \mathfrak m_{f(x)}} \nonumber \\
                    &= \set{x\in X: f^\#(Y)(r)_x \not\in \mathfrak m_x} = X_{f^\#(Y)(r)}.
    \end{align}
\end{proof}
\begin{proposition}
    Let $X$ be a scheme and $U,V$ be open affine subsets.
    Then there exists a cover of $U\cap V$ consisting of sets which are basic with respect to both $U$ and $V$.
\end{proposition}
\begin{proof}
    Let $x\in U\cap V$.
    Then there is a $f\in \shf{O}_X(U)$ such that $x\in U_f\subseteq U\cap V$.
    Let $g\in \shf{O}_X(V)$ be such that $x\in V_g\subseteq U_f$.
    Then $(U_f)_{g|_{U_f}} = V_g$, both of which are basic with respect to $U$ and $V$ respectively.
\end{proof}
\begin{lemma}
    (The Affine Communication Lemma).
    Let $P$ be some property enjoyed by some affine open subsets of a scheme $X$ such that
    \begin{enumerate}
        \item if an affine open subset $\Spec(A)\hookrightarrow X$ has property $P$, then for any $f\in A$, $\Spec(A_f)\hookrightarrow X$ does too
        \item if $(f_1,\dots,f_n) = A$ and $\Spec(A_{f_i})\hookrightarrow X$ has $P$ for all $i$, then so does $\Spec(A)\hookrightarrow X$.
    \end{enumerate}
    Suppose that $X = \cup_{i\in I}\Spec(A_i)$ where $\Spec(A_i)$ has property $P$. 
    Then every affine open subset of $X$ has $P$ too.
\end{lemma}
\begin{definition}
    We call such a property an affine-local property.
\end{definition}
\section{Quasi-separated schemes}
\begin{definition}
    We say a topological space $X$ is quasi-separated if the intersection of any two quasi-compact open subsets is quasi-compact.
\end{definition}
\begin{thm}
    Let $X$ be a scheme.
    The following are equivalent:
    \begin{enumerate}
        \item $X$ is quasi-separated
        \item The intersection of any two affine open subsets is a finite union of affine open subsets
        \item There exists an open cover $\set{V_i}_i$ such that $V_i\cap V_j$ is a finite union of affine open subsets for any $i,j$.
    \end{enumerate}
\end{thm}
\begin{proof}
    $(1)\Rightarrow(2)$ Obvious. 
    $(2)\Rightarrow(3)$ Obvious.
    $(3)\Rightarrow(1)$ Let $U,V$ be quasi-compact open subsets of $X$.
    The inclusion maps $V_i\hookrightarrow X$ are all quasi-compact and so $V_i\cap U$ is quasi-compact for all $i$.
    Thus $U\hookrightarrow X$ is quasi-compact and so $U\cap V$ is quasi-compact.
\end{proof}
\begin{corollary}
    Affine schemes are quasi-separated.
\end{corollary}
\begin{corollary}
    A scheme $X$ is quasi-compact and quasi-separated iff $X$ can be covered by a finite number of affine open subsets, any two of which have intersection also covered by a finite number of affine open subsets.
\end{corollary}
\begin{proposition}
    \label{prop:aff_cover_aff}
    Let $X$ be a quasi-compact and quasi-separated scheme and $f_1,\dots,f_k\in\Gamma(X,\shf{O}_X)$ be such that $(f_1,\dots,f_k) = \Gamma(X,\shf{O}_X)$. 
    If $X_{f_i}$ is affine for all $i$, then $X$ is affine.
\end{proposition}
\begin{proof}
    Identical to the noetherian case.
\end{proof}
\section{Spec adjunction}
\begin{thm}
    Let $(X,\shf{O}_X)$ be a scheme and $A$ a ring. 
    Then there is a natural bijection
    \begin{equation}
        \Hom_\Sch(X,\Spec(A)) \leftrightarrow \Hom_\Ring(A,\Gamma(X,\shf{O}_X)).
    \end{equation}
    In other words $\Gamma \dashv \Spec$ as functors between $\Sch$ and $\Ring^{op}$.
\end{thm}
\begin{proof}
    Given a morphism $(f,f^\#):(X,\shf{O}_X) \to (\Spec(A),\shf{O}_{\Spec(A)})$ we obtain map $A\to \Gamma(X,\shf{O}_X)$ from $f^\#(\Spec(A))$.

    Conversely, suppose we have $\phi:A\to \Gamma(X,\shf{O}_X)$.
    For an affine $U\subseteq X$, we have the map $A\to \Gamma(X,\shf{O}_X) \to \Gamma(U,\shf{O}_X)$, and we thus obtain a map $U\to \Spec(A)$.
    Let $U,V\subseteq X$ be affine and $W\subseteq U\cap V$ also be affine.
    The following diagram commutes
    \begin{equation}
        \begin{tikzcd}[column sep=small,row sep=small]
            & & \Gamma(U,\shf{O}_X) \arrow[dr] & \\
            A \arrow[r] & \Gamma(X,\shf{O}_X) \arrow[ur] \arrow[dr] \arrow[rr] & & \Gamma(W,\shf{O}_X) \\
                        & & \Gamma(V,\shf{O}_X) \arrow[ur] &
        \end{tikzcd}
    \end{equation}
    and so 
    \begin{equation}
        \begin{tikzcd}[column sep=small,row sep=small]
                     & U \arrow[dl] & \\
            \Spec(A) & & W \arrow[dl] \arrow[ul] \arrow[ll] \\
                     & V \arrow[ul] &
        \end{tikzcd}
    \end{equation}
    also commutes.
    So the morphisms agree on overlaps and so can be glued to get a morphism $X\to \Spec(A)$.

    It is straightforward to check that this defines a bijection.
\end{proof}
\begin{corollary}
    Let $(X,\shf{O}_X)$ be a scheme. 
    There is a canonical morphism $X\to \Spec(\Gamma(X,\shf{O}_X)$ such that every morphism from $X$ to an affine scheme factors through this map uniquely.
\end{corollary}
\begin{proof}
    This follows from proposition \ref{prop:cat_factor}.
\end{proof}
\section{Sheaf of ideals}
\begin{definition}
    Let $\shf{F}$ be a sheaf on $X$.
    Then $\supp(\shf{F}) = \{x\in X: \shf{F}_x \ne 0\}$.
\end{definition}
\begin{proposition}
    \label{prop:supp}
    If $\shf{F}$ is a finitely generated $\shf{O}_X$-module then $\supp(X)$ is a closed subset of $X$.
\end{proposition}
\begin{definition}
    A subsheaf of $\shf{O}_X$ is called a \textit{sheaf of ideals} on $X$.
\end{definition}
\begin{definition}
    Let $\shf{J}$ be a sheaf of ideals on $X$.
    Let $Z = \supp(\shf{O}_X/\shf{J})$.
    By proposition \ref{prop:supp}, $Z$ is a closed subset of $X$.
    Let $i:Z\to X$ be the inclusion map.
    Then we define the structure sheaf on $X$ to be $\shf{O}_Z = i^{-1}(\shf{O}_X/\shf{J})$.
    This turns $Z$ into a locally ringed space.
\end{definition}
\begin{proposition}
    $i_*\shf{O}_Z \cong \shf{O}_X/\shf{J}$.
\end{proposition}
\begin{proof}
    There is a natural map $\shf{O}_X/\shf{J}\to i_*\shf{O}_Z = i_*i^{-1}(\shf{O}_X/\shf{J})$ arising from the inverse image-direct image adjunction.
    Looking at stalks shows that this is an isomorphism.
\end{proof}
\begin{remark}
    In particular there is a natural map $i^\#:\shf{O}_X\to i_*\shf{O}_Z$ given by the composition $\shf{O}_X\to \shf{O}_X/\shf{J}\to i_*\shf{O}_Z$ inducing a morphism $(i,i^\#)$ of locally ringed spaces.
\end{remark}
\begin{corollary}
    The map $(i,i^\#):(Z,\shf{O}_Z)\to (X,\shf{O}_X)$ is a closed immersion and $\shf{J} = \ker(i^\#)$.
\end{corollary}
\begin{lemma}
    Let $A$ be a ring and $I\normal A$ be an ideal.
    Then the sheaf $(A/I)^\sim$ on $\Spec(A)$ has support $V(I)$.
\end{lemma}
\begin{proof}
    Consider the following exact sequence of $A$-modules
    \begin{equation}
        0\to I \to A \to A/I \to 0.
    \end{equation}
    If $I\nsubseteq \mathfrak p$ then $IA_{\mathfrak p} = A_{\mathfrak p}$ and so $(A/I)_{\mathfrak p} = 0$.
    If $I\subseteq \mathfrak p$ then $(A/I)_{\mathfrak p} \cong (A/I)_{\mathfrak q}$ where $\mathfrak q = \mathfrak p/I$ and so is in particular not $0$.
\end{proof}
\begin{thm}
    \label{thm:sheaf_of_ideals}
    If $\shf{J}$ is quasi-coherent then $(Z,\shf{O}_Z)$ is a scheme and for any affine piece $(U,\shf{O}_X|_U) \cong (\Spec(A),\shf{O}_{\Spec(A)})$ of $X$, $(Z\cap U,\shf{O}_Z|_{Z\cap U})$ is isomorphic to $(\Spec(A/I),\shf{O}_{\Spec(A/I)})$ where $I$ is the ideal of $A$ corresponding to $J(U)$.
\end{thm}
\begin{proof}
    It suffices to show the second part of the theorem.
    Let $(U,\shf{O}_X|_U) \cong (\Spec(A),\shf{O}_{\Spec(A)})$ be an affine piece of $X$.
    Restricting the short exact sequence $0\to\shf{J}\to\shf{O}_X\to i_*\shf{O}_Z\to 0$ to $U$ we get
    \begin{equation}
        0\to\shf{J}|_U \to\shf{O}_X|_U \to (i_{U\cap Z})_*(\shf{O}_Z|_{U\cap Z})\to 0.
    \end{equation}
    It follows that 
    \begin{equation}
        \label{eq:sh_isoms}
        (i_{U\cap Z})_*(\shf{O}_Z|_{U\cap Z}) \cong (A/I)^\sim \cong \Spec(\phi)_*\shf{O}_{\Spec(A/I)}
    \end{equation}
    where $\phi:A\to A/I$ is the quotient map.
    By the lemma $U\cap Z = V(I)$ and so there is a homeomorphism $\psi:\Spec(A/I)\to U\cap Z$.
    Since both $i_{U\cap Z}$ and $\Spec(\phi)$ are homeomorphisms onto their images, the isomorphisms in equation \ref{eq:sh_isoms} induce isomorphisms of sheaves.
    Taking stalks moreover shows that we get an isomorphism of locally ringed spaces as required.
\end{proof}
\begin{thm}
    \label{thm:ideal-subsch}
    There is a bijection
    \begin{equation}
        \set{\text{quasi-coherent ideal sheaves of } \shf O_X} \leftrightarrow \set{\text{closed subschemes of } X}.
    \end{equation}
\end{thm}
\begin{proof}
    Given a quasi-coherent ideal sheaf $\shf I$ of $\shf O_X$ we obatin a closed embedding $Z\to X$.
    Conversely, given a closed embedding $i:Z\to X$ we obatin an ideal sheaf from the kernel of $\shf O_X\to i_*\shf O_Z$.
    We need only show that any such kernel is quasi-coherent since we have already showed that the maps are mutually inverse.
    Let $\shf I$ denote the kernel of $i^\#$ and let $U = \Spec(A)$ be an affine piece of $X$.
    $i$ is an affine morphism so $W = i^{-1}(U)$ is also affine and so $i|_W:W\to U$ is given by $\Spec(A\to A/I)$ for some ideal $I$ of $A$.
    Thus the exact sequence 
    \begin{equation}
        0 \to \shf I|_U \to \shf O_X|_U \to i|_{W*}\shf O_Z|_W \to 0
    \end{equation}
    becomes
    \begin{equation}
        0 \to \shf I|_U \to \shf O_{\Spec(A)} \to (A/I)^\sim \to 0
    \end{equation}
    and so $\shf I|_U = \tilde I$ and so $\shf I$ is quasi-coherent.
\end{proof}
\begin{remark}
    Let $Z$ be a closed subset of $X$.
    Then the bijection specialises to
    \begin{equation}
        \left\{\begin{array}{c}\text{q-c ideal sheafs } \shf I \text{ such} \\ \text{that } \supp(\shf O_X/\shf I) = Z\end{array}\right\} \leftrightarrow \left\{\begin{array}{c}\text{closed subschemes w/ underlying} \\ \text{topological space } Z \end{array}\right\}.
    \end{equation}
\end{remark}
\section{Reduced schemes}
\begin{definition}
    A scheme $(X,\shf{O}_X)$ is reduced if $\shf{O}_X(U)$ is reduced for all $U\subseteq X$ open.
\end{definition}
\begin{lemma}
    $(X,\shf{O}_X)$ is reduced iff $\shf{O}_{X,p}$ is reduced for all $p\in X$.
\end{lemma}
\begin{lemma}
    Let $\shf{J}$ be the ideal sheaf of $\shf{O}_X$ given by $U\mapsto N(\shf{O}_X)$.
    Then $\shf{J}$ is quasi-coherent.
\end{lemma}
\begin{proof}
    It suffices to show that $\shf{J}\cong N(\shf{O}_X(X))^\sim$ when $X$ is affine.
    But we have an isomorphism on the basis and hence between sheaves.
\end{proof}
\begin{definition}
    Let $(X,\shf{O}_X)$ be a scheme. 
    We define $(X_{red},(\shf{O}_X)_{red})$ to be the scheme associated with the sheaf of ideals $\shf{J}$ given by $\shf{J}(U) = N(\shf{O}_X(U))$.
    Let $(z,z^\#):(X_{red},(\shf{O}_X)_{red})\to (X,\shf{O}_X)$ be the associated closed embedding.
\end{definition}
\begin{remark}
    $X_{red}$ is reduced since it is reduced on affine pieces.
\end{remark}
\begin{proposition}
    $z$ is a homeomorphism.
\end{proposition}
\begin{proof}
    It suffices to check that $\supp(\shf{O}_X/\shf{J}) = X$ for affine $X$.
    Let $\phi:R\to R/N(R)$ be the quotient map. Then $\Spec(\phi)$ is a homeomorphism.
    It follows that $\supp(\shf{O}_X/\shf{J}) = X$ and so $z$ is the identity map.
\end{proof}
\begin{thm}
    Let $f:X\to Y$ be a morphism of schemes and suppose $X$ is reduced.
    Then $f$ factors through $Y_{red}$.
\end{thm}
\begin{proof}
    Universal property of cokernels.
\end{proof}
\begin{definition}
    For an affine scheme $X$, let $I(Z)$ be the radical ideal corresponding to a closed set $Z\subset X$.
    For a general scheme $X$ and a closed subset $Z\subseteq X$, let $\shf{J}_Z$ be the sheaf
    \begin{equation}
        \shf{J}_Z(U) = \{f\in \shf{O}_X(U) : f_x\in m_x, \forall x\in U\cap Z\}.
    \end{equation}
\end{definition}
\begin{lemma}
    Let $X$ be an affine scheme and $Z\subseteq X$ a closed subset. 
    Then $\shf{J}_Z\cong \tilde{I(Z)}$.
\end{lemma}
\begin{proof}
    This holds on global sections and $\rad$ commutes with localisation.
\end{proof}
\begin{thm}
    Let $X$ be a scheme and $Z\subseteq X$ a closed subset.
    Then there is a unique quasi-coherent ideal $\shf{J}$ such that the associated closed immersion $Z'\to X$ has image $Z$ and $Z'$ reduced.
\end{thm}
\begin{proof}
    $\shf{J} = \shf{J}_Z$ is quasi-coherent and the associated embedding has image $Z$.
    It is clear that $Z'$ is reduced (check on affine pieces).
    It thus remains to check the uniqueness of $\shf{J}$.
    For this it suffices to consider the affine case.
    Let $X = \Spec(A)$ and $\shf{J} = \tilde I$. 
    Then $Z' = \Spec(A/I)$ and $V(I) = Z$.
    But $Z'$ is reduced iff $I = I(Z)$.
    Thus $\shf{J} = \shf{J}_{Z}$.
\end{proof}
\begin{remark}
    If we take $Z = X$ then $Z' = X_{red}$.
\end{remark}
\begin{remark}
    If $X$ is a Noetherian scheme then for any affine $U = \Spec(R)$, we have that $\shf J_Z(U)$ is an ideal of $R$ and so is finitely generated.
    It follows that all ideal sheaves on Noetherian schemes are coherent.
\end{remark}
\begin{proposition}
    Let $Z$ be a closed subset of $X$ and $i:Z'\to X$ the corresponding reduced scheme.
    If $j:Z''\to X$ is any closed immersion with image $Z$, then $i$ factors through $j$.
\end{proposition}
\begin{proof}
    By theorem \ref{thm:ideal-subsch} it suffices to show that $\shf I_Z$ is the largest ideal with $\supp(\shf O_X/\shf I) = Z$.
    But any such sheaf $\shf I$ must have $\shf I_x\subseteq \mf m_x$ for $x\in Z$.
    It follows that $\shf I\subseteq \shf I_Z$ as required.
\end{proof}
\begin{proposition}
    Let $f:Y\to X$ be a morphism. 
    Then there exists a unique smallest closed subscheme which $f$ factors through.
\end{proposition}
\begin{proof}
    Let $\shf I = \ker f^\#$.
    If $X$.
\end{proof}
\section{Fibre products}
\begin{proposition}
    Let $f:X\to S$ and $g:S'\to S$ be morphisms, $U\subseteq S$ and $V\subseteq g^{-1}(U)$.
    Then $X\times_SV = f^{-1}(U)\times_UV$.
\end{proposition}
\section{Presheaves on the category of schemes}
\begin{definition}
    Let $F:\Sch^{op}\to \Set$ be a functor.
    We call $F$ locally sheafy if for any scheme $X$, $F|_{\Top(X)}$ is a sheaf of sets.
\end{definition}
\begin{thm}
    Let $F,G:\Sch^{op}\to \Set$ be locally sheafy functors and suppose there is a natural transformation $\eta:F|_{\Aff^{op}}\Rightarrow G|_{\Aff^{op}}$.
    Then there is a unique natural transformation $\zeta:F\Rightarrow G$ such that $\zeta|_{\Aff} = \eta$.
\end{thm}
\begin{proof}
    Let $X$ be a scheme and $s\in F(X)$.
    We wish to define $\zeta_X(s)\in G(X)$.
    For each affine piece $U$ of $X$, define $t_U = \eta_{U}(s|_{U})\in G(U)$.
    Given any two affine pieces $U$ and $V$ we have $t_U|_{U\cap V} = \eta_{U\cap V}(s|_{U\cap V}) = t_V|_{U\cap V}$.
    Since the union of all affine pieces of $X$ is $X$ we obtain an element $t\in G(X)$ such that $t|_U = t_U$ for all affine $U\subseteq X$.
    Define $\zeta_X(s) = t$.
    Note that if $X$ was already affine then $\zeta_X = \eta_X$.
    We claim that $\zeta$ is a natural transformation.
    
    Let $X,Y$ be schemes and $f:X\to Y$ a morphism (in $\Sch$).
    Let $U\subseteq Y$ and $V\subseteq f^{-1}(U)\subseteq X$ be affine pieces and $f|_{V,U}:V\to U$ denote the map such that $f \circ i_V = i_U \circ f|_{V,U}$.
    Then we know that 
    \begin{equation}
        \begin{tikzcd}
            F(U) \arrow[rrr,"\eta_U"] \arrow[ddd,"Ff_{V,U}"] & & & G(U) \arrow[ddd,"Ff_{V,U}"] \\
                                         & F(Y) \arrow[r,"\zeta_Y"] \arrow[ul] \arrow[d,"Ff"] & G(Y) \arrow[d,"Gf"] \arrow[ur] & \\
                                        & F(X) \arrow[r,"\zeta_X"] \arrow[dl] & G(X) \arrow[dr] & \\
            F(V) \arrow[rrr,"\eta_V"] & & & G(V)
        \end{tikzcd}
    \end{equation}
    commutes except for the middle square.
    Thus $G(i_V) \circ (Gf \circ \zeta_Y) = G(i_V) \circ (\zeta_X \circ Ff)$.
    But we can vary the $U$ and $V$ so that the $V$ cover $X$.
    It follows that $Gf \circ \zeta_Y = \zeta_X \circ Gf$.
    Thus $\zeta$ is a natural transformation.

    To see that $\zeta$ is unique, suppose $\xi:F\Rightarrow G$ is another natural transformation extending $\eta$.
    Then let $s\in F(X)$ and $U\subseteq X$ be an affine piece.
    We must have $G(i_U) \circ \zeta_X(s) = \eta_U \circ F(i_U) = G(i_U) \circ \xi_X(s)$.
    But we can vary $U$ to cover $X$ and so we must have $\zeta_X(s) = \xi_X(s)$ for all $s\in F(X)$ and hence $\zeta_X = \xi_X$ for all $X$ and hence $\zeta = \xi$.
\end{proof}
\begin{corollary}
    Let $F,G:\Sch^{op}\to \Set$ be locally sheafy functors such that $F|_{\Aff^{op}} \cong G|_{\Aff^{op}}$.
    Then $F\cong G$.
\end{corollary}
\begin{conjecture}
    There is an equivalence of categories between locally sheafy presheafs on $\Sch$ and locally sheafy presheafs on $\Aff$.
\end{conjecture}
\begin{proof}
    Given $F:\Aff^{op}\to \Set$ define $\tilde F:\Sch^{op}\to \Set$ by $X\mapsto \varprojlim_{U\subseteq X}F(U)$ where $U$ ranges over affine subsets of $X$ and send morphisms to the obvious things.
\end{proof}
\chapter{Appendix - Vector Bundles}
\begin{proposition}
    Let $\pi:E\to X$ be a vector bundle of rank $n$ with trivialisation $\set{U_i}_i$ and transition functions $\set{\psi_{ji}}_{ji}$.
    \begin{enumerate}
        \item If $C\subseteq X$ is a closed subset of $X$ then $\pi:\pi^{-1}(C)\to C$ is a vector bundle of rank $n$ with trivialisation $\set{U_i\cap C}_i$ and transition functions $\set{\psi_{ji}|_{U_{ij}\cap C}}$.
        \item If $Z$ is a topological space then $\pi'=\id\times\pi:Z\times E\to Z\times X$ is a vector bundle with trivialisation $\set{Z\times U_i}_i$ and transition functions $\set{\psi_{ji}'(z,u) = \psi_{ji}(u)}$.
    \end{enumerate}
\end{proposition}
\begin{corollary}
    Let $\pi:E\to Y$ be a vector bundle of rank $n$ with trivialisation $\set{U_i}$ and transition functions $\set{\psi_{ji}(u)}_{ji}$.
    If $f:X\to Y$ is a continuous map then $\pi':f^*E\to X$ is a vector bundle of rank $n$ with trivialisation $\set{f^{-1}(U_i)}_i$ and transition functions $\set{\psi_{ji}(f(v))}_{ji}$.
\end{corollary}
\begin{proof}
    $f^*E$ is the vector bundle arising from the closed subset of $X\times E\to X\times Y$ given by $G = \set{(x,f(x)):x\in X}$.
    But there is a homeomorphism $X\leftrightarrow G$ which descends to $f^{-1}(U_{i})\leftrightarrow (X\times U_{i})\cap G$.
    This gives the required trivialisations.
    It also follows that the transition functions are of the required form.
\end{proof}
\end{document}

