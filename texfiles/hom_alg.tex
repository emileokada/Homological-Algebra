\documentclass{memoir}

\input{header}
\title{Homological algebra}
\author{Emile T. Okada}

\begin{document}
\maketitle
\tableofcontents
\chapter{Abelian Categories}
\section{Additive categories}
Let $\mathcal A$ be a category such that the hom-sets carry the structure of an abelian group and composition is bilinear. We call such a category $\Ab$-enriched.
An additive category is an $\Ab$-enriched category which has finite coproducts and a zero object.
\begin{thm}
    \label{thm:atosa}
    Let $\mathcal A$ be an additive category.
    Then finite coproducts in $\mathcal A$ are in fact finite biproducts.
\end{thm}
\begin{proof}
    It is easy to see that initial objects are isomorphic to terminal objects (and they both exist) and so it suffices to show the result for binary coproducts.
    Let $A,B\in \mathcal A$.
    Define $p_A:A\coprod B\to A$ and $p_B:A\coprod B\to B$ as the maps making the following diagrams commute.
    \begin{equation}
        \begin{tikzcd}[column sep=large]
            A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"\id_A"] & & & A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"0"] & \\
                                     & A\coprod B \arrow[r,"p_A"] & A & & A\coprod B \arrow[r] & B \\
            B \arrow[ur,"i_B"] \arrow[urr,bend right=30,swap,"0"] & & & B \arrow[ur,"i_B"] \arrow[urr,bend right=30,swap,"\id_B"] &
        \end{tikzcd}
    \end{equation}
    Let $f=i_A\circ p_A + i_B\circ p_B$. Then
    \begin{equation}
        \begin{tikzcd}[column sep=large]
            A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"i_A"] &  \\
                                     & A\coprod B \arrow[r,"f"] & A\coprod B  \\
            B \arrow[ur,"i_B"] \arrow[urr,bend right=30,swap,"i_B"] & 
        \end{tikzcd}
    \end{equation}
    commutes and so by universality we must have $f = \id_{A\coprod B}$.
    Now suppose we have maps $f:C\to A$ and $g:C\to B$. 
    Let $h:C\to A\coprod B$ be the map $i_A\circ f+i_B\circ g$.
    Then $p_A\circ h = f$ and $p_B\circ h = g$.
    Moreover, if $h':C\to A\coprod B$ is any other map satisfying $p_A\circ h' = f$ and $p_B\circ h' = g$ then $h' = id_{A\coprod B}\circ h' = i_A\circ f+i_B\circ g = h$ and so $A\coprod B$ is a biproduct.
\end{proof}

A functor between additive categories is called additive if it is a homomorphism on hom-sets.
\section{Semiadditive categories}
The above definition of an additive category includes the additive structure on the hom-sets as data. 
In this section we provide a definition where the additive structure arises as a property instead.

Let $\mathcal A$ be a category with a zero object.
Recall that in such a category there always exists a morphism between to any two objects $A,B\in\mathcal A$ given by $A\to 0 \to B$. We call this the $0$ morphism.
Moreover if finite coproducts and finite products exists there is a canonical map $A\coprod B\to A\prod B$ arising from the diagram
\begin{equation}
    \begin{tikzcd}[column sep = huge]
        A \arrow[r,"\id_A"] \arrow[dr,near start,"0"] & A \\
        B \arrow[r,swap,"\id_B"] \arrow[ur,near start,swap,"0"] & B.
    \end{tikzcd}
\end{equation}
We call a category $\mathcal A$ \textit{semiadditive} if it has a zero object, finite products, finite coproducts and the canonical map $A\coprod B\to A\prod B$ is an isomorphism for all $A,B\in \mathcal A$.
In such a category we write $A\oplus B$ for the biproduct.

\begin{thm}
    Let $\mathcal A$ be a semiadditive category then it is naturally enriched over the monoidal category of commutative monoids.
\end{thm}
\begin{proof}
    Let $\Delta_A:A\oplus A\to A$ and $\nabla_A:A\to A\oplus A$ be the maps that make
    \begin{equation}
        \begin{tikzcd}
            A \arrow[dr,"i_A"] \arrow[drr,bend left=30,"\id_A"] & & & & & A \\
                                                                & A\oplus A \arrow[r,"\Delta_A"] & A & A \arrow[r,"\nabla_A"] \arrow[urr,bend left=30,"\id_A"] \arrow[drr,bend right=30,"\id_A"] & A\oplus A \arrow[dr,"p_A'"] \arrow[ur,"p_A"] & \\
            A \arrow[ru,"i_A'"] \arrow[urr,bend right=30,"\id_A"] & & & & & A
        \end{tikzcd}
    \end{equation}
    commute.
    Given $f,g:A\to B$ we can construct a map $f\oplus g: A\oplus A\to B\oplus B$ in the obvious way.
    We can then define $f+g:A\to B$ to be the composite 
    \begin{equation}
        \begin{tikzcd}
            A \arrow[r,"\nabla_A"] & A \oplus A \arrow[r,"f\oplus g"] & B \oplus B \arrow[r,"\Delta_B"] & B.
        \end{tikzcd}
    \end{equation}
    Note that there is a map $t_A:A\oplus A\to A\oplus A$ arising from the diagram
    \begin{equation}
        \begin{tikzcd}[column sep = huge]
            A \arrow[r,"0"] \arrow[dr,near start,"\id_A"] & A \\
            A \arrow[r,swap,"0"] \arrow[ur,near start,swap,"\id_A"] & A.
        \end{tikzcd}
    \end{equation}
    It is then an easy check to see that $\Delta_A\circ t_A = \Delta_A$ and $t_A\circ \nabla_A = \nabla_A$, from which it follows that $+$ is commutative.
    Straightforward calculations also show that $+$ is associative, distributes over compositions and has the zero map as identity.
    The result follows.
\end{proof}
A functor between semiadditive categories is called semiadditive if it preserves zero objects and biproducts i.e. there are isomorphisms $F(A\oplus B) \cong F(A)\oplus F(B)$ such that 
\begin{equation}
    \begin{tikzcd}[column sep=large]
        F(A) \arrow[dr,"F(i_A)"] \arrow[drr,bend left=30,"i_{F(A)}"] &  \\
                                                             & F(A\oplus B) \arrow[r,"\cong"] & F(A)\oplus F(B)  \\
        F(B) \arrow[ur,"F(i_B)"] \arrow[urr,bend right=30,swap,"i_{F(B)}"] & 
    \end{tikzcd}
\end{equation}
commutes, and similarly for the projection maps.
\begin{proposition}
    \label{prop:sa}
    Let $F:\mathcal A\to\mathcal B$ be a semiadditive functor and $f,g:A\to B$ for $A,B\in\mathcal A$.
    Then $F(f+g) = F(f)+F(g)$.
\end{proposition}
\begin{proof}
    Obvious.
\end{proof}

We now define an additive category to be a semiadditive category where the enriched hom-sets are in fact groups.
\begin{thm}
    \label{thm:as}
    Let $\mathcal A$ be an additive category according to the first definition. 
    By theorem \ref{thm:atosa}, $\mathcal A$ is semiadditive and so the hom-sets naturally carry the structure of a commutative monoid.
    This monoidal structure agrees with the original group structure.
\end{thm}
\begin{proof}
    Let $A,B\in\mathcal A$ and $f,g:A\to B$.
    Then the addition arising from the semiadditive structure comes from the composition
    \begin{equation}
        \begin{tikzcd}
            A \arrow[r,"\nabla_A"] & A \oplus A \arrow[r,"f\oplus g"] & B \oplus B \arrow[r,"\Delta_B"] & B.
        \end{tikzcd}
    \end{equation}
    But $\nabla_A = i_A^L+i_A^R,\Delta_B = p_B^L+p_B^R$ and $f\oplus g = i_B^L\circ f\circ p_A^L + i_B^R\circ g\circ p_A^R$ and so their composition is just $f+g$.
\end{proof}
\begin{corollary}
    Let $F:\mathcal A\to \mathcal B$ be a functor between additive categoires. Then $F$ is additive iff $F$ it is semiadditive.
\end{corollary}
\begin{proof}
    Semiadditive $\implies$ additive follows from proposition \ref{prop:sa} and theorem \ref{thm:as}.
    Additive $\implies$ semiadditive is a straigtforward exercise.
\end{proof}
\begin{corollary}
    Let $F:\mathcal A\to\mathcal B$ be a functor between additive categories which is a left adjoint.
    Then $F$ is additive.
\end{corollary}
\begin{proof}
    $F$ preserves colimits and so is semiadditive.
\end{proof}
\begin{corollary}
    If $\mathcal A$ is an additive category then $\mathcal A^{op}$ is also additive.
\end{corollary}
\begin{proof}
    The oppositive category of a semiadditive category is clearly also semiadditive.
    The resulting monoidal structure on the hom-sets are also clearly the same and so the result follows.
\end{proof}
\section{Abelian categories}
Abelian categories are additive categories with more strucure. 
Before we state exactly what we mean by this we give some definitions.
\begin{definition}
    Let $\mathcal A$ be an additive category and $f:A\to B$ a morphism in $\mathcal A$.
    \begin{enumerate}
    \item A kernel of $f$ is an equaliser of \begin{tikzcd} A\arrow[r,shift right,swap,"0"] \arrow[r,shift left,"f"] & B\end{tikzcd}.
    \item A cokernel of $f$ is a coequaliser of the same diagram.
    \item $f$ is called monic if $f\circ g = 0$ implies $g=0$ for all $g$.
    \item $f$ is called epi if $g\circ f = 0$ implies $g=0$ for all $g$.
    \end{enumerate}
\end{definition}
\begin{remark}
    It is easy to see that all kernels are monic, all cokernels are epi, a map is monic iff its kernel is 0, and a map is epi iff its cokernel is 0.
\end{remark}
We call an additive category $\mathcal A$ pre-abelian if all morphisms have kernels and cokernels.
In such a category, given any morphism $f:A\to B$ we can form 
\begin{equation}
    \label{eq:canon-decomp}
    \begin{tikzcd}
        & & \ker(\coker(f)) \arrow[dr,"i"] & & \\
        K \arrow[r,"\ker(f)"] & A \arrow[rr,"f"] \arrow[ur,dashed,"\alpha"] \arrow[dr,"p"] & & B \arrow[r,"\coker(f)"] & C \\
                          & & \coker(\ker(f)) \arrow[ur,dashed,"\beta"] & & 
    \end{tikzcd}
\end{equation}
where $\alpha$ and $\beta$ exist from the universal property of kernels and cokernerls respectively.
Since $p$ is epi and $0 = \coker(f)\circ f = \coker(f)\circ \beta\circ p$ it follows that $\coker(f)\circ \beta = 0$ and so there is a map $\gamma:\coker(\ker(f))\to\ker(\coker(f))$ such that $i\circ \gamma = \beta$.
Similarly there is a map $\gamma':\coker(\ker(f))\to\ker(\coker(f))$ such that $\gamma'\circ p = \alpha$.
Using that $p$ is epi one can see that $\gamma'=\gamma$ and so for any morphism $f$ there is a canonical decomposition
\begin{equation}
    A\xrightarrow{p} \coker(\ker(f)) \xrightarrow{\gamma_f} \ker(\coker(f)) \xrightarrow{i} B.
\end{equation}
An abelian category is a pre-abelian category in which $\gamma_f$ is an isomorphism for every $f$.
\begin{thm}
    \label{thm:abcat}
    Let $\mathcal A$ be a pre-abelian category.
    Then $\gamma_f$ is an isomorphism for all morphism $f$ iff every monic is the kernel of its cokernel and every epi is the cokernel of its kernel.
\end{thm}
\begin{proof}
    $(\Rightarrow)$ The kernel of a monic is the $0$ object with the $0$ map, and the cokernel of this is just $A$ together with the identity.
    Thus, if $\gamma_f$ is an isomorphism the canonical decomposition of $f$ just becomes
    \begin{equation}
        A\xrightarrow{\id} A \xrightarrow{\cong} \ker(\coker(f)) \xrightarrow{i} B
    \end{equation}
    and so $f$ is the kernel of its cokernel. 
    Similarly one obtains that if $f$ is epi it is the cokernel of its kernel.
    
    $(\Leftarrow)$ First note that if a kernel is epi then it must be an isomorphism so all epic monics must be isomorphisms (since all monics are kernels).
    Thus, it suffices to show that the maps $\alpha$ and $\beta$ in equation \ref{eq:canon-decomp} are epi and monic respectively.
    To see that $\beta$ is monic let $x:X\to \coker(\ker(f))$ be a map such that $\beta\circ x = 0$.
    Then let $q:\coker(\ker(f))\to\coker(x)$ be the coker of $x$, and $j:\coker(x)\to B$ the map such that $j\circ q = \beta$.
    Finally let $l:\ker(q\circ p)\to A$ be the kernel of $q\circ p$.
    Then we have the following diagram
    \begin{equation}
        \begin{tikzcd}
            \ker(q\circ p) \arrow[dr,"l"] \arrow[dd,dashed] & & & \\
            & A \arrow[rr,"f"] \arrow[dr,"p"] & & B \\
            \ker(f) \arrow[ru,"k"] & & \coker(\ker(f)) \arrow[dr,"q"] \arrow[ur,"\beta"] & \\
                               & X \arrow[ru,"x"] & & \coker(x). \arrow[uu,"j"]
        \end{tikzcd}
    \end{equation}
    Since $q\circ p$ is epi it is the coker of $l$.
    But also $f\circ l = j\circ q\circ p\circ l = 0$, so $l$ factors through $\ker(f)$ and so $p\circ l=0$.
    Thus there exists $p':\coker(x)\to\coker(\ker(f))$ such that
    \begin{equation}
        \begin{tikzcd}
            \ker(q\circ p) \arrow[r,"l"] & A \arrow[r,"p"] \arrow[d,"q\circ p"] & \coker(\ker(f)) \\
                                     & \coker(x) \arrow[ur,dashed,swap,"p'"]
        \end{tikzcd}
    \end{equation}
    commutes.
    Since $p$ is epi, it must follow that $p'\circ q = \id$.
    Thus $q$ is monic and so $x=0$.
    It follows that $\beta$ is monic.
    Similarly one can show that $\alpha$ is epi.
\end{proof}
It follows that an abelian category is equvalently a pre-abelian category in which every monic is the kernel of its cokernel and every epi is the cokernel of its kernel.
\begin{thm}
    If $\mathcal A$ is an abelian category then $\mathcal A^{op}$ is also an abelian category.
\end{thm}
\begin{proof}
    It is certainly additive.
    Moreover, kernels and cokernels simply swap roles.
    $\gamma_f$ is then still an isomorphism for all $f$ and so $\mathcal A^{op}$ is abelian.
\end{proof}
From now on we write $\im(f) := \ker(\coker(f))$ and $\coim(f) := \coker(\ker(f))$.
\section{Exact sequences}
\label{sec:es}
Let $\mathcal A$ be an abelian category and $\mathcal S$ be the category with objects given by $A\xrightarrow{f} B\xrightarrow{g} C$ such that $g\circ f = 0$, and morphisms given by chain maps.
Recall from earlier that $f$ can be factored as
\begin{equation}
    \begin{tikzcd}
        A \arrow[r,twoheadrightarrow,"p_f"] & \im(f) \arrow[r,hookrightarrow,"i_f"] & B.
    \end{tikzcd}
\end{equation}
Since $p_f$ is epi, we must have $g\circ i_f = 0$.
Thus we can factor $f$ further through $\ker(g)$ to obtain $f:A\to\im(f)\to\ker(g)\to B$.
Let $H(A\xrightarrow{f} B\xrightarrow{g} C)$ be the cokernel of the morphism $\im(f)\to\ker(g)$.
If we have the commutative diagram
\begin{equation}
    \begin{tikzcd}
        A \arrow[r,"f"] \arrow[d] & B \arrow[r,"g"] \arrow[d] & C \arrow[d] \\
        A' \arrow[r,"f'"] & B' \arrow[r,"g'"] & C'
    \end{tikzcd}
\end{equation}
then there exists maps so that 
\begin{equation}
    \begin{tikzcd}
        A \arrow[r] \arrow[d] & \im(f) \arrow[r] \arrow[d] & \ker(g) \arrow[r] \arrow[d] & B \arrow[r] \arrow[d] & C \arrow[d] \\
        A' \arrow[r] & \im(f') \arrow[r] & \ker(g') \arrow[r] & B' \arrow[r] & C'
    \end{tikzcd}
\end{equation}
commutes.
In particular there is a morphism 
\begin{equation}
    \coker(\im(f)\to\ker(g))\to\coker(\im(f')\to\ker(g')).
\end{equation}
It is easy to check that this construction is functorial so we obtain a functor $H:\mathcal S\to \mathcal A$.

One can similarly construct a functor $H':\mathcal S\to\mathcal A$ by considering 
\begin{equation}
    \ker(\coker(f)\to\coim(g))
\end{equation}
instead.
\begin{remark}
    We may also form a functor by looking simply at the fact that $f$ factors through $\ker(g)$ and then looking at the coker of the resulting morphism $A\to\ker(g)$. It is an easy check to see that this yields a functor naturally isomorphic to $H$. Similarly for $H'$.
\end{remark}
\begin{lemma}
    Let $A\xrightarrow{f} B\xrightarrow{g} C\in\mathcal S$.
    Recall that we have the factorisation 
    \begin{equation}
        A\rightarrow \im(f) \rightarrow \ker(g)\rightarrow B \rightarrow \coker(f) \rightarrow \coim(g) \rightarrow C.
    \end{equation}
    Let $h$ be the composition $\ker(g)\to B \to\coker(f)$.
    Then
    \begin{enumerate}
        \item $\ker(h) = \im(f)\to\ker(g)$
        \item $\coker(h) = \coker(f)\to\coim(g)$.
    \end{enumerate}
\end{lemma}
\begin{proof}
    Straightforward.
\end{proof}
\begin{thm}
    The functors $H,H':\mathcal S\to\mathcal A$ are naturally isomorphic.
\end{thm}
\begin{proof}
    Let $S := A\xrightarrow{f} B\xrightarrow{g} C\in\mathcal S$ and $h$ be as in the lemma.
    Then $H(S) = \coker(\ker(h))$ and $H'(S) = \ker(\coker(h))$ so we obtain the factorisation
    \begin{equation}
        \ker(g) \to H(S) \xrightarrow{\cong} H'(S) \to \coker(f).
    \end{equation}
    Naturality of the isomophism then follows from naturality of this factorisation.
\end{proof}
\begin{remark}
    In a pre-abelian category we still have a natrual transformation $H\Rightarrow H'$, but it might not be an isomorphism.
\end{remark}
\begin{definition}
    Let $S := A\xrightarrow{f} B\xrightarrow{g} C\in\mathcal S$.
    We say that $S$ is exact at $B$ if $H(S) = 0$.
\end{definition}
\subsection{Split sequences}
\section{Adjoint functors}
Let $L:\mathcal A\to\mathcal B$ be an additive functor between abelian categories.
If $L$ admits a right adjoint $R:\mathcal B\to\mathcal A$ then it turns out $L$ has a lot of useful properties. 
In this section we explore these properties.
\begin{proposition}
    Suppose $L\dashv R$. Then $L$ is right exact and $R$ is left exact.
\end{proposition}
\begin{proof}
    Consider the short exact sequence $0\to B_1\to B_2\to B_3\to 0$. For every $A\in\mathcal A$ we get the following commutative diagram 
    \begin{equation}
        \begin{tikzcd}
            0 \arrow[r] & \Hom(L(A),B_1) \arrow[r] \arrow[d,"\cong"] & \Hom(L(A),B_2) \arrow[r] \arrow[d,"\cong"] & \Hom(L(A),B_3) \arrow[d,"\cong"] \\
            0 \arrow[r] & \Hom(A,R(B_1)) \arrow[r] & \Hom(A,R(B_2)) \arrow[r] & \Hom(A,R(B_3))
        \end{tikzcd}
    \end{equation}
    where the top row is exact.
    It follows that the bottom row is exact for all $A$ and so the bottow row is too.
    It follows that 
    \begin{equation}
        \begin{tikzcd}
            0 \arrow[r] & R(B_1) \arrow[r] & R(B_2) \arrow[r] & R(B_3)
        \end{tikzcd}
    \end{equation}
    is exact and so $R$ is left exact.
    By a similar argument $L$ is right exact.
\end{proof}
\begin{proposition}
    Suppose $L\dashv R$. Then
    \begin{enumerate}
        \item if $L$ is exact then $R$ preserves injectives
        \item if $R$ is exact then $L$ preserves projectives.
    \end{enumerate}
\end{proposition}
\begin{proof}
    Suppose $L$ is exact and $I$ is an injective object in $\mathcal B$.
    We need to show that $\Hom(-,R(I))$ is exact.
    To do this it suffices to show that given $f:A\to B$ injective, the map $f^*:\Hom(B,R(I))\to\Hom(A,R(I))$ is surjective.
    But $L$ is exact so $Lf$ is injective and so $(Lf)^*:\Hom(LB,I)\to\Hom(LA,I)$ is surjective.
    We also have that $L\dashv R$ and so 
    \begin{equation}
        \begin{tikzcd}
            \Hom(L(B),I) \arrow[d,"\cong"] \arrow[r,"(Lf)^*"] & \Hom(L(A),I) \arrow[d,"\cong"] \\
            \Hom(B,R(I)) \arrow[r,"f^*"] & \Hom(A,R(I))
        \end{tikzcd}
    \end{equation}
    commutes.
    It follows that $f^*$ is surjective as required.

    The corresponding result for $R$ follows similarly.
\end{proof}
\chapter{Sheaf Theory}
\section{Presheaves}
Let $\mathcal C$ be any category, $\mathcal A$ be an abelian category and define $\PreSh(\mathcal C) = \Fun(\mathcal C^{op},\mathcal A)$ to be the category of presheaves on $\mathcal C$ with values in $\mathcal A$.
The functor sending all objects to $0$ is certainly both initial and terminal, direct sums can be defined pointwise, and the hom-sets in $\PreSh(\mathcal C)$ inherit an additive structure from $\mathcal A$ so $\PreSh(\mathcal C)$ is naturally an additive category.
Moreover kernels and cokernels can be contructed in the obvious way and it is clear that they satisfy the axioms for an abelian category and so $\PreSh(C)$ is abelian.
\section{Sheaves}
To define sheaves we restrict to the case when $X$ be a topological space, $\mathcal U$ the poset of open sets of X, and $\mathcal A$ be an abelian category.
We write $\PreSh(X)$ for $\PreSh(\mathcal U)$.
The category of sheaves on $X$ with values in $\mathcal A$, $\Sh(X)$, is defined to be the full subcategory of $\PreSh(X)$ with objects given by presheaves $\shf{F}$ for which the following diagram is an equalizer for all open coverings $U = \cup_i U_i$
\begin{equation}
\shf{F}(U)\rightarrow \prod_i \shf{F}(U_i) \rightrightarrows \prod_{i,j} \shf{F}(U_i\cap U_j).
\end{equation}
Since $\mathcal A$ is an abelian category this is equivalent to the following diagram being exact
\begin{equation}
0\rightarrow \shf{F}(U)\rightarrow \prod_i \shf{F}(U_i) \xrightarrow[]{\text{diff}} \prod_{i,j} \shf{F}(U_i\cap U_j).
\end{equation}
Note that since $\varnothing$ admits the empty covering and the empty product is $0$ this forces $\shf{F}(\varnothing) = 0$.

As in the case of $\PreSh(\mathcal C)$, $\Sh(X)$ is an additive category.
However, the cokernel of a morphism between sheaves need not be a sheaf and so we must do some more work to show that $\Sh(X)$ is abelian.

Fix $x\in X$.
For a (pre)sheaf $\shf{F}$ define the stalk of $\shf{F}$ at $x$ to be 
\begin{equation}
    \shf{F}_x = \varinjlim_{U\ni x}\shf{F}
\end{equation}
when this limit exists. Note that this is a functor since morphisms between (pre)sheaves are natural transformations.
\begin{thm}
    Let $\phi:\shf{F}\to \shf{G}$ be a morphism of sheaves.
    \begin{enumerate}
        \item If $\phi_x$ is injective for all $x\in X$ then $\phi$ is injective on sections.
        \item If $\phi_x$ is an isomorphism for all $x\in X$ then $\phi$ is an isomorphism.
    \end{enumerate}
\end{thm}
\begin{proof}
Exercise.
\end{proof}
\subsubsection{Aside}
Although we do not need this right away, given an $A\in \mathcal A$ we can define the (pre)sheaf $x_*A$ by 
\begin{equation}
    (x_*A)(U) = \begin{cases}
        A & \textit{if } x\in U \\
        0 & otherwise
    \end{cases}
\end{equation}
\begin{proposition}
    When it exists, the functor $(-)_x:\Sh(X)\to \mathcal A$ is left adjoint to $x_*:\mathcal A\to \Sh(X)$.
\end{proposition}
\begin{proof}
    To see this simply note that morphisms between $\shf{F}$ and $x_*(A)$ correspond naturally to natrual transformations between $\shf{F}$ restricted to $U\ni x$ and $\Delta(A)$.
\end{proof}
\begin{remark}
    The result also holds in $\PreSh(X)$.
\end{remark}
\section{\'Etal\'e space of a presheaf and sheafification}
For a presheaf $\shf{F}$ we are now in the position to define its \'etal\'e space.
The \'etal\'e space of $\shf{F}$, denoted $\Spe(\shf{F})$ is the topological space with underlying set $\amalg_{x\in X}\shf{F}_x$ and topology generated by the basis of sets given by $\{s_x|x\in U\}$ for $s\in \shf{F}(U)$ where $U\subset X$ is open.
Together with this space there is also a natural continuous map $\pi:\Spe(\shf{F})\to X$ sending an element $s_x$ to $x$.
The sheafification of $\shf{F}$, denoted $\shf{F}^+$, is then defined to be the sheaf of sections of $\pi:\Spe(\shf{F})\to X$.
By unwrapping the definitions we see that the sections can be characterised as
\begin{align}
    \shf{F}^+(U) = \{s:U\to\amalg_{x\in U}\shf{F}_x : & \forall x\in U, \exists V\subset U \text{ open containing $x$ and } \nonumber \\
                                                            & t\in\shf{F}(V) \text{ s.t. }  s(y) = t_y \forall y\in V\}
\end{align}
In particular there is a natural morphism $\shf{F} \to \shf{F}^+$ sending $s\in \shf{F}(U)$ to the section $x\mapsto s_x$ which is an isomorphism on stalks.
From the characterisation of sections it clear that if $\shf{F}$ is a presheaf of $\AbGrp,\Ring,...$ then $\shf{F}^+$ is a sheaf with values in the corresponding abelian category.

We have defined $\Spe$ and $(-)^+$ on objects but they can also be turned into functors.
If we have a morphism $\phi:\shf{F}\to\shf{G}$ between presheaves, this induces a continuous map $\Spe(\phi):\Spe(\shf{F})\to \Spe(\shf{G})$ given by $s_x\mapsto\phi_x(s_x)$ so that 
\begin{equation}
    \begin{tikzcd}
        \Spe(\shf{F}) \arrow[rr, "\Spe(\phi)"] \arrow[rd,"\pi"] & & \Spe(\shf{G}) \arrow[dl,"\pi"] \\
                                              & X &
    \end{tikzcd}
\end{equation}
commutes.
This construction is functorial and turns $\Spe$ into a functor from presheaves to topological bundles over $X$.
It follows that we also obtain a map of sheaves $\phi^+:\shf{F}^+\to\shf{G}^+$ by composing sections with $\Spe(\phi)$.
Thus we have a functor $(-)^+:\PreSh(X)\to\Sh(X)$ and in fact the following diagram commutes.
\begin{equation}
    \label{eq:sheafif}
    \begin{tikzcd}
        \shf{F}^+ \arrow[r,"\phi^+"] & \shf{G}^+ \\
        \shf{F} \arrow[u] \arrow[r,"\phi"] & \shf{G} \arrow[u]
    \end{tikzcd}
\end{equation}
Note that since the morphism $\shf{F}\to\shf{F}^+$ is an isomorphism when $\shf{F}$ is a sheaf, this says that the functor $(-)^+$ restricted to $\Sh(X)$ is natrually isomorphism to the identity functor.

\begin{thm}
    Let $\theta:\shf{F}\to\shf{F}^+$ be the natural morphism. 
    Then for any morphism of presheaves $\phi:\shf{F}\to \shf{G}$ with $\shf{G}$ a sheaf, there exists a unique morphism of sheaves $\psi:\shf{F}^+\to\shf{G}$ so that 
    \begin{equation}
        \begin{tikzcd}
            \shf{F}^+ \arrow[r,"\psi"] & \shf{G} \\
            \shf{F} \arrow[ur,"\phi"] \arrow[u,"\theta"]
        \end{tikzcd}
    \end{equation}
    commutes.
\end{thm}
\begin{proof}
    This just follows from equation \ref{eq:sheafif}, the fact that $\theta:\shf{G}\to\shf{G}^+$ is an isomorphism when $\shf{G}$ is a sheaf, and by taking stalks.
\end{proof}
\begin{corollary}
    The sheafification functor is left adjoint to the inclusion functor $\iota:\Sh(X)\to\PreSh(X)$.
\end{corollary}
\begin{proof}
    Let $\shf{F}$ be a presheaf and $\shf{G}$ be a sheaf.
    Given a morphism $\phi:\shf{F}^+\to\shf{G}$ we can precompose it with $\theta:\shf{F}\to\shf{F}^+$ to obtain a map $\shf{F}\to\iota\shf{G}$.
    Conversely, given $\psi:\shf{F}\to\iota\shf{G}$, we obtain a map $\shf{F}^+\to \shf{G}$ from the theorem.
    Then the theorem says these operations are inverse so we have a bijection 
    \begin{equation}
        \Hom(\shf{F}^+,\shf{G}) \cong \Hom(\shf{F},\iota\shf{G}).
    \end{equation}
    Naturality is then an easy check.
\end{proof}
\begin{corollary}
    The sheafification functor is exact.
\end{corollary}
\begin{proof}
    It is a left adjoint so it is right exact.
    It thus suffices to show that if $\phi:\shf{F}\to\shf{G}$ is injective then so is $\phi^+$.
    For this it suffices to show that $\phi_x$ is injective for all $x$.
    But this is obvious.
\end{proof}
We can now define the cokernel of a morphism $\phi:\shf{F}\to\shf{G}$ in $\Sh(X)$.
We simply define it to be the sheafification of the cokernel in $\PreSh(X)$ and it is an easy to check to see that this is indeed a cokernel object in $\Sh(X)$.
It is then easy to see that $\ker\coker = \coker\ker$ by looking at stalks and so $\Sh(X)$ is an abelian category.
\begin{remark}
    While $\Sh(X)$ is a full subcategory of $\PreSh(X)$ that is abelian, it is not a full abelian subcategory.
\end{remark}
\section{Exact sequences}
Now that we know that we are working in an abelian category we can talk about exact sequences in $\Sh(X)$.
Recall from section \ref{sec:es} that $\shf{F}\xrightarrow{\theta}\shf{G}\xrightarrow{\phi}\shf{H}$ is exact at $\shf{G}$ if $\phi\circ\theta=0$ and the map induced map $\im(\theta)\to\ker(\phi)$ is an isomorphism.
But the map $\im(\theta)\to\ker(\phi)$ is an isomorphism iff it is an isomorphism at the level of stalks iff $\shf{F}_x\xrightarrow{\theta_x}\shf{G}_x\xrightarrow{\phi_x}\shf{H}_x$ is exact for all $x\in X$.
Thus exactness in $\Sh(X)$ can be verified by checking exactness at all the stalks.
\section{Sheaves over different spaces}
\subsection{Direct image sheaf}
Let $f:X\to Y$ be a continuous map between topological spaces and $\shf{F}$ a sheaf on $X$.
We define the direct image of $\shf{F}$ under $f$ to be the sheaf $f_*\shf{F}$ on $Y$ defined by $f_*\shf{F}(U) = \shf{F}(f^{-1}(U))$.
If we define $f_*$ on morphisms in the obvious way then it is clear that we obtain a functor $f_*:\Sh(X)\to\Sh(Y)$.
In fact we also obtain a functor $f_*:\PreSh(X)\to\PreSh(Y)$ and it turns out this functor has nice left adjoint.

Define $\lim_f:\PreSh(Y)\to\PreSh(X)$ to be the functor that sends $\shf{F}\in \PreSh(Y)$ to the presheaf $\lim_f(\shf{F})(U) = \varinjlim_{V\supset f(U)}\shf{F}(V)$ on $X$, and does the obvious things to morphisms.
\begin{thm}
    $\lim_f\dashv f_*$ as functors between $\PreSh(X)$ and $\PreSh(Y)$.
\end{thm}
\begin{proof}
    Let $\phi:\lim_f\shf{F}\to \shf{G}$ be a morphism of presheaves.
    For $V$ open in $Y$, $f^{-1}(V)$ is open in $X$ and so we have maps
    \begin{equation}
        \shf{F}(V)\to\varinjlim_{W\supset f(U)}\shf{F}(W) \to \shf{G}(U)
    \end{equation}
    where $U=f^{-1}(V)$.
    If $V'\subset V$, $U = f^{-1}(V)$ and $U'=f^{-1}(V')$ then
    \begin{equation}
        \begin{tikzcd}
            \shf{F}(V) \arrow[r] \arrow[d] \arrow[dr] & \displaystyle\varinjlim_{W\supset f(U)}\shf{F}(W) \arrow[r] \arrow[d] & \shf{G}(U) \arrow[d] \\
            \shf{F}(V') \arrow[r] & \displaystyle\varinjlim_{W\supset f(U')}\shf{F}(W) \arrow[r] & \shf{G}(U')
        \end{tikzcd}
    \end{equation}
    commutes and so these maps in fact define a morphism $\shf{F}\to f_*\shf{G}$.

    Conversely suppose we are given a morphism $\shf{F}\to f_*\shf{G}$.
    Let $U$ be open in $X$.
    For $V\supset f(U)$ we have maps
    \begin{equation}
        \shf{F}(V)\to \shf{G}(f^{-1}(V)) \to \shf{G}(U).
    \end{equation}
    Moreover if $V\supset V'\supset f(U)$ then
    \begin{equation}
        \begin{tikzcd}[column sep=tiny,row sep=tiny]
            \shf{F}(V) \arrow[r] \arrow[dd] & \shf{G}(f^{-1}(V)) \arrow[dd] \arrow[dr] & \\ 
                                 & & \shf{G}(U) \\
            \shf{F}(V') \arrow[r] & \shf{G}(f^{-1}(V')) \arrow[ur] & \\ 
        \end{tikzcd}
    \end{equation}
    commutes so we obtain maps $\varinjlim_{V\supset f(U)}\shf{F}(V)\to\shf{G}(U)$.
    If $U\supset U'$ we have maps
    \begin{equation}
        \begin{tikzcd}
            \displaystyle \varinjlim_{V\supset f(U)}\shf{F}(V) \arrow[r] \arrow[d] & \shf{G}(U) \arrow[d] \\ 
            \displaystyle \varinjlim_{V\supset f(U')}\shf{F}(V) \arrow[r] & \shf{G}(U').
        \end{tikzcd}
    \end{equation}
    A straighforward calculation shows that this commutes and so we obatin a morphism $\lim_f\shf{F}\to\shf{G}$.

    These operations are clearly inverse to each other.
    A straightforward calculation shows that the bijection is natural.
\end{proof}
\begin{corollary}
    $\lim_f$ is an exact functor.
\end{corollary}
\begin{proof}
    It is a left adjoint so it is right exact. 
    Thus it suffices to show that it sends injective maps to injective maps. But this is obvious.
\end{proof}
\subsection{Inverse image sheaf}
Let $f:X\to Y$ be a continuous map between topological spaces and $\shf{F}$ a sheaf on $Y$.
Let $f^{-1}\Spe(\shf{F})$ be the pullback 
\begin{equation}
    \begin{tikzcd}
        f^{-1}\Spe(\shf{F}) \arrow[r,dashed] \arrow[d,dashed,"\pi"] \arrow[dr, phantom, "\lrcorner", very near start] & \Spe(\shf{F}) \arrow[d,"\pi"] \\
        X \arrow[r,"f"] & Y.
    \end{tikzcd}
\end{equation}
We define the inverse image sheaf $f^{-1}\shf{F}$ to be the sheaf of sections of $\pi:f^{-1}\Spe(\shf{F})\to X$.
Equivalently, it is the sheaf
\begin{equation}
    \label{eq:invimg}
    f^{-1}\shf{F}(U) = \left\{s:U\to\Spe(\shf{F}): 
    \begin{tikzcd}
        & \Spe(\shf{F}) \arrow[d,"\pi"] \\
        U \arrow[r,"f|_U"] \arrow[ur,"s"] & Y
    \end{tikzcd} 
    \text{ commutes }
    \right\}
\end{equation}
or also equivalently, the sheaf
\begin{align}
    f^{-1}\shf{F}(U) = \{s:U\to\amalg_{x\in U}\shf{F}_{f(x)} : & \forall x\in U, \exists W\subset Y, V\subset f^{-1}(W)\cap U \text{ open and} \nonumber \\
                                                             & t\in\shf{F}(W) \text{ s.t. } x\in V \wedge  s(y) = t_{f(y)} \forall y\in V\}.
\end{align}
It is clear from the construction that we obtain a functor $f^{-1}:\Sh(Y)\to\Sh(X)$.
\begin{remark}
    A direct calculation shows that $f^{-1}\shf{F}_x$ and $\shf{F}_{f(x)}$ are naturally isomorphic and so there is a natrual bijection between $f^{-1}\Spe(\shf{F})$ and $\Spe(f^{-1}\shf{F})$.
    It is then a straightforward exercise to check that this bijection is in fact a homeomorphism i.e. $f^{-1}\Spe(\shf{F})\cong\Spe(f^{-1}\shf{F})$.
\end{remark}
\begin{thm}
    $f^{-1}$ is naturally isomorphic to $(-)^+\circ \lim_f$.
\end{thm}
\begin{proof}
    Let $U$ be an open subset of $X$ and $s\in\lim_f\shf{F}(U)$.
    There is a natural map $\phi_x:(\lim_f\shf{F})_x\to\shf{F}_{f(x)}$ so we can define a map $U\to\Spe(\shf{F})$ by $x\mapsto \phi_x(s_x)$.
    It is clear that this gives an element of $f^{-1}\shf{F}(U)$ as characterised by equation \ref{eq:invimg}.
    Thus we obtain a morphism $\lim_f\shf{F}\to f^{-1}\shf{F}$.
    On stalks this map is given by $\phi_x$.
    A direct calculation shows that $\phi_x$ is an isomorphism for all $x\in X$ and so the induced map $(\lim_f\shf{F})^+\to f^{-1}\shf{F}$ must be an isomorphism.
    It is straightforward to see that this defines a natural transformation.
\end{proof}
\begin{corollary}
    $f^{-1}\dashv f_*$ as functors between $\Sh(X)$ and $\Sh(Y)$.
\end{corollary}
\begin{proof}
    $f^{-1}$ is naturally isomophic to $(-)^+\circ \lim_f$ and so for $\shf{F}\in\Sh(Y),\shf{G}\in\Sh(X)$ we have natural bijections
    \begin{align}
        \Hom_{\Sh(X)}(f^{-1}\shf{F},\shf{G}) &\cong \Hom_{\Sh(X)}\left((\lim_f\shf{F})^+,\shf{G}\right) \cong \Hom_{\PreSh(X)}\left(\lim_f\shf{F},\shf{G}\right) \nonumber \\
                                             &\cong \Hom_{\PreSh(Y)}\left(\shf{F},f_*\shf{G}\right) \cong \Hom_{\Sh(Y)}\left(\shf{F},f_*\shf{G}\right).
    \end{align}
\end{proof}
\begin{corollary}
    $(-)_x\circ f^{-1} = (-)_{f(x)}$.
\end{corollary}
\begin{proof}
    $(-)_x\circ f^{-1} = (-)_x \circ (-)^+ \circ \lim_f = (-)_x \circ \lim_f = (-)_{f(x)}$.
\end{proof}
\begin{corollary}
    $f^{-1}$ is an exact functor.
\end{corollary}
\begin{proof}
    It is the composition of two exact functors.
    Alternatively take stalks.
\end{proof}
\section{The \texorpdfstring{$\sheafHom$}{Hom} sheaf}
Let $\shf{F}$ and $\shf{G}$ be sheaves and $f:\Spe(\shf{F})\to \Spe(\shf{G})$ be a continuous map so that 
\begin{equation}
    \begin{tikzcd}
        \Spe(\shf{F}) \arrow[rr, "\Spe(\phi)"] \arrow[rd,"\pi"] & & \Spe(\shf{G}) \arrow[dl,"\pi"] \\
                                              & X &
    \end{tikzcd}
\end{equation}
commutes.
Then we obtain a morphism $\shf{F}^+\to\shf{G}^+$ by postcomposing sections with $f$.
Since $\shf{F}$ and $\shf{G}$ are sheaves we in fact obtain a morphism $\shf{F}\to\shf{G}$.
But we also know that morphisms $\shf{F}\to \shf{G}$ give continuous maps $\Spe(\shf{F})\to\Spe(\shf{G})$ making the above diagram commute.
\section{Injective sheaves}
There are enough injectives.
\chapter{Spectral sequences}

\chapter{Group cohomology}
\end{document}

